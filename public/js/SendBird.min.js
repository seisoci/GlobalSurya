/**
 * Copyright (c) 2016 SendBird DBA (Smile Family, Inc.)
 * SendBird JavaScript SDK v3.0.113
 */

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("xhr2"),require("ws")):"function"==typeof define&&define.amd?define(["xhr2","ws"],n):(e=e||self).SendBird=n(e.XMLHttpRequest,e.WebSocket)}(this,function(e,r){"use strict";function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,n,t){return n&&i(e.prototype,n),t&&i(e,t),e}function n(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,r)}return t}function y(i){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?n(Object(a),!0).forEach(function(e){var n,t,r;n=i,r=a[t=e],t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach(function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(a,e))})}return i}function o(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&a(e,n)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,n){return(a=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function l(e,n,t){return(l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,n,t){var r=[null];r.push.apply(r,n);var i=new(Function.bind.apply(e,r));return t&&a(i,t.prototype),i}).apply(null,arguments)}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return l(e,arguments,u(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a(n,e)})(e)}function t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?t(e):n}function h(e,n,t){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,n,t){var r=function(e,n){for(;!Object.prototype.hasOwnProperty.call(e,n)&&null!==(e=u(e)););return e}(e,n);if(r){var i=Object.getOwnPropertyDescriptor(r,n);return i.get?i.get.call(t):i.value}})(e,n,t||e)}function p(e){throw new Error('"'+e+'" is read-only')}function g(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var t=[],r=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(t.push(s.value),!n||t.length!==n);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function E(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}e=e&&e.hasOwnProperty("default")?e.default:e,r=r&&r.hasOwnProperty("default")?r.default:r;var f=function(){function e(){_(this,e)}return s(e,null,[{key:"OS_VERSION",get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"undefined"}},{key:"SDK_VERSION",get:function(){return"3.0.113"}},{key:"SDK_MAJOR_VERSION",get:function(){return e.SDK_VERSION.split(".")[0]}},{key:"COMMAND_ACK_TIMEOUT",get:function(){return 1e4}}]),e}();function m(){try{return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent&&-1<navigator.userAgent.indexOf("MSIE 10")}catch(e){return!1}}function C(){try{return document&&9===document.documentMode}catch(e){return!1}}function v(){try{return document&&document.documentMode<=8}catch(e){return!1}}function U(){return"undefined"==typeof window&&"undefined"!=typeof process}function b(e){return"object"===Z(e)&&!!e}function A(e,n){var t=["prototype","caller","arguments","length"],r=Object.getOwnPropertyNames(e);for(var i in r){var a=r[i];t.indexOf(a)<0&&(n[a]||("function"==typeof e[a]?n[a]=e[a].bind(n):Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(e,a))))}return n}var N=function(){function e(){_(this,e),this._field={}}return s(e,[{key:"has",value:function(e){if(b(e))return e.__wk&&"string"==typeof e.__wk&&this._field.hasOwnProperty(e.__wk);throw new Error("Invalid value used as weak map key")}},{key:"get",value:function(e){if(b(e))return e.__wk&&"string"==typeof e.__wk?this._field[e.__wk]:null;throw new Error("Invalid value used as weak map key")}},{key:"set",value:function(e,n){if(!b(e))throw new Error("Invalid value used as weak map key");e.__wk&&"string"==typeof e.__wk||(e.__wk="__".concat((new Date).getTime(),"-").concat(parseInt(1e8*Math.random()))),this._field[e.__wk]=n}},{key:"delete",value:function(e){if(!b(e))throw new Error("Invalid value used as weak map key");this.has(e)&&delete this._field[e.__wk]}},{key:"length",get:function(){return 0}}]),e}(),S=m()||C()||v()||U()?N:WeakMap,I={},k=new S,$=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_(this,t),k.set(this,"object"===Z(e)&&e?e:{})}return s(t,[{key:"get",value:function(e){return k.get(this)[e]}},{key:"set",value:function(e,n){k.get(this)[e]=n}},{key:"remove",value:function(e){var n=k.get(this);n.hasOwnProperty(e)&&delete n[e]}},{key:"container",get:function(){return k.get(this)}}],[{key:"create",value:function(e,n){return I[e]=new t(n),I[e]}},{key:"get",value:function(e){return e=e||hn.getInstance()._iid,I[e]}}]),t}(),ee=function(){function r(e,n){var t;return _(this,r),(t=d(this,u(r).call(this,n))).name="SendBirdException",t.code=n||0,t.message=e,t}return o(r,c(Error)),s(r,null,[{key:"INVALID_INITIALIZATION",get:function(){return 800100}},{key:"CONNECTION_REQUIRED",get:function(){return 800101}},{key:"CONNECTION_CANCELED",get:function(){return 800102}},{key:"INVALID_PARAMETER",get:function(){return 800110}},{key:"NETWORK_ERROR",get:function(){return 800120}},{key:"NETWORK_ROUTING_ERROR",get:function(){return 800121}},{key:"MALFORMED_DATA",get:function(){return 800130}},{key:"MALFORMED_ERROR_DATA",get:function(){return 800140}},{key:"WRONG_CHANNEL_TYPE",get:function(){return 800150}},{key:"MARK_AS_READ_RATE_LIMIT_EXCEEDED",get:function(){return 800160}},{key:"QUERY_IN_PROGRESS",get:function(){return 800170}},{key:"ACK_TIMEOUT",get:function(){return 800180}},{key:"LOGIN_TIMEOUT",get:function(){return 800190}},{key:"WEBSOCKET_CONNECTION_CLOSED",get:function(){return 800200}},{key:"WEBSOCKET_CONNECTION_FAILED",get:function(){return 800210}},{key:"REQUEST_FAILED",get:function(){return 800220}},{key:"FILE_UPLOAD_CANCEL_FAILED",get:function(){return 800230}},{key:"REQUEST_CANCELED",get:function(){return 800240}}]),r}(),R=function(){function e(){_(this,e),this.sessionKey=null,this.eKey=null}return s(e,[{key:"hasSession",value:function(){return!!this.sessionKey}}]),e}(),O={DEBUG:"debug",PRODUCTION:"production"},T=O.PRODUCTION,ne=function(){function n(){_(this,n)}return s(n,null,[{key:"log",value:function(){var e;(e=console).log.apply(e,arguments)}},{key:"debug",value:function(){T===n.Mode.DEBUG&&n.log.apply(n,arguments)}},{key:"Mode",get:function(){return O}},{key:"mode",get:function(){return T},set:function(e){-1<Object.keys(n.Mode).map(function(e){return n.Mode[e]}).indexOf(e)&&(T=e)}}]),n}(),M={},L=function(){function i(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};for(var t in _(this,i),this._iid=e,n){var r=n[t];"function"==typeof r&&(this[t]=this.getClonedClass(r))}M[e]=this}return s(i,[{key:"getClonedClass",value:function(n){var t=this._iid;if(m()||C()){var e=function(){Object.defineProperty(this,"_iid",{get:function(){return t}}),n.call.apply(n,[this].concat(Array.prototype.slice.call(arguments)))};return(e.prototype=Object.create(n.prototype)).constructor=e,Object.defineProperty(e,"_iid",{get:function(){return t}}),A(n,e),e}return function(){function e(){return _(this,e),d(this,u(e).apply(this,arguments))}return o(e,n),s(e,[{key:"_iid",get:function(){return t}}],[{key:"_iid",get:function(){return t}},{key:"_name",get:function(){return n.name}}]),e}()}}],[{key:"get",value:function(e){return e?M[e]:{}}}]),i}(),w=function(){function n(e){_(this,n),this.sb=e,this.pingTimer=null,this.pingTimeoutTimer=null}return s(n,[{key:"ping",value:function(){var e=this,n=L.get(this.sb._iid).Command.bPing(),t=$.get(this.sb._iid).container,r=t.wsAdapter,i=t.pongTimeout;r.ws.send(n),ne.debug("PING"),this.pingTimeoutTimer=setTimeout(function(){ne.debug("PING timeout"),e.stop(),r.ws.handler&&r.ws.handler.onError()},i)}},{key:"pong",value:function(){clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=null}},{key:"start",value:function(){var e=this,n=$.get(this.sb._iid).container.pingInterval;this.stop(),this.ping(),this.pingTimer=setInterval(function(){e.ping()},n)}},{key:"stop",value:function(){clearInterval(this.pingTimer),this.pingTimer=null,clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=null}}]),n}(),P=function(){function e(){_(this,e),this._fields=[]}return s(e,[{key:"append",value:function(e,n){_fields.push({key:e,value:n})}},{key:"toString",value:function(){var e="--------FormData"+Math.random(),n="";for(var t in this._fields){var r=this._fields[t];if(n+=(p("body"),"--"+e+"\r\n"),r[1].name){var i=r[1];n+=(p("body"),'Content-Disposition: form-data; name="'+r[0]+'"; filename="'+i.name+'"\r\n'),n+=(p("body"),"Content-Transfer-Encoding: base64\r\n"),n+=(p("body"),"Content-Type: "+i.type+"\r\n\r\n"),n+=(p("body"),i.base64+"\r\n")}else n+=(p("body"),'Content-Disposition: form-data; name="'+r[0]+'";\r\n\r\n'),n+=(p("body"),r[1]+"\r\n")}return n+=(p("body"),"--"+e+"--")}}]),e}(),D=C()||v()||U()?P:FormData,H=[800101,800120,800180,800200,800210],te=function(){function e(){_(this,e)}return s(e,null,[{key:"deepEqual",value:function(e,n){if(e===n)return!0;var t=y({},e),r=y({},n);return(!t.messageId||!r.messageId||t.messageId===r.messageId)&&((!t.reqId||!r.reqId||t.reqId===r.reqId)&&(t.hasOwnProperty("messageId")&&delete t.messageId,t.hasOwnProperty("reqId")&&delete t.reqId,r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,JSON.stringify(t)===JSON.stringify(r)))}},{key:"isVideoChatSignalingMessage",value:function(e){try{return!(!e.isUserMessage()||"string"!=typeof e.customType||0!==e.customType.indexOf("SB_VIDEOCHAT")||"SGNL"!==e.data.substring(0,4))}catch(e){return!1}}},{key:"isResendableError",value:function(e){return 0<e&&0<=H.indexOf(e)}},{key:"isFile",value:function(e){var n="object"===Z(e)&&null!==e&&"string"==typeof e.name&&"string"==typeof e.uri&&"string"==typeof e.type;if(!n){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n}}]),e}(),G=function(){function t(e){if(_(this,t),this.fields={},e)for(var n in e)this.fields[n]={value:e[n]},te.isFile(e[n])&&(this.fields[n].filename=e[n].name);this.upload={requestId:null,deleteRequest:null,progressHandler:null}}return s(t,[{key:"add",value:function(e,n,t){var r=2<arguments.length&&void 0!==t?t:null;this.fields[e]={value:n,filename:r}}},{key:"remove",value:function(e){this.fields.hasOwnProperty(e)&&delete this.fields[e]}},{key:"yield",value:function(){var e=!1;for(var n in this.fields)if(te.isFile(this.fields[n].value)){e=!0;break}if(e){var t=new D;for(var r in this.fields){var i=this.fields[r];te.isFile(i.value)?t.append(r,i.value,i.filename):t.append(r,i.value)}return t}var a={};for(var s in this.fields)a[s]=this.fields[s].value;return a}}]),t}(),F=U()?e:XMLHttpRequest,q=function(){function b(e){_(this,b),this.sb=e,this.cls=L.get(this.sb._iid)}return s(b,[{key:"checkRouting",value:function(e){if(this.sb.customApiHost&&this.sb.customWsHost)"function"==typeof e&&e(null,{apiHost:this.sb.customApiHost,wsHost:this.sb.customWsHost});else{var n=this.sb.getApplicationId();e(null,{apiHost:"https://api-".concat(n,".sendbird.com"),wsHost:"wss://ws-".concat(n,".sendbird.com")})}}},{key:"_parseError",value:function(n){try{var e=JSON.parse(n.response),t=e?e.message:"Request failed.",r=e?e.code:ee.REQUEST_FAILED;return new ee(t,r)}catch(e){return n instanceof ee?n:new ee("Request failed.",ee.REQUEST_FAILED)}}},{key:"_setDefaultHeader",value:function(e,n){try{var t=$.get(this.sb._iid).container,r=t.appId,i=t.auth;e.setRequestHeader("SendBird","JS,".concat(f.OS_VERSION,",").concat(f.SDK_VERSION,",").concat(r)),n&&e.setRequestHeader("Session-Key",i.sessionKey),e.setRequestHeader("Request-Sent-Timestamp",(new Date).getTime().toString())}catch(e){ne.debug("setting default header is failed. - ",e)}}},{key:"_setRequestEvent",value:function(i,a,n){var s=this;try{a&&"function"==typeof a&&(i.upload.onprogress=function(e){n&&"function"==typeof n&&n(e),e.lengthComputable&&e.loaded>=e.total&&a()}),i.onreadystatechange=function(){if(i&&i.readyState===F.DONE){var e=i.status,n=null;if(200<=e&&e<400){var t=!0;try{n=JSON.parse(i.responseText)}catch(e){t=!1,n=null}t?i.callback(null,n):i.callback(new ee("Request failed.",ee.REQUEST_FAILED),null),a&&"function"==typeof a&&a(),i=null}else{var r={status:e,statusText:i.statusText,response:i.responseText};ne.debug(r),i&&i.isAbort?i.onabort():(i.callback(s._parseError(r),null),i=null)}}},i.onabort=function(){i&&(i.callback(new ee("Request has been canceled.",ee.REQUEST_CANCELED),null),a&&"function"==typeof a&&a()),i=null},i.onerror=function(){i&&(i.callback(new ee("There was a network error.",ee.NETWORK_ERROR),null),a&&"function"==typeof a&&a()),i=null},i.ontimeout=function(){i&&(i.callback(new ee("Request is timeout.",ee.REQUEST_FAILED),null),a&&"function"==typeof a&&a()),i=null}}catch(e){ne.debug("setting request event is failed. - ",e)}}},{key:"_createWithEncodedGetParams",value:function(e){try{var n="";for(var t in e.data)if(e.data.hasOwnProperty(t)){var r=e.data[t];if(null!=r){n+=t+"="+("object"===Z(r)?Array.isArray(r)?r.map(function(e){return encodeURIComponent(e)}).join(","):encodeURIComponent(JSON.stringify(r)):encodeURIComponent(r))+"&"}}n&&(e.url=e.url+"?"+n.substring(0,n.length-1))}catch(e){ne.debug("createWithEncodedGetParams is failed. - ",e)}}},{key:"_sendRequest",value:function(e,n){try{switch(e){case"GET":n.send();break;default:void 0!==D&&D&&n.data instanceof D?C()||v()?(n.setRequestHeader("Content-Type","multipart/form-data; boundary="+n.data.boundary),n.send(n.data.toString())):n.send(n.data):(n.setRequestHeader("Content-Type","application/json; charset=utf-8"),n.send(JSON.stringify(n.data)))}}catch(e){ne.debug("sending a request is failed. - ",e)}}},{key:"get",value:function(i,a,s){var o=this;this.checkRouting(function(e,n){if(e)s(new ee("Request failed.",ee.REQUEST_FAILED),null);else if(F){var t=new F;t.url="".concat(n.apiHost,"/v").concat(f.SDK_MAJOR_VERSION).concat(i),t.data=a?a.yield():{},t.callback=s,o._createWithEncodedGetParams(t),t.open("GET",t.url,!0);var r=$.get(o.sb._iid).container.auth;o._setRequestEvent(t),o._setDefaultHeader(t,r.sessionKey),o._sendRequest("GET",t)}else s(new ee("Request failed. XMLHttpRequest not found.",ee.REQUEST_FAILED),null)})}},{key:"post",value:function(s,o,u){var l=this;this.checkRouting(function(e,n){if(e)u(new ee("Request failed.",ee.REQUEST_FAILED),null);else if(F){var t=new F;t.url="".concat(n.apiHost,"/v").concat(f.SDK_MAJOR_VERSION).concat(s),t.data=o?o.yield():{},t.callback=u,t.open("POST",t.url,!0),o.upload||(o.upload={});var r=l.cls.FileMessageQueue,i=o.upload.reqId;i&&(r.uploadRequest[i]=t);var a=$.get(l.sb._iid).container.auth;l._setRequestEvent(t,o.upload.deleteRequest,o.upload.progressHandler),l._setDefaultHeader(t,a.sessionKey),l._sendRequest("POST",t)}else u(new ee("Request failed. XMLHttpRequest not found.",ee.REQUEST_FAILED),null)})}},{key:"put",value:function(i,a,s){var o=this;this.checkRouting(function(e,n){if(e)s(new ee("Request failed.",ee.REQUEST_FAILED),null);else if(F){var t=new F;t.url="".concat(n.apiHost,"/v").concat(f.SDK_MAJOR_VERSION).concat(i),t.data=a?a.yield():{},t.callback=s,t.open("PUT",t.url,!0);var r=$.get(o.sb._iid).container.auth;o._setRequestEvent(t),o._setDefaultHeader(t,r.sessionKey),o._sendRequest("PUT",t)}else s(new ee("Request failed. XMLHttpRequest not found.",ee.REQUEST_FAILED),null)})}},{key:"delete",value:function(i,a,s){var o=this;this.checkRouting(function(e,n){if(e)s(new ee("Request failed.",ee.REQUEST_FAILED),null);else if(F){var t=new F;t.url="".concat(n.apiHost,"/v").concat(f.SDK_MAJOR_VERSION).concat(i),t.data=a?a.yield():{},t.callback=s,o._createWithEncodedGetParams(t),t.open("DELETE",t.url,!0);var r=$.get(o.sb._iid).container.auth;o._setRequestEvent(t),o._setDefaultHeader(t,r.sessionKey),o._sendRequest("DELETE",t)}else s(new ee("Request failed. XMLHttpRequest not found.",ee.REQUEST_FAILED),null)})}},{key:"updateCurrentUserInfo",value:function(e,i){var a=this,s=e.nickname,o=e.profileUrl,u=e.profileImage,l=e.preferredLanguages;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G;s&&r.add("nickname",s),o&&r.add("profile_url",o),u&&r.add("profile_file",u,u.name),l&&r.add("preferred_languages",l),a.put(t,r,i)}})}},{key:"getMyGroupChannelChangeLogs",value:function(e,i){var a=this,s=e.ts,o=e.token,u=e.customTypes,l=e.includeEmpty;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_MY_GROUP_CHANNEL_CHANGELOGS.replace("%s",encodeURIComponent(n.userId)),r=new G({show_read_receipt:!0,show_member:!0});o&&r.add("token",o),s&&r.add("change_ts",s),u&&0<u.length&&r.add("custom_types",u),"boolean"==typeof l&&r.add("show_empty",l),a.get(t,r,i)}})}},{key:"getChannelInvitationPreference",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE.replace("%s",encodeURIComponent(n.userId));i.get(t,null,r)}})}},{key:"getGroupChannelCount",value:function(e,s){var o=this,u=e.memberStateFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)s(e,null);else{var t=o.cls.GroupChannel,r=b.Path.USERS_USERID_GROUP_CHANNEL_COUNT.replace("%s",encodeURIComponent(o.sb.currentUser.userId)),i="";switch(u){case t.MemberStateFilter.JOINED:i="joined";break;case t.MemberStateFilter.INVITED:i="invited";break;case t.MemberStateFilter.INVITED_BY_FRIEND:i="invited_by_friend";break;case t.MemberStateFilter.INVITED_BY_NON_FRIEND:i="invited_by_non_friend";break;default:i="all"}var a=new G({state:i});o.get(r,a,s)}})}},{key:"getUnreadItemCount",value:function(e,i){var a=this,s=e.keys;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_UNREAD_ITEM_COUNT.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({item_keys:s});a.get(t,r,i)}})}},{key:"getTotalUnreadMessageCount",value:function(e,i){var a=this,s=e.customTypesFilter,o=e.superChannelFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_UNREAD_MESSAGE_COUNT.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({super_mode:o});null!==s&&0<s.length&&r.add("custom_types",s),a.get(t,r,i)}})}},{key:"getTotalUnreadChannelCount",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_UNREAD_CHANNEL_COUNT.replace("%s",encodeURIComponent(i.sb.currentUser.userId));i.get(t,null,r)}})}},{key:"markAsReadAll",value:function(e,i){var a=this,s=e.channelUrls;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_MARKASREADALL.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G;s&&r.add("channel_urls",s),a.put(t,r,i)}})}},{key:"setChannelInvitationPreference",value:function(e,i){var a=this,s=e.isAutoAccept;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE.replace("%s",encodeURIComponent(n.userId)),r=new G({auto_accept:s});a.put(t,r,i)}})}},{key:"blockUser",value:function(e,i){var a=this,s=e.blockedUserId;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_BLOCK.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({target_id:s});a.post(t,r,i)}})}},{key:"unblockUser",value:function(e,r){var i=this,a=e.unblockedUserId;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_BLOCK_TARGETID.replace("%s",encodeURIComponent(i.sb.currentUser.userId)).replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"getPushTriggerOption",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId));i.get(t,null,r)}})}},{key:"setPushTriggerOption",value:function(e,i){var a=this,s=e.pushTriggerOption;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(n.userId)),r=new G({push_trigger_option:s});a.put(t,r,i)}})}},{key:"getPushTokens",value:function(e,i){var a=this,s=e.ts,o=e.token,u=e.type;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_PUSH_DEVICE_TOKENS.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(u)),r=new G;o&&r.add("token",o),s&&r.add("created_ts",s),a.get(t,r,i)}})}},{key:"getPushTemplate",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_PUSH_TEMPLATE.replace("%s",encodeURIComponent(n.userId));i.get(t,null,r)}})}},{key:"setPushTemplate",value:function(e,i){var a=this,s=e.templateName;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_PUSH_TEMPLATE.replace("%s",encodeURIComponent(n.userId)),r=new G({name:s});a.put(t,r,i)}})}},{key:"getDoNotDisturb",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(i.sb.currentUser.userId));i.get(t,null,r)}})}},{key:"setDoNotDisturb",value:function(e,i){var a=this,s=e.doNotDisturbOn,o=e.startHour,u=e.startMin,l=e.endHour,c=e.endMin,d=e.timezone;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({do_not_disturb:s,start_hour:o,start_min:u,end_hour:l,end_min:c,timezone:d});a.put(t,r,i)}})}},{key:"getSnoozePeriod",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(i.sb.currentUser.userId));i.get(t,null,r)}})}},{key:"setSnoozePeriod",value:function(e,i){var a=this,s=e.snoozeOn,o=e.startTs,u=e.endTs;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({snooze_enabled:s,snooze_start_ts:o,snooze_end_ts:u});a.put(t,r,i)}})}},{key:"registerGCMPushToken",value:function(e,i){var a=this,s=e.token;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_PUSH_GCM.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({gcm_reg_token:s});a.post(t,r,i)}})}},{key:"unregisterGCMPushToken",value:function(e,r){var i=this,a=e.token;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_PUSH_GCM_TOKEN.replace("%s",encodeURIComponent(i.sb.currentUser.userId)).replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"unregisterAllGCMPushTokens",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_PUSH_GCM.replace("%s",encodeURIComponent(i.sb.currentUser.userId));i.delete(t,null,r)}})}},{key:"registerAPNSPushToken",value:function(e,i){var a=this,s=e.token;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_PUSH_APNS.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({apns_device_token:s});a.post(t,r,i)}})}},{key:"unregisterAPNSPushToken",value:function(e,r){var i=this,a=e.token;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_PUSH_APNS_TOKEN.replace("%s",encodeURIComponent(i.sb.currentUser.userId)).replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"unregisterAllAPNSPushTokens",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_PUSH_APNS.replace("%s",encodeURIComponent(i.sb.currentUser.userId));i.delete(t,null,r)}})}},{key:"unregisterAllPushTokens",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_PUSH.replace("%s",encodeURIComponent(i.sb.currentUser.userId));i.delete(t,null,r)}})}},{key:"loadFriendList",value:function(e,i){var a=this,s=e.token,o=e.limit;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.FRIENDS.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({limit:o,token:s});a.get(t,r,i)}})}},{key:"getFriendChangeLogsByToken",value:function(e,i){var a=this,s=e.token;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.FRIENDS_CHANGE_LOGS.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G;s&&r.add("token",s),a.get(t,r,i)}})}},{key:"addFriends",value:function(e,i){var a=this,s=e.userIds;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.FRIENDS.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({user_ids:s});a.post(t,r,i)}})}},{key:"deleteFriends",value:function(e,i){var a=this,s=e.userIds;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.FRIENDS.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({user_ids:s});a.delete(t,r,i)}})}},{key:"uploadFriendDiscoveries",value:function(e,a){var s=this,o=e.discoveries;this.sb.ConnectionManager.ready(function(e,n){if(e)a(e,null);else{var t=b.Path.FRIENDS_DISCOVERIES.replace("%s",encodeURIComponent(s.sb.currentUser.userId)),r=[];o.forEach(function(e){r.push({friend_discovery_key:e.friendDiscoveryKey,friend_name:"string"==typeof e.friendName||e.friendName?e.friendName:null})});var i=new G({friend_discoveries:r});s.put(t,i,a)}})}},{key:"deleteFriendDiscoveries",value:function(e,i){var a=this,s=e.discoveryKeys;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.FRIENDS_DISCOVERIES.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({friend_discovery_keys:s});a.delete(t,r,i)}})}},{key:"loadUserList",value:function(e,i){var a=this,s=e.token,o=e.limit,u=e.userIdsFilter,l=e.metaDataKeyFilter,c=e.metaDataValuesFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS,r=new G({token:s,limit:o});u&&0<u.length&&r.add("user_ids",u),l&&c&&0<c.length&&(r.add("metadatakey",l),r.add("metadatavalues_in",c)),a.get(t,r,i)}})}},{key:"loadBlockedUserList",value:function(e,i){var a=this,s=e.token,o=e.limit,u=e.userIdsFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_BLOCK.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({token:s,limit:o});u&&0<u.length&&r.add("user_ids",u),a.get(t,r,i)}})}},{key:"createUserMetaData",value:function(e,i){var a=this,s=e.metaData;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_METADATA.replace("%s",encodeURIComponent(n.userId)),r=new G({metadata:s});a.post(t,r,i)}})}},{key:"updateUserMetaData",value:function(e,i){var a=this,s=e.metaData,o=e.upsert;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_METADATA.replace("%s",encodeURIComponent(n.userId)),r=new G({metadata:s,upsert:o});a.put(t,r,i)}})}},{key:"deleteUserMetaData",value:function(e,r){var i=this,a=e.metaDataKey;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_METADATA_KEY.replace("%s",encodeURIComponent(n.userId)).replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"deleteAllUserMetaData",value:function(e,r){var i=this;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_METADATA.replace("%s",encodeURIComponent(n.userId));i.delete(t,null,r)}})}},{key:"getMessageChangeLogs",value:function(e,i){var a=this,s=e.channelUrl,o=e.ts,u=e.token,l=e.isOpenChannel,c=e.includeMetaArray;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=l?b.Path.OPENCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS.replace("%s",encodeURIComponent(s)):b.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS.replace("%s",encodeURIComponent(s)),r=new G;u&&r.add("token",u),o&&r.add("change_ts",o),"boolean"==typeof c&&r.add("with_sorted_meta_array",c),a.get(t,r,i)}})}},{key:"getMyMutedInfo",value:function(e,r){var i=this,a=e.channelUrl,s=e.userId,o=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=o?b.Path.GROUPCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(s)):b.Path.OPENCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(s));i.get(t,null,r)}})}},{key:"loadBannedUserList",value:function(e,i){var a=this,s=e.token,o=e.limit,u=e.channelUrl,l=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=l?b.Path.OPENCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(u)):b.Path.GROUPCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(u)),r=new G({token:s,limit:o});a.get(t,r,i)}})}},{key:"loadMutedUserList",value:function(e,i){var a=this,s=e.token,o=e.limit,u=e.channelUrl,l=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=l?b.Path.OPENCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(u)):b.Path.GROUPCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(u)),r=new G({token:s,limit:o});a.get(t,r,i)}})}},{key:"getMessageList",value:function(e,i){var a=this,s=e.channel,o=e.token,u=e.tokenType,l=e.isInclusive,n=e.prevResultSize,c=void 0===n?0:n,t=e.nextResultSize,d=void 0===t?0:t,h=e.shouldReverse,p=e.messageType,f=e.customType,_=e.senderUserIds,y=e.includeMetaArray;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=s.isOpenChannel()?b.Path.OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",s.url):b.Path.GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",s.url),r=new G({is_sdk:String(!0),prev_limit:String(c),next_limit:String(d),include:String(l),reverse:String(h)});"timestamp"===u?r.add("message_ts",o):"messageId"===u&&r.add("message_id",String(o)),p&&r.add("message_type",String(p)),f&&r.add("custom_type",String(f)),Array.isArray(_)&&0<_.length&&r.add("sender_ids",_),"boolean"==typeof y&&r.add("with_sorted_meta_array",y),a.get(t,r,i)}})}},{key:"translateUserMessage",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,u=e.messageId,l=e.translationTargetLanguages;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?b.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION.replace("%s",encodeURIComponent(s)).replace("%s",u):b.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION.replace("%s",encodeURIComponent(s)).replace("%s",u),r=new G({target_langs:l});a.post(t,r,i)}})}},{key:"deleteMessage",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.messageId;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=s?b.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(o)):b.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(o));i.delete(t,null,r)}})}},{key:"muteUser",value:function(e,i){var a=this,s=e.channelUrl,o=e.userId,u=e.description,l=e.seconds,c=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=c?b.Path.GROUPCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(s)):b.Path.OPENCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(s)),r=new G({user_id:o});l&&(0<l||-1!==l)&&r.add("seconds",l),u&&r.add("description",u),a.post(t,r,i)}})}},{key:"unmuteUser",value:function(e,r){var i=this,a=e.channelUrl,s=e.userId,o=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=o?b.Path.GROUPCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(s)):b.Path.OPENCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(s));i.delete(t,null,r)}})}},{key:"banUser",value:function(e,i){var a=this,s=e.channelUrl,o=e.userId,u=e.description,l=e.seconds,c=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=c?b.Path.GROUPCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(s)):b.Path.OPENCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(s)),r=new G({user_id:o});u&&r.add("description",u),r.add("seconds",String(l)),a.post(t,r,i)}})}},{key:"unbanUser",value:function(e,r){var i=this,a=e.channelUrl,s=e.userId,o=e.isGroupChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=o?b.Path.GROUPCHANNELS_CHANNELURL_BAN_USERID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(s)):b.Path.OPENCHANNELS_CHANNELURL_BAN_USERID.replace("%s",encodeURIComponent(a)).replace("%s",encodeURIComponent(s));i.delete(t,null,r)}})}},{key:"getMetaCounters",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,u=e.keys;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?b.Path.OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(s)):b.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(s)),r=new G({keys:u});a.get(t,r,i)}})}},{key:"createMetaCounters",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,u=e.metaCounter;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?b.Path.OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(s)):b.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(s)),r=new G({metacounter:u});a.post(t,r,i)}})}},{key:"updateMetaCounters",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,u=e.metaCounter,l=e.upsert,c=e.mode;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?b.Path.OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(s)):b.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(s)),r=new G({metacounter:u,upsert:l,mode:c});a.put(t,r,i)}})}},{key:"deleteMetaCounter",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.key;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=s?b.Path.OPENCHANNELS_CHANNELURL_METACOUNTER_KEY.replace("%s",encodeURIComponent(a)).replace("%s",o):b.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER_KEY.replace("%s",encodeURIComponent(a)).replace("%s",o);i.delete(t,null,r)}})}},{key:"deleteAllMetaCounters",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=s?b.Path.OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(a)):b.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"getMetaData",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,u=e.keys;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?b.Path.OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(s)):b.Path.GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(s)),r=new G({keys:u});a.get(t,r,i)}})}},{key:"createMetaData",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,u=e.metaData;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?b.Path.OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(s)):b.Path.GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(s)),r=new G({metadata:u});a.post(t,r,i)}})}},{key:"updateMetaData",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,u=e.metaData,l=e.upsert;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?b.Path.OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(s)):b.Path.GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(s)),r=new G({metadata:u,upsert:l});a.put(t,r,i)}})}},{key:"deleteMetaData",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel,o=e.key;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=s?b.Path.OPENCHANNELS_CHANNELURL_METADATA_KEY.replace("%s",encodeURIComponent(a)).replace("%s",o):b.Path.GROUPCHANNELS_CHANNELURL_METADATA_KEY.replace("%s",encodeURIComponent(a)).replace("%s",o);i.delete(t,null,r)}})}},{key:"deleteAllMetaData",value:function(e,r){var i=this,a=e.channelUrl,s=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=s?b.Path.OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(a)):b.Path.GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"loadOperatorList",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,u=e.token,l=e.limit;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?b.Path.OPENCHANNELS_OPERATORS.replace("%s",encodeURIComponent(s)):b.Path.GROUPCHANNELS_OPERATORS.replace("%s",encodeURIComponent(s)),r=new G({token:u,limit:l});a.get(t,r,i)}})}},{key:"getOpenChannel",value:function(e,r){var i=this,a=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(a));i.get(t,null,r)}})}},{key:"loadOpenChannelList",value:function(e,i){var a=this,s=e.token,o=e.limit,u=e.nameKeyword,l=e.urlKeyword,c=e.customTypes;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.OPENCHANNELS,r=new G({token:s,limit:o});u&&r.add("name_contains",u),l&&r.add("url_contains",l),c&&0<c.length&&r.add("custom_types",c),a.get(t,r,i)}})}},{key:"loadParticipantList",value:function(e,i){var a=this,s=e.token,o=e.limit,u=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.OPENCHANNELS_CHANNELURL_PARTICIPANTS.replace("%s",encodeURIComponent(u)),r=new G({token:s,limit:o});a.get(t,r,i)}})}},{key:"createOpenChannel",value:function(e,i){var a=this,s=e.name,o=e.coverUrlOrImage,u=e.data,l=e.operatorUserIds,c=e.customType;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.OPENCHANNELS,r=new G;"string"==typeof o&&r.add("cover_url",o),te.isFile(o)&&r.add("cover_file",o),null!==s&&"string"==typeof s&&r.add("name",s),u&&r.add("data",u),l&&(Array.isArray(l)?r.add("operators",l):r.add("operators",[l])),c&&r.add("custom_type",c),a.post(t,r,i)}})}},{key:"updateOpenChannel",value:function(e,i){var a=this,s=e.channelUrl,o=e.name,u=e.coverUrlOrImage,l=e.data,c=e.operatorUserIds,d=e.customType;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(s)),r=new G;"string"==typeof u&&r.add("cover_url",u),te.isFile(u)&&r.add("cover_file",u,u.name),null!==o&&"string"==typeof o&&r.add("name",o),null!==l&&"string"==typeof l&&r.add("data",l),null!==c&&(Array.isArray(c)?r.add("operators",c):r.add("operators",[c])),null!==d&&"string"==typeof d&&r.add("custom_type",d),a.put(t,r,i)}})}},{key:"deleteOpenChannel",value:function(e,r){var i=this,a=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"getGroupChannel",value:function(e,i){var a=this,s=e.channelUrl,o=e.showMember,u=e.showReadReceipt;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(s)),r=new G({show_member:o,show_read_receipt:u});a.get(t,r,i)}})}},{key:"loadGroupChannelList",value:function(e,i){var a=this,s=e.token,o=e.limit,u=e.includeEmpty,l=e.order,c=e.userIdsFilter,d=e.nicknameContainsFilter,h=e.channelNameContainsFilter,p=e.channelUrlsFilter,f=e.customTypesFilter,_=e.customTypeStartsWithFilter,y=e.memberStateFilter,g=e.superChannelFilter,m=e.publicChannelFilter,C=e.unreadChannelFilter,v=e.metadataOrderKeyFilter,E=e.hiddenChannelFilter,U=e.searchFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.MYGROUPCHANNELS.replace("%s",encodeURIComponent(a.sb.currentUser.userId)),r=new G({token:s,limit:o,order:l,show_member:!0,show_read_receipt:!0,show_empty:String(u),member_state_filter:y});f&&0<f.length&&r.add("custom_types",f),d&&r.add("members_nickname_contains",d),h&&r.add("name_contains",h),U.hasOwnProperty("search_query")&&U.hasOwnProperty("search_fields")&&(r.add("search_query",U.search_query),r.add("search_fields",U.search_fields)),c.userIds&&0<c.userIds.length&&(c.includeMode?(r.add("members_include_in",c.userIds),r.add("query_type",c.queryType.toUpperCase())):r.add("members_exactly_in",c.userIds)),p&&0<p.length&&r.add("channel_urls",p),r.add("super_mode",g),r.add("public_mode",m),r.add("unread_filter",C),v&&r.add("metadata_order_key",v),_&&r.add("custom_type_startswith",_),E&&r.add("hidden_mode",E),a.get(t,r,i)}})}},{key:"loadPublicGroupChannelList",value:function(e,a){var s=this,o=e.token,u=e.limit,l=e.includeEmpty,c=e.order,d=e.channelNameContainsFilter,h=e.channelUrlsFilter,p=e.customTypesFilter,f=e.customTypeStartsWithFilter,_=e.superChannelFilter,y=e.membershipFilter,g=e.metadataOrderKeyFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)a(e,null);else{var t=s.cls.GroupChannel,r=b.Path.GROUPCHANNELS,i=new G({token:o,limit:u,order:c,show_member:!0,show_read_receipt:!0,show_empty:String(l),public_mode:t.PublicChannelFilter.PUBLIC,public_membership_mode:y});p&&0<p.length&&i.add("custom_types",p),d&&i.add("name_contains",d),h&&0<h.length&&i.add("channel_urls",h),i.add("super_mode",_),g&&i.add("metadata_order_key",g),f&&i.add("custom_type_startswith",f),s.get(r,i,a)}})}},{key:"createGroupChannel",value:function(e,i){var a=this,s=e.isDistinct,o=e.isSuper,u=e.isPublic,l=e.channelUrl,c=e.isDiscoverable,d=e.isStrict,h=e.name,p=e.data,f=e.customType,_=e.coverUrl,y=e.coverImage,g=e.accessCode,m=e.isEphemeral,n=e._invitedUserIds,C=void 0===n?[]:n,v=e.operatorUserIds;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.GROUPCHANNELS,r=new G({user_ids:[n.userId].concat(E(C)).filter(function(e,n,t){return n===t.indexOf(e)})});null!==_&&"string"==typeof _&&r.add("cover_url",_),te.isFile(y)&&r.add("cover_file",y,y.name),null!==l&&r.add("channel_url",l),null!==s&&r.add("is_distinct",s),null!==o&&r.add("is_super",o),null!==u&&r.add("is_public",u),null!==c&&r.add("is_discoverable",c),null!==d&&r.add("strict",d),null!==m&&r.add("is_ephemeral",m),g&&r.add("access_code",g),null!==h&&"string"==typeof h&&r.add("name",h),p&&r.add("data",p),f&&r.add("custom_type",f),Array.isArray(v)&&0<v.length&&r.add("operator_ids",v),a.post(t,r,i)}})}},{key:"updateGroupChannel",value:function(e,i){var a=this,s=e.isDistinct,o=e.isPublic,u=e.channelUrl,l=e.isDiscoverable,c=e.name,d=e.data,h=e.customType,p=e.coverUrl,f=e.coverImage,_=e.accessCode;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(u)),r=new G;null!==s&&r.add("is_distinct",s),null!==o&&r.add("is_public",o),null!==l&&r.add("is_discoverable",l),null!==_&&r.add("access_code",_),null!==p&&"string"==typeof p&&r.add("cover_url",p),te.isFile(f)&&r.add("cover_file",f,f.name),null!==c&&"string"==typeof c&&r.add("name",c),null!==d&&"string"==typeof d&&r.add("data",d),null!==h&&"string"==typeof h&&r.add("custom_type",h),a.put(t,r,i)}})}},{key:"inviteToGroupChannel",value:function(e,i){var a=this,s=e.channelUrl,o=e.userIds;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.GROUPCHANNELS_CHANNELURL_INVITE.replace("%s",encodeURIComponent(s)),r=new G({user_ids:o});a.post(t,r,i)}})}},{key:"acceptInvitation",value:function(e,i){var a=this,s=e.channelUrl,o=e.accessCode;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.GROUPCHANNELS_CHANNELURL_ACCEPT_INVITATION.replace("%s",encodeURIComponent(s)),r=new G({user_id:a.sb.currentUser.userId});o&&r.add("access_code",o),a.put(t,r,i)}})}},{key:"declineInvitation",value:function(e,i){var a=this,s=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.GROUPCHANNELS_CHANNELURL_DECLINE_INVITATION.replace("%s",encodeURIComponent(s)),r=new G({user_id:a.sb.currentUser.userId});a.put(t,r,i)}})}},{key:"joinGroupChannel",value:function(e,i){var a=this,s=e.channelUrl,o=e.accessCode;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.GROUPCHANNELS_CHANNELURL_JOIN.replace("%s",encodeURIComponent(s)),r=new G({user_id:a.sb.currentUser.userId});o&&r.add("access_code",o),a.put(t,r,i)}})}},{key:"leaveGroupChannel",value:function(e,i){var a=this,s=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.GROUPCHANNELS_CHANNELURL_LEAVE.replace("%s",encodeURIComponent(s)),r=new G({user_id:a.sb.currentUser.userId});a.put(t,r,i)}})}},{key:"hideGroupChannel",value:function(e,i){var a=this,s=e.channelUrl,o=e.hidePreviousMessages,u=e.allowAutoUnhide;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.GROUPCHANNELS_CHANNELURL_HIDE.replace("%s",encodeURIComponent(s)),r=new G({user_id:a.sb.currentUser.userId,hide_previous_messages:o,allow_auto_unhide:u});a.put(t,r,i)}})}},{key:"unhideGroupChannel",value:function(e,r){var i=this,a=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.GROUPCHANNELS_CHANNELURL_HIDE.replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"freeze",value:function(e,i){var a=this,s=e.channelUrl,o=e.isGroupChannel,u=e.freezing;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=o?b.Path.GROUPCHANNELS_CHANNELURL_FREEZE.replace("%s",encodeURIComponent(s)):b.Path.OPENCHANNELS_CHANNELURL_FREEZE.replace("%s",encodeURIComponent(s)),r=new G({freeze:u});a.put(t,r,i)}})}},{key:"deleteGroupChannel",value:function(e,r){var i=this,a=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(a));i.delete(t,null,r)}})}},{key:"loadMemberList",value:function(e,i){var a=this,s=e.channelUrl,o=e.token,u=e.limit,l=e.mutedMemberFilter,c=e.order,d=e.memberStateFilter,h=e.nicknameStartsWithFilter;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.GROUPCHANNELS_MEMBERS.replace("%s",encodeURIComponent(s)),r=new G({token:o,limit:u,order:c.toLowerCase(),muted_member_filter:l.toLowerCase(),member_state_filter:d});h&&r.add("nickname_startswith",h),a.get(t,r,i)}})}},{key:"report",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,u=e.reportCategory,l=e.reportingUserId,c=e.reportDescription;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.REPORT_CHANNELS.replace("%s",encodeURIComponent(o?"open_channels":"group_channels")).replace("%s",encodeURIComponent(s)),r=new G({report_category:u});null!=l&&r.add("reporting_user_id",l),null!=c&&r.add("report_description",c),a.post(t,r,i)}})}},{key:"reportUser",value:function(e,i){var a=this,s=e.offendingUserId,o=e.channelUrl,u=e.isOpenChannel,l=e.reportCategory,c=e.reportingUserId,d=e.reportDescription;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.REPORT_USERS.replace("%s",encodeURIComponent(s)),r=new G({channel_url:o,channel_type:u?"open_channels":"group_channels",report_category:l});null!=c&&r.add("reporting_user_id",c),null!=d&&r.add("report_description",d),a.post(t,r,i)}})}},{key:"reportMessage",value:function(e,i){var a=this,s=e.channelUrl,o=e.isOpenChannel,u=e.messageId,l=e.reportCategory,c=e.reportingUserId,d=e.reportDescription,h=e.offendingUserId;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.REPORT_MESSAGES.replace("%s",encodeURIComponent(o?"open_channels":"group_channels")).replace("%s",encodeURIComponent(s)).replace("%s",encodeURIComponent(u)),r=new G({report_category:l,offending_user_id:h});null!=c&&r.add("reporting_user_id",c),null!=d&&r.add("report_description",d),a.post(t,r,i)}})}},{key:"sendUserMessage",value:function(e,a){var s=this,o=e.channelUrl,u=e.isOpenChannel,l=e.message,c=e.data,d=e.customType,h=e.translationTargetLanguages,p=e.metaArrays,f=e.mentionType,_=e.mentionedUserIds,y=e.pushNotificationDeliveryOption;this.sb.ConnectionManager.ready(function(e,n){if(e)a(e,null);else{var t=s.cls.FileMessageParams,r=u?b.Path.OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",encodeURIComponent(o)):b.Path.GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",encodeURIComponent(o)),i=new G({message_type:"MESG",user_id:s.sb.currentUser.userId,message:l,mention_type:f,mentioned_user_ids:[]});null!=c&&i.add("data",c),null!=d&&i.add("custom_type",d),h&&i.add("translation_target_langs",h),p&&0<p.length&&i.add("sorted_metaarray",p.map(function(e){return e.encode()})),f===s.cls.BaseMessageParams.MentionType.CHANNEL?i.add("mentioned_user_ids",[]):Array.isArray(_)&&0<_.length&&i.add("mentioned_user_ids",_),y&&y!==t.PushNotificationDeliveryOption.DEFAULT&&i.add("push_option",y),s.post(r,i,a)}})}},{key:"sendFileMessage",value:function(e,a){var s=this,o=e.channelUrl,u=e.isOpenChannel,l=e.fileUrl,c=e.fileName,d=e.fileSize,h=e.fileType,p=e.data,f=e.customType,_=e.thumbnailSizes,y=e.requireAuth,g=e.metaArrays,m=e.mentionType,C=e.mentionedUserIds,v=e.pushNotificationDeliveryOption;this.sb.ConnectionManager.ready(function(e,n){if(e)a(e,null);else{var t=s.cls.FileMessageParams,r=u?b.Path.OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",encodeURIComponent(o)):b.Path.GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",encodeURIComponent(o)),i=new G({message_type:"FILE",user_id:s.sb.currentUser.userId,url:l,mention_type:m,mentioned_user_ids:[]});null!=c&&i.add("file_name",c),null!=d&&i.add("file_size",d),null!=h&&i.add("file_type",h),null!=p&&i.add("custom_field",p),null!=f&&i.add("custom_type",f),_&&i.add("thumbnails",_),y&&i.add("require_auth",y),g&&0<g.length&&i.add("sorted_metaarray",g.map(function(e){return e.encode()})),m===s.cls.BaseMessageParams.MentionType.CHANNEL?i.add("mentioned_user_ids",[]):Array.isArray(C)&&0<C.length&&i.add("mentioned_user_ids",C),v&&v!==t.PushNotificationDeliveryOption.DEFAULT&&i.add("push_option",v),s.post(r,i,a)}})}},{key:"uploadFile",value:function(e,a){var s=this,o=e.file,u=e.fileType,l=e.thumbnailSizes,c=e.channelUrl,d=e.progressHandler,h=e.reqId;this.sb.ConnectionManager.ready(function(e,n){if(e)a(e,null);else{var t=b.Path.STORAGE_FILE,r=new G;if(u&&"undefined"!=typeof Blob&&(te.isFile(o)||"string"==typeof o||Array.isArray(o)||o.hasOwnProperty("isRNFetchBlobPolyfill"))?r.add("file",new Blob([o],{type:u}),o.name):r.add("file",o,o.name),c&&"string"==typeof c&&r.add("channel_url",c),l)for(var i=0;i<l.length;i++)r.add("thumbnail"+(i+1),l[i].maxWidth+","+l[i].maxHeight);r.upload.reqId=h,r.upload.deleteRequest=function(){var e=s.cls.FileMessageQueue;e.uploadRequest[h]&&delete e.uploadRequest[h]},r.upload.progressHandler=function(e){d&&"function"==typeof d&&d(e,h)},s.post(t,r,a)}})}},{key:"registerScheduledUserMessage",value:function(e,i){var a=this,s=e.groupChannelParams,o=e.channelUrl,u=e.isOpenChannel;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=u?b.Path.OPENCHANNELS_CHANNELURL_SCHEDULED_MESSAGES.replace("%s",encodeURIComponent(o)):b.Path.GROUPCHANNELS_CHANNELURL_SCHEDULED_MESSAGES.replace("%s",encodeURIComponent(o)),r=new G({scheduled_dt:s._getScheduleString(),user_id:a.sb.currentUser.userId,message:s.message,data:s.data});s.customType&&r.add("custom_type",s.customType),s.metaArrayKeys&&0<Object.keys(s.metaArrayKeys).length&&r.add("metaarray",s.metaArrayKeys),s.mentionType&&r.add("mention_type",s._mentionType),s._mentionType===a.cls.BaseMessageParams.MentionType.CHANNEL?r.add("mentioned_user_ids",[]):Array.isArray(s._mentionedUserIds)&&0<s._mentionedUserIds.length&&r.add("mentioned_user_ids",s._mentionedUserIds),s.translationTargetLanguages&&0<s.translationTargetLanguages.length&&r.add("translation_target_langs",s.translationTargetLanguages),s.pushNotificationDeliveryOption&&s.pushNotificationDeliveryOption!==a.cls.BaseMessageParams.PushNotificationDeliveryOption.DEFAULT&&r.add("push_option",s.pushNotificationDeliveryOption),a.post(t,r,i)}})}},{key:"getMyPushTriggerOption",value:function(e,r){var i=this,a=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.USERS_USERID_PUSHPREFERENCE_CHANNELURL.replace("%s",encodeURIComponent(i.sb.currentUser.userId)).replace("%s",encodeURIComponent(a));i.get(t,null,r)}})}},{key:"setMyPushTriggerOption",value:function(e,i){var a=this,s=e.channelUrl,o=e.pushTriggerOption,u=e.enable;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_USERID_PUSHPREFERENCE_CHANNELURL.replace("%s",encodeURIComponent(a.sb.currentUser.userId)).replace("%s",encodeURIComponent(s)),r=new G;o&&r.add("push_trigger_option",o),"boolean"==typeof u&&r.add("enable",u),a.put(t,r,i)}})}},{key:"setMyCountPreference",value:function(e,i){var a=this,s=e.channelUrl,o=e.countPreference;this.sb.ConnectionManager.ready(function(e,n){if(e)i(e,null);else{var t=b.Path.USERS_COUNT_PREFERENCE.replace("%s",encodeURIComponent(a.sb.currentUser.userId)).replace("%s",encodeURIComponent(s)),r=new G({count_preference:o});a.put(t,r,i)}})}},{key:"resetMyHistory",value:function(e,r){var i=this,a=e.channelUrl;this.sb.ConnectionManager.ready(function(e,n){if(e)r(e,null);else{var t=b.Path.GROUPCHANNELS_RESET_USER_HISTORY.replace("%s",encodeURIComponent(a));i.put(t,null,r)}})}}],[{key:"Path",get:function(){return{USERS:"/users",USERS_USERID:"/users/%s",USERS_USERID_LOGIN:"/users/%s/login",USERS_USERID_METADATA:"/users/%s/metadata",USERS_USERID_METADATA_KEY:"/users/%s/metadata/%s",USERS_USERID_MARKASREADALL:"/users/%s/mark_as_read_all",USERS_USERID_MY_GROUP_CHANNEL_CHANGELOGS:"/users/%s/my_group_channels/changelogs",USERS_USERID_UNREAD_ITEM_COUNT:"/users/%s/unread_item_count",USERS_USERID_UNREAD_MESSAGE_COUNT:"/users/%s/unread_message_count",USERS_USERID_UNREAD_CHANNEL_COUNT:"/users/%s/unread_channel_count",USERS_USERID_PUSH_GCM_TOKEN:"/users/%s/push/gcm/%s",USERS_USERID_PUSH_GCM:"/users/%s/push/gcm",USERS_USERID_PUSH_DEVICE_TOKENS:"/users/%s/push/%s/device_tokens",USERS_USERID_PUSHPREFERENCE_CHANNELURL:"/users/%s/push_preference/%s",USERS_USERID_PUSHPREFERENCE:"/users/%s/push_preference/",USERS_USERID_PUSH_TEMPLATE:"/users/%s/push/template",USERS_USERID_BLOCK:"/users/%s/block",USERS_USERID_BLOCK_TARGETID:"/users/%s/block/%s",USERS_USERID_PUSH_APNS_TOKEN:"/users/%s/push/apns/%s",USERS_USERID_PUSH_APNS:"/users/%s/push/apns",USERS_USERID_PUSH:"/users/%s/push",USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE:"/users/%s/channel_invitation_preference",USERS_USERID_GROUP_CHANNEL_COUNT:"/users/%s/group_channel_count",USERS_COUNT_PREFERENCE:"/users/%s/count_preference/%s",OPENCHANNELS:"/open_channels",OPENCHANNELS_CHANNELURL:"/open_channels/%s",OPENCHANNELS_CHANNELURL_MESSAGES:"/open_channels/%s/messages",OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID:"/open_channels/%s/messages/%s",OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION:"/open_channels/%s/messages/%s/translation",OPENCHANNELS_CHANNELURL_SCHEDULED_MESSAGES:"/open_channels/%s/scheduled_messages",OPENCHANNELS_CHANNELURL_PARTICIPANTS:"/open_channels/%s/participants",OPENCHANNELS_CHANNELURL_METADATA:"/open_channels/%s/metadata",OPENCHANNELS_CHANNELURL_METADATA_KEY:"/open_channels/%s/metadata/%s",OPENCHANNELS_CHANNELURL_METACOUNTER:"/open_channels/%s/metacounter",OPENCHANNELS_CHANNELURL_METACOUNTER_KEY:"/open_channels/%s/metacounter/%s",OPENCHANNELS_CHANNELURL_BAN:"/open_channels/%s/ban",OPENCHANNELS_CHANNELURL_BAN_USERID:"/open_channels/%s/ban/%s",OPENCHANNELS_CHANNELURL_MUTE:"/open_channels/%s/mute",OPENCHANNELS_CHANNELURL_MUTE_USERID:"/open_channels/%s/mute/%s",OPENCHANNELS_CHANNELURL_FREEZE:"/open_channels/%s/freeze",GROUPCHANNELS:"/group_channels",MYGROUPCHANNELS:"/users/%s/my_group_channels",GROUPCHANNELS_CHANNELURL:"/group_channels/%s",GROUPCHANNELS_CHANNELURL_INVITE:"/group_channels/%s/invite",GROUPCHANNELS_CHANNELURL_ACCEPT_INVITATION:"/group_channels/%s/accept",GROUPCHANNELS_CHANNELURL_DECLINE_INVITATION:"/group_channels/%s/decline",GROUPCHANNELS_CHANNELURL_HIDE:"/group_channels/%s/hide",GROUPCHANNELS_CHANNELURL_LEAVE:"/group_channels/%s/leave",GROUPCHANNELS_CHANNELURL_JOIN:"/group_channels/%s/join",GROUPCHANNELS_CHANNELURL_MESSAGES:"/group_channels/%s/messages",GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASREAD:"/group_channels/%s/messages/mark_as_read",GROUPCHANNELS_CHANNELURL_MESSAGES_TOTALCOUNT:"/group_channels/%s/messages/total_count",GROUPCHANNELS_CHANNELURL_MESSAGES_UNREADCOUNT:"/group_channels/%s/messages/unread_count",GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID:"/group_channels/%s/messages/%s",GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION:"/group_channels/%s/messages/%s/translation",GROUPCHANNELS_CHANNELURL_SCHEDULED_MESSAGES:"/group_channels/%s/scheduled_messages",GROUPCHANNELS_CHANNELURL_MEMBERS:"/group_channels/%s/members",GROUPCHANNELS_CHANNELURL_METADATA:"/group_channels/%s/metadata",GROUPCHANNELS_CHANNELURL_METADATA_KEY:"/group_channels/%s/metadata/%s",GROUPCHANNELS_CHANNELURL_METACOUNTER:"/group_channels/%s/metacounter",GROUPCHANNELS_CHANNELURL_METACOUNTER_KEY:"/group_channels/%s/metacounter/%s",GROUPCHANNELS_RESET_USER_HISTORY:"/group_channels/%s/reset_user_history",GROUPCHANNELS_MEMBERS:"/group_channels/%s/members",GROUPCHANNELS_CHANNELURL_BAN:"/group_channels/%s/ban",GROUPCHANNELS_CHANNELURL_BAN_USERID:"/group_channels/%s/ban/%s",GROUPCHANNELS_CHANNELURL_MUTE:"/group_channels/%s/mute",GROUPCHANNELS_CHANNELURL_MUTE_USERID:"/group_channels/%s/mute/%s",GROUPCHANNELS_CHANNELURL_FREEZE:"/group_channels/%s/freeze",STORAGE_FILE:"/storage/file",STORAGE_PROFILE:"/storage/profile_image",OPENCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS:"/open_channels/%s/messages/changelogs",GROUPCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS:"/group_channels/%s/messages/changelogs",FRIENDS:"/users/%s/friends",FRIENDS_CHANGE_LOGS:"/users/%s/friends/changelogs",FRIENDS_DISCOVERIES:"/users/%s/friend_discoveries",GROUPCHANNELS_OPERATORS:"/group_channels/%s/operators",OPENCHANNELS_OPERATORS:"/open_channels/%s/operators",REPORT_USERS:"/report/users/%s",REPORT_CHANNELS:"/report/%s/%s",REPORT_MESSAGES:"/report/%s/%s/messages/%s"}}}]),b}(),B=function(){function t(e,n){_(this,t),this.sb=e,this.ws=null,this.wsHost=null,this.WebSocket=null,this.handler=n||new t.ConnectionHandler,this.explicitDisconnect=!1,this.lastActiveMillis=0;try{this.WebSocket="undefined"==typeof WebSocket?r:WebSocket}catch(e){this.WebSocket=WebSocket}}return s(t,[{key:"connect",value:function(e,n,t){var i=this;ne.debug("WSClient connect called");var r=$.get(this.sb._iid).container,a=r.pinger,s=r.auth;this.wsHost=t;try{var o="/?p=JS&pv="+encodeURIComponent(f.OS_VERSION)+"&sv="+encodeURIComponent(f.SDK_VERSION)+"&ai="+encodeURIComponent(this.sb.getApplicationId());if(s.sessionKey?o+="&key="+encodeURIComponent(s.sessionKey):o+="&user_id="+encodeURIComponent(e)+"&access_token="+encodeURIComponent(n),o+="&active=1",o+="&Request-Sent-Timestamp="+(new Date).getTime().toString(),this.ws=new this.WebSocket(this.wsHost+o),!this.ws)return this.sb.isReconnectingOnError=!0,void this.handler.onError("ws does not exist.")}catch(e){return this.sb.isReconnectingOnError=!0,void this.handler.onError(e)}try{this.sb.getDebugMode()&&"undefined"!=typeof window&&(window.ws=this.ws)}catch(e){ne.debug("window object does not exist.")}var u=!1;this.ws.onopen=function(e){ne.debug("WSClient onopen called"),i.handler.onOpen(e)},this.ws.onmessage=function(e){i.active();var n=e.data.split("\n");for(var t in n){var r=n[t];if(r&&"string"==typeof r){try{if("PONG"===r.substring(0,4)){a.pong();continue}}catch(e){ne.debug("ws.onmessage-command check error: ",e)}i.handler.onMessage(r)}}},this.ws.onerror=function(e){ne.debug("WSClient ws.onerror called: ",e),a&&a.stop(),u=!0,i.sb.isReconnectingOnError=!0,i.handler.onError(e)},this.ws.onclose=function(e){ne.debug("WSClient ws.onclose called - e, explicitDisconnect: ",e,i.explicitDisconnect),a&&a.stop(),i.explicitDisconnect?i.handler.onClose(e):u||i.handler.onError(e),i.explicitDisconnect=!1}}},{key:"disconnect",value:function(e,n){ne.debug("WSClient disconnect called [explicit]: ",e);var t=$.get(this.sb._iid).container.pinger;t&&t.stop(),this.explicitDisconnect=!0===e,this.ws&&(this.ws.onopen=function(){},this.ws.onmessage=function(){},this.ws.onclose=function(){n&&n()},this.ws.onerror=function(){},this.ws.close(),this.ws=null),this.explicitDisconnect?this.handler.onClose():this.handler.onError(),this.explicitDisconnect=!1}},{key:"send",value:function(e,n){1!==this.ws.readyState?n&&n(new ee("Connection is not valid. Please reconnect.",ee.WEBSOCKET_CONNECTION_CLOSED),null):(this.ws.send(e.encode()),n&&n(null,null))}},{key:"active",value:function(){this.lastActiveMillis=(new Date).getTime()}},{key:"getConnectionState",value:function(){try{return 1===this.ws.readyState?this.sb.ConnectionState.OPEN:0===this.ws.readyState?this.sb.ConnectionState.CONNECTING:this.sb.ConnectionState.CLOSED}catch(e){return this.sb.ConnectionState.CLOSED}}}]),t}();B.ConnectionHandler=function(){return function e(){_(this,e),this.onReady=function(){},this.onOpen=function(){},this.onClose=function(){},this.onMessage=function(){},this.onError=function(){}}}();var Q=function(){function n(e){_(this,n),this.sb=e,this.cls=L.get(this.sb._iid),this.ws=new B(this.sb),this.reconnectParams={interval:3,retryCount:3,multiplier:2,maxInterval:24},this.reconnectCount=0,this.reconnectDelay=0}return s(n,[{key:"connect",value:function(t,r){var i=this,e=$.get(this.sb._iid).container,n=e.auth,a=e.apiClient,s=e.commandHandler,o=this.cls.GroupChannel,u=new B.ConnectionHandler;this.ws=new B(this.sb,u),u.onMessage=function(e){s.onRawCommandReceived(e)},this.sb.loginHandler=function(e,n){if(i.sb.connecting=!1,e)i.disconnect({clearSession:!0,err:e},null);else{clearInterval(i.sb.globalTimer);var t=function(){if(o.cachedChannels)for(var e in o.cachedChannels){var n=o.cachedChannels[e];if(n.invalidateTypingStatus())for(var t in i.sb.channelHandlers){i.sb.channelHandlers[t].onTypingStatusUpdated(n)}}};t(),i.sb.globalTimer=setInterval(function(){return t()},1e3),i.flushConnectionCallbacks(null,n),i.sb.connecting=!1,i.sb.reconnecting=!1,i.sb.ConnectionManager.processAllReadyHandler(null)}},u.onOpen=function(){i.sb.loginTimer=setTimeout(function(){i.sb.loginTimer=null,i.sb.onLoginTimerCancel=null,i.flushConnectionCallbacks(new ee("Connection timeout.",ee.LOGIN_TIMEOUT),null),i.sb.disconnect(null)},f.COMMAND_ACK_TIMEOUT),i.sb.onLoginTimerCancel=function(){i.flushConnectionCallbacks(new ee("Connection has been canceled.",ee.REQUEST_FAILED),null)},i.sb.connecting=!1},u.onError=function(e){ne.debug("WebSocketClient.ConnectionHandler.onError",e),n.sessionKey?(i.sb.isReconnectingOnError=!0,i.sb.ConnectionManager.errorAllReadyHandler(),i.reconnect(t,!0)):i.flushConnectionCallbacks(new ee("Websocket connection failed.",ee.WEBSOCKET_CONNECTION_FAILED),null),i.sb.connecting=!1},u.onClose=function(){ne.debug("WebSocketClient.ConnectionHandler.onClose"),i.sb.connecting=!1},a.checkRouting(function(e,n){if(e)return i.sb.connecting=!1,void i.flushConnectionCallbacks(new ee("Connection routing failed.",ee.REQUEST_FAILED),null);a.get("/",null,function(){}),i.ws.connect(t,r,n.wsHost)})}},{key:"reconnect",value:function(t,e){var i=this,n=!(1<arguments.length&&void 0!==e)||e,r=$.get(this.sb._iid).container,a=r.auth,s=r.apiClient,o=r.commandHandler,u=this.cls.OpenChannel;if(this.sb.reconnecting=!0,this.sb.reconnectTimer)ne.debug("still reconnecting");else{if(this.reconnectCount+=1,this.reconnectCount<=1){if(n)for(var l in this.sb.connectionHandlers){this.sb.connectionHandlers[l].onReconnectStarted()}this.reconnectDelay=0}else this.reconnectDelay=Math.min(1e3*this.reconnectParams.interval*Math.pow(this.reconnectParams.multiplier,this.reconnectCount-2),0<this.reconnectParams.maxInterval?1e3*this.reconnectParams.maxInterval:Number.MAX_SAFE_INTEGER);if(!t||!a.sessionKey||0<this.reconnectParams.retryCount&&this.reconnectCount>this.reconnectParams.retryCount){for(var c in this.disconnect({clearSession:!1,err:new ee("Websocket connection failed.",ee.WEBSOCKET_CONNECTION_FAILED)},null),this.reconnectCount=0,this.sb.connectionHandlers){this.sb.connectionHandlers[c].onReconnectFailed()}return this.sb.connecting=!1,this.sb.reconnecting=!1,this.sb.isReconnectingOnError=!1,void this.sb.ConnectionManager.errorAllReadyHandler()}this.sb.onReconnectTimerCancel=function(){i.reconnectCount=0},this.sb.reconnectTimer=setTimeout(function(){i.sb.reconnectTimer=null,i.sb.onReconnectTimerCancel=null,i.ws&&i.ws.disconnect(!0);var e=new B.ConnectionHandler;i.ws=new B(i.sb,e),i.sb.loginHandler=function(){for(var e in i.reconnectCount=0,i.sb.connecting=!1,i.sb.reconnecting=!1,i.sb.isReconnectingOnError=!1,i.sb.connectionHandlers){i.sb.connectionHandlers[e].onReconnectSucceeded()}if(i.sb.ConnectionManager.processAllReadyHandler(null),i.sb.isReconnectingOnError)for(var n in i.sb.ConnectionManager.networkHandlers)i.sb.ConnectionManager.networkHandlers[n].onReconnected();Object.keys(u.enteredChannels).forEach(function(r){u.enteredChannels[r].enter(function(e,n){if(e){var t=i.cls.FileMessageQueue;delete u.enteredChannels[r],t.delete(r)}})})},e.onOpen=function(){ne.debug("reconnect onOpen"),i.sb.loginTimer=setTimeout(function(){ne.debug("reconnect loginTimer timeout"),i.sb.loginTimer=null,i.reconnect(t,!0)},f.COMMAND_ACK_TIMEOUT),i.sb.onLoginTimerCancel=null,i.sb.reconnecting=!1},e.onMessage=function(e){o.onRawCommandReceived(e)},e.onError=function(e){ne.debug("reconnect onError",e),i.sb.isReconnectingOnError=!0,i.sb.ConnectionManager.errorAllReadyHandler(),i.reconnect(t,!0)},e.onClose=function(){ne.debug("reconnect onClose"),i.sb.reconnecting=!1},s.checkRouting(function(e,n){e?i.reconnect(t,!0):(i.sb.getCurrentApiHost()!==n.apiHost&&s.get("/",null,function(){}),i.ws.connect(t,null,n.wsHost))})},this.reconnectDelay)}}},{key:"disconnect",value:function(e,n){var t=$.get(this.sb._iid),r=t.container.ackStateMap,i=this.cls,a=i.GroupChannel,s=i.OpenChannel,o=e.clearSession,u=e.err;if(this.sb.loginTimer&&(clearTimeout(this.sb.loginTimer),this.sb.onLoginTimerCancel&&(this.sb.onLoginTimerCancel(),this.sb.onLoginTimerCancel=null),this.sb.loginTimer=null),this.sb.reconnectTimer&&(clearTimeout(this.sb.reconnectTimer),this.sb.onReconnectTimerCancel&&(this.sb.onReconnectTimerCancel(),this.sb.onReconnectTimerCancel=null),this.sb.reconnectTimer=null),this.ws&&(this.reconnectCount=0,this.ws.disconnect(!0),this.ws=null),o){for(var l in s.clearEnteredChannels(),s.clearCache(),a.clearCache(),this.sb.globalTimer&&(clearInterval(this.sb.globalTimer),this.sb.globalTimer=null),r)clearTimeout(r[l].timer);this.sb.currentUser=null,t.set("ackStateMap",{}),t.set("subscribedUnreadMessageCount",{all:0,custom_types:{},ts:0}),t.set("auth",new R)}u&&(this.flushConnectionCallbacks(u,null),this.sb.connecting=!1,this.sb.reconnecting=!1,this.sb.isReconnectingOnError=!1),n&&n(null,null)}},{key:"flushConnectionCallbacks",value:function(n,t){var e=this.sb.connectionCallbacks;this.sb.connectionCallbacks=[],e.forEach(function(e){return e(n,t)})}}]),n}(),x=function(){function f(e){var n=e.type,t=e.nullable,r=void 0!==t&&t,i=e.optional,a=void 0!==i&&i,s=e.optionalIf,o=void 0===s?null:s,u=e.ignoreIf,l=void 0===u?null:u,c=e.defaultValue,d=void 0===c?null:c,h=e.constraint,p=void 0===h?null:h;_(this,f),this.type=n,this.nullable=r,this.optional=a,this.optionalIf=o,this.ignoreIf=l,this.defaultValue=d,this.constraint=p}return s(f,[{key:"isMatchingType",value:function(t){function n(e,n){return"string"==typeof n?Z(e)===n||"array"===n&&Array.isArray(e)||"file"===n&&te.isFile(e)||"null"===n&&null===e||"date"===n&&e instanceof Date:"function"==typeof n?e instanceof n:"object"===Z(n)&&-1<Object.keys(n).map(function(e){return n[e]}).indexOf(t)}return n(t,this.type)||Array.isArray(this.type)&&this.type.some(function(e){return n(t,e)})||this.nullable&&null===t}}],[{key:"parse",value:function(e,n){for(e=f.toArray(e);void 0===e[e.length-1];)e.pop();var t=!1,r=null;"callback"===n[n.length-1].type&&("function"==typeof e[e.length-1]&&(r=e.pop()),n.pop(),t=!0);var i=[],a=null,s=0;for(var o in n){var u=n[o];"function"==typeof u.ignoreIf&&u.ignoreIf(e)?i.push(u.hasOwnProperty("defaultValue")?u.defaultValue:null):u.isMatchingType(e[s])?(u.nullable&&null===e[s]||!u.constraint||u.constraint(e[s])||(a=f.error),i.push(e[s]),s++):u.optional||"function"==typeof u.optionalIf&&u.optionalIf(e)?i.push(u.hasOwnProperty("defaultValue")?u.defaultValue:null):(a=f.error,i.push(e[s]),s++)}return t&&r&&i.push(r),e.length!==s&&(a=f.error),[a].concat(i)}},{key:"toArray",value:function(e){for(var n=[],t=0;t<e.length;t++)n.push(e[t]);return n}},{key:"error",get:function(){return new ee("Invalid parameter.",ee.INVALID_PARAMETER)}}]),f}(),z=function(){function n(e){_(this,n),this.sb=e,this.authCount=0,this.readyHandlers=[],this.networkHandlers={},this.authenticateTimer=1e4,this.authInfoRequester=null}return s(n,[{key:"addReadyHandler",value:function(e){e&&"function"==typeof e&&this.readyHandlers.push(e)}},{key:"ready",value:function(e,n){var t=!(1<arguments.length&&void 0!==n)||n,r=$.get(this.sb._iid).container,i=r.auth,a=r.isInBackground;t&&i.hasSession()?e&&(e(null,this.sb.currentUser),this.sb.getConnectionState()!==this.sb.ConnectionState.CLOSED||a||this.sb.reconnect()):(this.addReadyHandler(e),this.sb.isReconnectingOnError?this.errorAllReadyHandler():this.sb.getConnectionState()===this.sb.ConnectionState.OPEN?this.processAllReadyHandler(null):this.sb.getConnectionState()===this.sb.ConnectionState.CONNECTING||this.errorAllReadyHandler())}},{key:"processAllReadyHandler",value:function(n){var t=this;if(0<this.readyHandlers.length){var e=this.readyHandlers;this.readyHandlers=[],e.forEach(function(e){e&&"function"==typeof e&&e(n,t.sb.currentUser)})}}},{key:"errorAllReadyHandler",value:function(){this.processAllReadyHandler(new ee("Connection should be made first.",ee.CONNECTION_REQUIRED))}},{key:"NetworkHandler",value:function(){this.onReconnected=function(){}}},{key:"addNetworkHandler",value:function(e,n){this.networkHandlers[e]=n}},{key:"removeNetworkHandler",value:function(e){delete this.networkHandlers[e]}},{key:"removeAllNetworkHandler",value:function(){this.networkHandlers={}}},{key:"authenticate",value:function(t){var r=this;if(this.sb.getConnectionState()===this.sb.ConnectionState.OPEN||this.sb.reconnecting)this.sb.connecting=!1,t(null,this.sb.currentUser);else if(this.authInfoRequester&&"function"==typeof this.authInfoRequester){this.sb.connecting=!0,this.authCount++;var i=setTimeout(function(){i=null,r.authCount--,0===r.authCount&&0===r.sb.connectionCallbacks.length&&(r.sb.connecting=!1),r.errorAllReadyHandler(),t(new ee("Connection should be made first.",ee.CONNECTION_REQUIRED),null)},this.authenticateTimer);this.authInfoRequester(function(e){if(i){clearTimeout(i),i=null,r.authCount--;var n=function(e,n){r.sb.connecting=!1,t(e,null)};e&&e.hasOwnProperty("userId")?e.accessToken?e.apiHost&&e.wsHost?r.sb.connect(e.userId,e.accessToken,e.apiHost,e.wsHost,n):r.sb.connect(e.userId,e.accessToken,n):e.apiHost&&e.wsHost?r.sb.connect(e.userId,e.apiHost,e.wsHost,n):r.sb.connect(e.userId,n):t(x.error,null)}})}else t(x.error,null)}}]),n}(),j=function(){function n(e){_(this,n),this.sb=e}return s(n,[{key:"onlineWorker",value:function(){try{if("undefined"!=typeof navigator&&navigator.onLine){var e=$.get(this.sb._iid).container.auth;this.sb.reconnecting||this.sb.connecting||!e.sessionKey||this.sb.getConnectionState()===this.sb.ConnectionState.OPEN||this.sb.reconnect()}}catch(e){ne.debug("There is no window.addEventListener.ononline or navigator.onLine")}}},{key:"offlineWorker",value:function(){try{if("undefined"!=typeof navigator&&!navigator.onLine){var e=$.get(this.sb._iid).container,n=e.auth,t=e.pinger;this.sb.reconnecting||this.sb.connecting||!n.sessionKey||(t&&t.stop(),this.sb.reconnect())}}catch(e){ne.debug("There is no window.addEventListener.ononline or navigator.onLine")}}},{key:"start",value:function(){try{"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&"boolean"==typeof navigator.onLine&&(window.addEventListener("online",this.onlineWorker),window.addEventListener("offline",this.offlineWorker))}catch(e){ne.debug("There is no window.addEventListener.ononline or navigator.onLine")}}},{key:"stop",value:function(){try{window.removeEventListener("online",this.onlineWorker,!1),window.removeEventListener("offline",this.offlineWorker,!1)}catch(e){ne.debug("There is no window.addEventListener.ononline or navigator.onLine")}}}]),n}(),Y=(new Date).getTime(),K=function(){function i(e,n){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;switch(_(this,i),this.command=e,this.requestId=t,arguments.length){case 1:if(!e||e.length<=4)this.command="NOOP",this.payload="{}";else if(this.decode(e),this.isRequestIdCommand){var r=this.getJsonElement();r&&(this.requestId=r.req_id||"")}break;case 2:case 3:!this.requestId&&this.isRequestIdCommand&&(this.requestId=i.generateRequestId()),n.req_id=this.requestId||"",this.payload=JSON.stringify(n)}}return s(i,[{key:"encode",value:function(){return this.command+this.payload+"\n"}},{key:"decode",value:function(e){e=e.trim(),this.command=e.substring(0,4),this.payload=e.substring(4)}},{key:"getJsonElement",value:function(){return JSON.parse(this.payload)}},{key:"isRequestIdCommand",get:function(){return this.isAckRequired||"EROR"===this.command}},{key:"isAckRequired",get:function(){return"MESG"===this.command||"FILE"===this.command||"ENTR"===this.command||"EXIT"===this.command||"READ"===this.command||"MEDI"===this.command||"FEDI"===this.command}}],[{key:"bPing",value:function(){return new this("PING",{id:(new Date).getTime(),active:1})}},{key:"bMessage",value:function(e){var n=e.channelUrl,t=e.message,r=e.data,i=e.customType,a=e.metaArrays,s=e.mentionType,o=e.mentionedUserIds,u=e.translationTargetLanguages,l=e.pushNotificationDeliveryOption,c=e.requestId,d=void 0===c?null:c,h=L.get(this._iid),p=h.UserMessageParams,f=h.BaseMessageParams,_={};return _.channel_url=n,_.message=t,_.data=r,a&&0<a.length&&(_.metaarray=a.map(function(e){return e.encode()})),s&&(_.mention_type=s),_.mentioned_user_ids=[],s===f.MentionType.CHANNEL?_.mentioned_user_ids=[]:Array.isArray(o)&&0<o.length&&(_.mentioned_user_ids=o),i&&(_.custom_type=i),u&&0<u.length&&(_.target_langs=u),l&&l!==p.PushNotificationDeliveryOption.DEFAULT&&(_.push_option=l),new this("MESG",_,d)}},{key:"bFile",value:function(e){var n=e.channelUrl,t=e.url,r=e.name,i=e.type,a=e.size,s=e.data,o=e.customType,u=e.thumbnailSizes,l=e.requireAuth,c=e.metaArrays,d=e.mentionType,h=e.mentionedUserIds,p=e.pushNotificationDeliveryOption,f=e.requestId,_=void 0===f?null:f,y=L.get(this._iid),g=y.BaseMessageParams,m=y.FileMessageParams,C={};return C.channel_url=n,C.url=t,C.name=r||"",C.type=i||"",C.size=a||0,C.custom=s,o&&(C.custom_type=o),u&&(C.thumbnails=u),l&&(C.require_auth=l),c&&0<c.length&&(C.metaarray=c.map(function(e){return e.encode()})),d&&(C.mention_type=d),C.mentioned_user_ids=[],d===g.MentionType.CHANNEL?C.mentioned_user_ids=[]:Array.isArray(h)&&0<h.length&&(C.mentioned_user_ids=h),p&&p!==m.PushNotificationDeliveryOption.DEFAULT&&(C.push_option=p),new this("FILE",C,_)}},{key:"bUpdateUserMessage",value:function(e){var n=e.channelUrl,t=e.messageId,r=e.message,i=void 0===r?null:r,a=e.data,s=void 0===a?null:a,o=e.customType,u=void 0===o?null:o,l=e.mentionType,c=void 0===l?null:l,d=e.mentionedUserIds,h=void 0===d?null:d,p=e.metaArrayParams,f=void 0===p?null:p,_=L.get(this._iid).BaseMessageParams,y={};return y.channel_url=n,y.msg_id=t,null!=i&&void 0!==i&&(y.message=i),null!=s&&void 0!==s&&(y.data=s),null!=u&&void 0!==u&&(y.custom_type=u),c&&(y.mention_type=c),c===_.MentionType.CHANNEL?y.mentioned_user_ids=[]:Array.isArray(h)&&0<h.length&&(y.mentioned_user_ids=h),f&&(y.metaarray=f),new this("MEDI",y)}},{key:"bUpdateFileMessage",value:function(e){var n=e.channelUrl,t=e.messageId,r=e.data,i=void 0===r?null:r,a=e.customType,s=void 0===a?null:a,o=e.mentionType,u=void 0===o?null:o,l=e.mentionedUserIds,c=void 0===l?null:l,d=e.metaArrayParams,h=void 0===d?null:d,p=L.get(this._iid).BaseMessageParams,f={};return f.channel_url=n,f.msg_id=t,null!=i&&void 0!==i&&(f.data=i),null!=s&&void 0!==s&&(f.custom_type=s),u&&(f.mention_type=u),u===p.MentionType.CHANNEL?f.mentioned_user_ids=[]:Array.isArray(c)&&0<c.length&&(f.mentioned_user_ids=c),h&&(f.metaarray=h),new this("FEDI",f)}},{key:"bRead",value:function(e){var n=e.channelUrl,t={};return t.channel_url=n,new this("READ",t)}},{key:"bTypeStart",value:function(e){var n=e.channelUrl,t=e.time,r={};return r.channel_url=n,r.time=t,new this("TPST",r)}},{key:"bTypeEnd",value:function(e){var n=e.channelUrl,t=e.time,r={};return r.channel_url=n,r.time=t,new this("TPEN",r)}},{key:"bEnter",value:function(e){var n=e.channelUrl,t={};return t.channel_url=n,new this("ENTR",t)}},{key:"bExit",value:function(e){var n=e.channelUrl,t={};return t.channel_url=n,new this("EXIT",t)}},{key:"generateRequestId",value:function(){return String(++Y)}}]),i}();function V(t,e,r){return void 0===r?new se(function(t,r){e(function(e,n){return e?r(e):t(n)})}):e(function(e,n){r&&($.get(t).container.isErrorFirstInCallback?r(e,n):r(n,e))})}var W=function(){function e(){_(this,e)}return s(e,null,[{key:"serialize",value:function(e,n){var t=1<arguments.length&&void 0!==n?n:null,r=JSON.parse(JSON.stringify(e));return t&&t(r),function n(t){return Object.keys(t).forEach(function(e){t[e]&&"object"===Z(t[e])&&n(t[e])}),Object.freeze(t)}(r)}},{key:"deserialize",value:function(e,n){var t=1<arguments.length&&void 0!==n?n:null,r=JSON.parse(JSON.stringify(e));return t&&t(r),r}}]),e}(),J=function(){function n(e){_(this,n),this.messageId=0,this.messageType=n.MESSAGE_TYPE_BASE,this.channelUrl="",this.data=null,this.customType=null,this.createdAt=0,this.updatedAt=0,this.channelType=null,this.metaArrays=[],this.mentionType=null,this.mentionedUsers=[],e&&this.__update(e)}return s(n,[{key:"serialize",value:function(){return W.serialize(this,function(e){e.hasOwnProperty("_sender")&&(e.sender=e._sender,delete e._sender)})}},{key:"isIdentical",value:function(e){return!("object"!==Z(e)||!e.hasOwnProperty("messageId"))&&(0!==this.messageId&&0!==e.messageId?this.messageId===e.messageId:this.reqId===e.reqId)}},{key:"isEqual",value:function(e){return te.deepEqual(this,e)}},{key:"isOpenChannel",value:function(){var e=L.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_OPEN}},{key:"isGroupChannel",value:function(){var e=L.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_GROUP}},{key:"isUserMessage",value:function(){return this.messageType===n.MESSAGE_TYPE_USER}},{key:"isAdminMessage",value:function(){return this.messageType===n.MESSAGE_TYPE_ADMIN}},{key:"isFileMessage",value:function(){return this.messageType===n.MESSAGE_TYPE_FILE}},{key:"__update",value:function(e){var t=this,n=L.get(this._iid),r=n.User,i=n.BaseChannel,a=n.BaseMessageParams,s=n.MessageMetaArray;e.hasOwnProperty("msg_id")&&(this.messageId=parseInt(e.msg_id)),e.hasOwnProperty("message_id")&&(this.messageId=parseInt(e.message_id)),this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.data=e.hasOwnProperty("data")?String(e.data):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.createdAt=e.hasOwnProperty("ts")?parseInt(e.ts):0,e.hasOwnProperty("created_at")&&(this.createdAt=parseInt(e.created_at)),this.updatedAt=e.hasOwnProperty("updated_at")?parseInt(e.updated_at):0,this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):i.CHANNEL_TYPE_GROUP;var o=e.hasOwnProperty("metaarray")?e.metaarray:{},u=e.hasOwnProperty("metaarray_key_order")?e.metaarray_key_order:Object.keys(o).sort(function(e,n){return e.localeCompare(n)});this.metaArrays=[];for(var l=0;l<u.length;l++){var c=u[l];this.metaArrays.push(new s(c,o[c]||[]))}this.mentionType=e.hasOwnProperty("mention_type")?e.mention_type:a.MentionType.USERS,this.mentionedUsers=[],e.hasOwnProperty("mentioned_users")&&e.mentioned_users.forEach(function(e){var n=new r(e);t.mentionedUsers.push(n)})}},{key:"getMetaArraysByKeys",value:function(n){return Array.isArray(n)?this.metaArrays.filter(function(e){return-1<n.indexOf(e.key)}):[]}},{key:"getMetaArrayByKeys",value:function(e){var n={};return this.getMetaArraysByKeys(e).forEach(function(e){n[e.key]=e.value}),n}},{key:"metaArray",get:function(){var n={};return this.metaArrays.forEach(function(e){n[e.key]=e.value}),n},set:function(e){if("object"===Z(e)&&e){var n=L.get(this._iid).MessageMetaArray,t=[];for(var r in e)t.push(new n(r,e[r]));this.metaArrays=t}}}],[{key:"MESSAGE_TYPE_BASE",get:function(){return"base"}},{key:"MESSAGE_TYPE_ADMIN",get:function(){return"admin"}},{key:"MESSAGE_TYPE_USER",get:function(){return"user"}},{key:"MESSAGE_TYPE_FILE",get:function(){return"file"}},{key:"MessageRequestState",get:function(){return{NONE:"none",PENDING:"pending",FAILED:"failed",SUCCEEDED:"succeeded"}}}]),n}(),X=0,re=1,ie=2,ae=function(){function u(e){var n=this;_(this,u),this.state=X,this._value=null,this._reason=null;e(function(e){n.state===X&&(n.state=re,n._value=e)},function(e){n.state===X&&(n.state=ie,n._reason=e)})}return s(u,[{key:"then",value:function(e,n){var t=this,r=this;switch(this.state){case X:setTimeout(function(){return t.then(e,n)},100);break;case re:e&&"function"==typeof e&&(r=e(this._value));break;case ie:n&&"function"==typeof n&&(r=n(this._reason))}return r instanceof u?r:this}},{key:"catch",value:function(e){var n=this,t=this;switch(this.state){case X:setTimeout(function(){return n.catch(e)},100);break;case re:break;case ie:t=e(this._reason)}return t instanceof u?t:this}},{key:"finally",value:function(e){var n=this,t=this;switch(this.state){case X:setTimeout(function(){return n.finally(e)},100);break;case re:case ie:t=e()}return t instanceof u?t:this}},{key:"length",get:function(){return 1}}],[{key:"all",value:function(o){return new u(function(a,s){Array.isArray(o)||"string"==typeof o?function(){var e=[];for(var n in o)o[n]instanceof Promise?e.push(o[n]):e.push(u.resolve(o[n]));var t=e.length;function r(e,n){--t<=0?a(n):e&&s(e)}for(var i in e){e[i].then(function(e){r(null,e)}).catch(function(e){t++,r(e,null)})}}():s(new Error("Uncaught (in promise) TypeError: ".concat(Z(o)," ").concat(o," is not iterable")))})}},{key:"resolve",value:function(t){return new u(function(e,n){e(t)})}},{key:"reject",value:function(t){return new u(function(e,n){n(t)})}}]),u}(),se=function(){try{return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent&&-1<navigator.userAgent.indexOf("Trident/7")}catch(e){return!1}}()||m()||C()||v()?ae:Promise,oe=function(){function n(e){_(this,n),this.nickname="",this.profileUrl="",this.userId="",this.connectionStatus="",this.lastSeenAt=null,this.metaData={},this.isActive=!0,this.friendDiscoveryKey=null,this.friendName=null,this._preferredLanguages=null,e&&this.__update(e)}return s(n,[{key:"__update",value:function(e){e.hasOwnProperty("guest_id")&&(this.userId=String(e.guest_id)),e.hasOwnProperty("user_id")&&(this.userId=String(e.user_id)),e.hasOwnProperty("name")&&(this.nickname=String(e.name)),e.hasOwnProperty("nickname")&&(this.nickname=String(e.nickname)),e.hasOwnProperty("image")&&(this.profileUrl=String(e.image)),e.hasOwnProperty("profile_url")&&(this.profileUrl=String(e.profile_url)),e.hasOwnProperty("is_online")?e.is_online===n.NON_AVAILABLE?this.connectionStatus=n.NON_AVAILABLE:this.connectionStatus=e.is_online?n.ONLINE:n.OFFLINE:this.connectionStatus=n.NON_AVAILABLE,e.hasOwnProperty("last_seen_at")?this.lastSeenAt=parseInt(e.last_seen_at):this.lastSeenAt=0,e.hasOwnProperty("metadata")?this.metaData=e.metadata:this.metaData={},e.hasOwnProperty("is_active")?this.isActive=void 0===e.is_active||e.is_active:this.isActive=!0,e.hasOwnProperty("friend_discovery_key")?this.friendDiscoveryKey=e.friend_discovery_key:this.friendDiscoveryKey=null,e.hasOwnProperty("friend_name")?this.friendName=e.friend_name:this.friendName=null,e.hasOwnProperty("preferred_languages")?this._preferredLanguages=e.preferred_languages:this._preferredLanguages=null}},{key:"_updateMetaData",value:function(e,n){var t=1<arguments.length&&void 0!==n&&n,r=L.get(this._iid).GroupChannel;for(var i in e)t?delete this.metaData[i]:this.metaData[i]=e[i];for(var a in r.cachedChannels)if(r.cachedChannels.hasOwnProperty(a)){var s=r.cachedChannels[a];if(s.memberMap.hasOwnProperty(this.userId))s.memberMap[this.userId].metaData=this.metaData}}},{key:"serialize",value:function(){return W.serialize(this,function(e){e.hasOwnProperty("_preferredLanguages")&&(e.preferredLanguages=e._preferredLanguages,delete e._preferredLanguages)})}},{key:"getOriginalProfileUrl",value:function(){var e="";if((-1<(e=(e=-1<this.profileUrl.indexOf("://")?this.profileUrl.split("/")[2]:this.profileUrl.split("/")[0]).split("?")[0]).indexOf("sendbird.com")||-1<e.indexOf("intoz.com"))&&-1<this.profileUrl.indexOf(e+"/profile_images/")){var n=this.profileUrl.replace("profile_images/","");return n===this.profileUrl?"":n}return""}},{key:"createMetaData",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"object",constraint:function(e){return 0<Object.keys(e).length&&!Array.isArray(e)}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.createUserMetaData({metaData:e},function(e,n){e||i._updateMetaData(n),t(e,n)})},n)}},{key:"updateMetaData",value:function(e,n,t){var r,i=this,a=g(x.parse(arguments,[new x({type:"object",constraint:function(n){return!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new x({type:"boolean",optional:!0,defaultValue:!1}),new x({type:"callback"})]),4);return r=a[0],e=a[1],n=a[2],t=a[3],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.updateUserMetaData({metaData:e,upsert:n},function(e,n){e||i._updateMetaData(n),t(e,n)})},t)}},{key:"deleteMetaData",value:function(e,n){var i,a=this,t=g(x.parse(arguments,[new x({type:"string",constraint:function(e){return 0<e.length}}),new x({type:"callback"})]),3);return i=t[0],e=t[1],n=t[2],V(this._iid,function(t){if(i)t(i,null);else{var r={};r[e]="",$.get(a._iid).container.apiClient.deleteUserMetaData({metaDataKey:e},function(e,n){e||a._updateMetaData(r,!0),t(e,n)})}},n)}},{key:"deleteAllMetaData",value:function(e){var i=this;return V(this._iid,function(t){var r=i.metaData;$.get(i._iid).container.apiClient.deleteAllUserMetaData({},function(e,n){e||i._updateMetaData(r,!0),t(e,n)})},e)}},{key:"preferredLanguages",get:function(){return this._preferredLanguages}}],[{key:"build",value:function(e,n,t,r,i,a,s,o,u,l){return{user_id:e,nickname:n,profile_url:t,is_online:r,last_seen_at:i,metadata:a,is_active:s,friend_discovery_key:o,friend_name:u,preferred_languages:l}}},{key:"buildFromSerializedData",value:function(e){var n=L.get(this._iid).User,t=W.deserialize(e);return new n(n.build.apply(n,E(["userId","nickname","profileUrl","connectionStatus","lastSeenAt","metaData","isActive","friendDiscoveryKey","friendName","preferredLanguages"].map(function(e){return t[e]}))))}},{key:"NON_AVAILABLE",get:function(){return"nonavailable"}},{key:"ONLINE",get:function(){return"online"}},{key:"OFFLINE",get:function(){return"offline"}}]),n}(),ue={TIMESTAMP:"timestamp",MESSAGE_ID:"messageId"},le=function(){function n(e){_(this,n),this.url="",this.channelType=n.CHANNEL_TYPE_BASE,this.name="",this.coverUrl="",this.createdAt=0,this.data=null,this.customType=null,this.isFrozen=!1,this.isEphemeral=!1,e&&(this.__update(e),e.__wk&&(this.__wk=e.__wk))}return s(n,[{key:"__update",value:function(e){this.url=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.name=e.hasOwnProperty("name")?String(e.name):"",this.coverUrl=e.hasOwnProperty("cover_url")?String(e.cover_url):"",this.createdAt=e.hasOwnProperty("created_at")?1e3*e.created_at:0,this.data=e.hasOwnProperty("data")?String(e.data):"",this.customType=e.hasOwnProperty("custom_type")?e.custom_type:"",this.isFrozen=!!e.hasOwnProperty("freeze")&&e.freeze,this.isEphemeral=!!e.hasOwnProperty("is_ephemeral")&&e.is_ephemeral}},{key:"_getMessageList",value:function(e,n,t,r,a,s,o,u,l,c,d,i){var h,p=this,f=g(x.parse(arguments,[new x({type:"object"}),new x({type:"number"}),new x({type:ue}),new x({type:"boolean"}),new x({type:"number"}),new x({type:"number"}),new x({type:"boolean"}),new x({type:"string",nullable:!0,constraint:function(e){return-1<["","MESG","FILE","ADMM"].indexOf(e)}}),new x({type:"string"}),new x({type:"array",optional:!0,defaultValue:[],constraint:function(e){return e.reduce(function(e,n){return e&&"string"==typeof n},!0)}}),new x({type:"boolean",optional:!0,defaultValue:!1}),new x({type:"callback"})]),13);return h=f[0],e=f[1],n=f[2],t=f[3],r=f[4],a=f[5],s=f[6],o=f[7],u=f[8],l=f[9],c=f[10],d=f[11],i=f[12],V(this._iid,function(i){h?i(h,null):$.get(p._iid).container.apiClient.getMessageList({channel:e,token:n,tokenType:t,isInclusive:r,prevResultSize:a,nextResultSize:s,shouldReverse:o,messageType:u,customType:l,senderUserIds:c,includeMetaArray:d},function(e,n){var t=null;if(!e){var r=L.get(p._iid).BaseChannel;t=n.messages.map(function(e){return r.buildMessage(e,p)}).filter(function(e){return null!==e})}i(e,t)})},i)}},{key:"isGroupChannel",value:function(){var e=L.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_GROUP}},{key:"isOpenChannel",value:function(){var e=L.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_OPEN}},{key:"createOperatorListQuery",value:function(){return new(L.get(this._iid).OperatorListQuery)(this)}},{key:"createMessageListQuery",value:function(){return new(L.get(this._iid).MessageListQuery)(this)}},{key:"createPreviousMessageListQuery",value:function(){return new(L.get(this._iid).PreviousMessageListQuery)(this)}},{key:"serialize",value:function(){return W.serialize(this,function(e){if(null!==e.lastMessage&&"object"===Z(e.lastMessage)){var n=e.lastMessage;n.hasOwnProperty("_sender")&&(n.sender=n._sender,delete n._sender,e.lastMessage=n)}e.hasOwnProperty("_messageOffsetTimestamp")&&(e.messageOffsetTimestamp=e._messageOffsetTimestamp,delete e._messageOffsetTimestamp)})}},{key:"getMessageChangeLogsByTimestamp",value:function(e,n,t){var r,a=this,i=g(x.parse(arguments,[new x({type:"number",constraint:function(e){return 0<=e}}),new x({type:"boolean",optional:!0,defaultValue:!1}),new x({type:"callback"})]),4);return r=i[0],e=i[1],n=i[2],t=i[3],V(this._iid,function(i){r?i(r,null):$.get(a._iid).container.apiClient.getMessageChangeLogs({channelUrl:a.url,ts:e,token:null,isOpenChannel:a.isOpenChannel(),includeMetaArray:n},function(e,n){var t=null;if(!e){var r=L.get(a._iid).BaseChannel;t={updatedMessages:n.updated.map(function(e){return r.buildMessage(e,a)}),deletedMessageIds:n.deleted.map(function(e){return e.message_id}),hasMore:n.has_more,token:n.next}}i(e,t)})},t)}},{key:"getMessageChangeLogsByToken",value:function(e,n,t){var r,a=this,i=g(x.parse(arguments,[new x({type:"string",nullable:!0}),new x({type:"boolean",optional:!0,defaultValue:!1}),new x({type:"callback"})]),4);return r=i[0],e=i[1],n=i[2],t=i[3],V(this._iid,function(i){r?i(r,null):$.get(a._iid).container.apiClient.getMessageChangeLogs({channelUrl:a.url,ts:null,token:e,isOpenChannel:a.isOpenChannel(),includeMetaArray:n},function(e,n){var t=null;if(!e){var r=L.get(a._iid).BaseChannel;t={updatedMessages:n.updated.map(function(e){return r.buildMessage(e,a)}),deletedMessageIds:n.deleted.map(function(e){return e.message_id}),hasMore:n.has_more,token:n.next}}i(e,t)})},t)}},{key:"getMyMutedInfo",value:function(e){var n=this;return V(this._iid,function(r){$.get(n._iid).container.apiClient.getMyMutedInfo({channelUrl:n.url,userId:hn.getInstance(n._iid).currentUser.userId,isGroupChannel:n.isGroupChannel()},function(e,n){var t=null;e||(t={isMuted:n.is_muted,startAt:n.start_at,endAt:n.end_at,remainingDuration:n.remaining_duration,description:n.description}),r(e,t)})},e)}},{key:"getPreviousMessagesByTimestamp",value:function(e,n,t,r,i,a,s,o,u){return this._getMessageList(this,e,ue.TIMESTAMP,n,t,0,r,i,a,s,o,u)}},{key:"getNextMessagesByTimestamp",value:function(e,n,t,r,i,a,s,o,u){return this._getMessageList(this,e,ue.TIMESTAMP,n,0,t,r,i,a,s,o,u)}},{key:"getPreviousAndNextMessagesByTimestamp",value:function(e,n,t,r,i,a,s,o,u){return this._getMessageList(this,e,ue.TIMESTAMP,!0,n,t,r,i,a,s,o,u)}},{key:"getPreviousMessagesByID",value:function(e,n,t,r,i,a,s,o,u){return this._getMessageList(this,e,ue.MESSAGE_ID,n,t,0,r,i,a,s,o,u)}},{key:"getNextMessagesByID",value:function(e,n,t,r,i,a,s,o,u){return this._getMessageList(this,e,ue.MESSAGE_ID,n,0,t,r,i,a,s,o,u)}},{key:"getPreviousAndNextMessagesByID",value:function(e,n,t,r,i,a,s,o,u){return this._getMessageList(this,e,ue.MESSAGE_ID,!0,n,t,r,i,a,s,o,u)}},{key:"_sendUserMessage",value:function(e){var r=this,n=e.message,t=e.data,i=e.customType,a=e.metaArrays,s=e.mentionType,o=e.mentionedUserIds,u=e.translationTargetLanguages,l=e.pushNotificationDeliveryOption,c=e.reqId,d=e.callback,h=L.get(this._iid),p=h.Command,f=h.GroupChannel,_=h.UserMessage;c=c||p.generateRequestId();var y=hn.getInstance(this._iid),g=_.build(c,0,y.currentUser,this,n,t,i,u,!1,(new Date).getTime(),0,a,s,null,o),m=new _(g);if(m.requestState=y.MessageRequestState.PENDING,m.requestedMentionUserIds=o,!y.currentUser){var C=new ee("Connection should be made first.",ee.CONNECTION_REQUIRED),v=new _(g);return v.requestState=y.MessageRequestState.FAILED,v.requestedMentionUserIds=o,v.errorCode=C.code,d(C,v),m}var E=p.bMessage({channelUrl:this.url,message:n,data:t,customType:i,metaArrays:a,mentionType:s,mentionedUserIds:o,translationTargetLanguages:u,pushNotificationDeliveryOption:l,requestId:c});(m.reqId=E.requestId,this.isGroupChannel()&&y.getConnectionState()!==y.ConnectionState.OPEN&&y.currentUser&&!y.connecting&&!y.reconnecting&&"string"==typeof i&&0===i.indexOf("SB_VIDEOCHAT"))?$.get(y._iid).container.apiClient.sendUserMessage({channelUrl:this.url,isOpenChannel:this.isOpenChannel(),message:n,data:t,customType:i,translationTargetLanguages:u,metaArrays:a,mentionType:s,mentionedUserIds:o,pushNotificationDeliveryOption:l},function(e,n){var t=null;e?((t=new _(g)).requestState=y.MessageRequestState.FAILED,t.requestedMentionUserIds=o,t.errorCode=e.code):(t=new _(n)).requestState=y.MessageRequestState.SUCCEEDED,d(e,t)}):y.sendCommand(E).then(function(e){var t=new _(e.getJsonElement()),n=y.currentUser;n&&t._sender&&n.userId===t._sender.userId&&(n.nickname!==t._sender.nickname&&(n.nickname=t._sender.nickname),n.profileUrl!==t._sender.profileUrl&&(n.profileUrl=t._sender.profileUrl),te.deepEqual(n.metaData,t._sender.metaData)||(n.metaData=t._sender.metaData)),r.isGroupChannel()?f.getChannel(r.url).then(function(e){if(!te.isVideoChatSignalingMessage(t))for(var n in e.lastMessage=t,y.channelHandlers){y.channelHandlers[n].onChannelChanged(e)}t.requestState=y.MessageRequestState.SUCCEEDED,d(null,t)}).catch(function(e){t.requestState=y.MessageRequestState.SUCCEEDED,d(e,t)}):(t.requestState=y.MessageRequestState.SUCCEEDED,d(null,t))}).catch(function(e){var n=new _(g);n.reqId=E.requestId,n.requestState=y.MessageRequestState.FAILED,n.requestedMentionUserIds=o,n.errorCode=e.code,d(new ee(e.message,e.code),n)});return m}},{key:"sendUserMessage",value:function(){var e=x.toArray(arguments),t=e.pop(),n=null,r=null,i=L.get(this._iid),a=i.UserMessageParams,s=i.MessageMetaArray;if("function"==typeof t)if(e[0]instanceof a)null===(r=e[0]).data&&(r.data=""),null===r.customType&&(r.customType="");else if("string"==typeof e[0])switch((r=new a).message=e[0],e.length){case 1:break;case 2:r.data=e[1]||"";break;case 3:r.data=e[1]||"",r.customType=e[2]||"";break;case 4:r.data=e[1]||"",r.customType=e[2]||"",r.translationTargetLanguages=Array.isArray(e[3])?e[3]:[e[3]];break;default:n=x.error}else n=x.error;else n=x.error;var o=$.get(this._iid).container.isErrorFirstInCallback;if(!n&&r._validate()&&r.message){for(var u=[],l=0;l<r.metaArrayKeys.length;l++){var c=r.metaArrayKeys[l];u.push(new s(c,[]))}return this._sendUserMessage(y({},r,{metaArrays:u,mentionType:r.mentionType,mentionedUserIds:r._mentionedUserIds,translationTargetLanguages:r._translationTargetLanguages,callback:function(e,n){o?t(e,n):t(n,e)}}))}return o?t(x.error,null):t(null,x.error),null}},{key:"resendUserMessage",value:function(t,e){var r=this,n=L.get(this._iid),i=n.UserMessage,a=n.UserMessageParams,s=null,o=g(x.parse(arguments,[new x({type:i,constraint:function(e){return 0===e.messageId&&e.isResendable()&&e.reqId&&e.channelUrl===r.url&&"string"==typeof e.message&&"string"==typeof e.data&&"string"==typeof e.customType&&Array.isArray(e.translations)}}),new x({type:"callback"})]),3);return s=o[0],t=o[1],e=o[2],V(this._iid,function(e){if(s)s.message+=" Please check if the failed message is resend-able with `message.isResendable().`",e(s,null);else{var n=a.PushNotificationDeliveryOption.DEFAULT;r._sendUserMessage(y({},t,{mentionedUserIds:t.requestedMentionUserIds,translationTargetLanguages:t.translations,pushNotificationDeliveryOption:n,reqId:t.reqId,callback:e}))}},e)}},{key:"updateUserMessage",value:function(n,e,t,r,i){var a=this,s=L.get(this._iid),o=s.Command,u=s.UserMessage,l=s.UserMessageParams,c=arguments,d=null,h=null;if("number"==typeof n)switch(c.length){case 3:var p=g(x.parse(c,[new x({type:"number"}),new x({type:l}),new x({type:"callback"})]),4);d=p[0],n=p[1],h=p[2],i=p[3];break;case 5:h=new l;var f=g(x.parse(c,[new x({type:"number"}),new x({type:"string",nullable:!0}),new x({type:"string",nullable:!0}),new x({type:"string",nullable:!0}),new x({type:"callback"})]),6);d=f[0],n=f[1],e=f[2],t=f[3],r=f[4],i=f[5],h.message=e,h.data=t,h.customType=r}return V(this._iid,function(t){if(!d&&h&&h._validate()){var e=o.bUpdateUserMessage(y({channelUrl:a.url,messageId:n},h,{mentionType:h._mentionType,mentionedUserIds:h._mentionedUserIds}));hn.getInstance(a._iid).sendCommand(e).then(function(e){var n=new u(e.getJsonElement());t(null,n)}).catch(function(e){t(e,null)})}else t(x.error,null)},i)}},{key:"translateUserMessage",value:function(e,n,t){var i,a=this,r=L.get(this._iid),s=r.BaseMessage,o=r.UserMessage,u=g(x.parse(arguments,[new x({type:o,constraint:function(e){return e.channelUrl===a.url&&e.requestState===s.MessageRequestState.SUCCEEDED}}),new x({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new x({type:"callback"})]),4);return i=u[0],e=u[1],n=u[2],t=u[3],V(this._iid,function(r){i?r(i,null):$.get(a._iid).container.apiClient.translateUserMessage({channelUrl:a.url,isOpenChannel:a.isOpenChannel(),messageId:e.messageId,translationTargetLanguages:n},function(e,n){var t=null;e||(t=new o(n)),r(e,t)})},t)}},{key:"_parseFileMessageArguments",value:function(e){var n=L.get(this._iid),t=n.BaseMessageParams,r=n.FileMessageParams,i=n.MessageMetaArray,a={error:null,file:null,name:null,type:null,size:null,data:"",customType:"",thumbnailSizes:[],metaArrays:[],mentionType:t.MentionType.USERS,mentionedUserIds:[],pushNotificationDeliveryOption:r.PushNotificationDeliveryOption.DEFAULT,progressHandler:null,callback:null};if("function"==typeof e[e.length-1]&&(a.callback=e.pop()),"function"==typeof e[e.length-1]&&(a.progressHandler=e.pop()),e[0]instanceof r){if(a.file=e[0].file||e[0].fileUrl,a.name=e[0].fileName,a.type=e[0].mimeType,a.size=e[0].fileSize,a.data=e[0].data,a.customType=e[0].customType,a.thumbnailSizes=e[0].thumbnailSizes,Array.isArray(e[0].metaArrayKeys))for(var s=0;s<e[0].metaArrayKeys.length;s++){var o=e[0].metaArrayKeys[s];"string"==typeof o&&a.metaArrays.push(new i(o,[]))}a.mentionType=e[0]._mentionType,a.mentionedUserIds=e[0]._mentionedUserIds,a.pushNotificationDeliveryOption=e[0].pushNotificationDeliveryOption?e[0].pushNotificationDeliveryOption:r.PushNotificationDeliveryOption.DEFAULT,e[0]._validate()||(a.error=x.error)}else if(te.isFile(e[0])||"string"==typeof e[0]){switch(a.file=e[0],e.length){case 1:break;case 2:a.data=e[1];break;case 3:a.data=e[1],a.customType=e[2];break;case 4:a.data=e[1],a.customType=e[2],a.thumbnailSizes=e[3];break;case 5:a.name=e[1],a.type=e[2],a.size=e[3],a.data=e[4];break;case 6:a.name=e[1],a.type=e[2],a.size=e[3],a.data=e[4],a.customType=e[5];break;case 7:a.name=e[1],a.type=e[2],a.size=e[3],a.data=e[4],a.customType=e[5],a.thumbnailSizes=e[6]}var u=g(x.parse([a.file,a.name,a.type,a.size,a.data,a.customType,a.thumbnailSizes],[new x({type:["file","string"]}),new x({type:"string",nullable:!0}),new x({type:"string",nullable:!0}),new x({type:"number",nullable:!0,constraint:function(e){return 0<=e}}),new x({type:"string",nullable:!0}),new x({type:"string",nullable:!0}),new x({type:"array"})]),8);a.error=u[0],a.file=u[1],a.name=u[2],a.type=u[3],a.size=u[4],a.data=u[5],a.customType=u[6],a.thumbnailSizes=u[7]}else a.error=x.error;return te.isFile(a.file)&&(a.name=a.name||a.file.name,a.type=a.type||a.file.type,a.size=a.size||a.file.size),a}},{key:"_createTempFileMessage",value:function(e){try{var n=hn.getInstance(this._iid),t=L.get(this._iid),r=t.Command,i=t.BaseMessage,a=t.FileMessage;return new a(a.build(r.generateRequestId(),0,n.currentUser,this,"string"==typeof e.file?e.file:"",e.name,e.type,e.size,e.data,e.customType,!1,(new Date).getTime(),e.thumbnailSizes.map(function(e){return{url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}}),e.requireAuth,null,e.metaArrays,e.mentionType,null,e.mentionedUserIds,i.MessageRequestState.PENDING))}catch(e){return null}}},{key:"sendFileMessage",value:function(){var e=this._parseFileMessageArguments(x.toArray(arguments)),n=null,t=L.get(this._iid).Command.generateRequestId();e.error||((n=this._createTempFileMessage(e)).requestedMentionUserIds=e.mentionedUserIds,t=n.reqId);var r=hn.getInstance(this._iid);r&&r.currentUser||(e.error=new ee("Connection should be made first.",ee.CONNECTION_REQUIRED));var i=L.get(this._iid).FileMessageQueue;return i.create(this).addJob(new i.Job({fileInfo:e,pendingMessage:n,requestId:t,error:e.error,response:null})),n}},{key:"sendFileMessages",value:function(r,e){var n=this,t=1<arguments.length&&void 0!==e?e:{},i=t.progress?t.progress:function(){},a=t.sent?t.sent:function(){},s=t.complete?t.complete:function(){};if(Array.isArray(r)&&0<r.length&&r.length<=20){var o=[];return r.forEach(function(e,t){o.push(n.sendFileMessage(e,i,function(e,n){a(e,n),t===r.length-1&&s(null)}))}),o}return s(x.error),null}},{key:"resendFileMessage",value:function(t,r,e){var i=this,n=L.get(this._iid),a=n.FileMessage,s=n.FileMessageParams,o=null,u=g(x.parse(arguments,[new x({type:a,constraint:function(e){return 0===e.messageId&&e.isResendable()&&e.reqId&&e.channelUrl===i.url&&"string"==typeof e.data&&"string"==typeof e.customType&&Array.isArray(e.thumbnails)}}),new x({type:"file",optionalIf:function(e){return!!e[0].url},defaultValue:null}),new x({type:"callback"})]),4);return o=u[0],t=u[1],r=u[2],e=u[3],V(this._iid,function(e){if(o)o.message+=" Please check if the failed message is resend-able with `message.isResendable().`",e(o,null);else{var n=new s;t.url?n.fileUrl=t.url:n.file=r,n.fileName=t.name,n.fileSize=t.size,n.mimeType=t.type,n.data=t.data,n.customType=t.customType,n.mentionType=t.mentionType,n.mentionedUserIds=t.requestedMentionUserIds,n.metaArrayKeys=t.metaArrays.map(function(e){return e.key}),n.thumbnailSizes=t.thumbnails.map(function(e){return{maxWidth:e.width,maxHeight:e.height}}),i.sendFileMessage(n,e)}},e)}},{key:"updateFileMessage",value:function(n,e,t,r){var i=this,a=L.get(this._iid),s=a.Command,o=a.FileMessage,u=a.FileMessageParams,l=arguments,c=null,d=null;if("number"==typeof n)switch(l.length){case 3:var h=g(x.parse(l,[new x({type:"number"}),new x({type:u}),new x({type:"callback"})]),4);c=h[0],n=h[1],d=h[2],r=h[3],d&&(d._isUpdate=!0);break;case 4:d=new u;var p=g(x.parse(l,[new x({type:"number"}),new x({type:"string",nullable:!0}),new x({type:"string",nullable:!0}),new x({type:"callback"})]),5);c=p[0],n=p[1],e=p[2],t=p[3],r=p[4],d.data=e,d.customType=t,d._isUpdate=!0}return V(this._iid,function(t){if(!c&&d&&d._validate()){var e=s.bUpdateFileMessage(y({channelUrl:i.url,messageId:n},d,{mentionType:d._mentionType,mentionedUserIds:d._mentionedUserIds}));hn.getInstance(i._iid).sendCommand(e).then(function(e){var n=new o(e.getJsonElement());t(null,n)}).catch(function(e){t(e,null)})}else t(x.error,null)},r)}},{key:"cancelUploadingFileMessage",value:function(e,t){var n,r=g(x.parse(arguments,[new x({type:["number","string"]}),new x({type:"callback"})]),3);n=r[0],e=r[1],t=r[2];var i=$.get(this._iid).container.isErrorFirstInCallback;return n?(i?t(n,null):t(null,n),!1):L.get(this._iid).FileMessageQueue.create(this).cancelUploadItemByRequestId(e,function(e,n){return i?t(e,n):t(n,e)})}},{key:"deleteMessage",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"object",constraint:function(e){return!Array.isArray(e)&&null!==e&&e.hasOwnProperty("messageId")}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.deleteMessage({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),messageId:e.messageId},function(e,n){return t(e,null)})},n)}},{key:"getMetaCounters",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"array",constraint:function(n){return Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.getMetaCounters({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),keys:e},function(e,n){return t(e,n)})},n)}},{key:"getAllMetaCounters",value:function(e){var n=this;return V(this._iid,function(t){$.get(n._iid).container.apiClient.getMetaCounters({channelUrl:n.url,isOpenChannel:n.isOpenChannel(),keys:[]},function(e,n){return t(e,n)})},e)}},{key:"createMetaCounters",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"number"==typeof e})}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.createMetaCounters({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),metaCounter:e},function(e,n){return t(e,n)})},n)}},{key:"updateMetaCounters",value:function(e,n,t){var r,i=this,a=g(x.parse(arguments,[new x({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"number"==typeof e})}}),new x({type:"boolean",optional:!0,defaultValue:!1}),new x({type:"callback"})]),4);return r=a[0],e=a[1],n=a[2],t=a[3],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.updateMetaCounters({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),metaCounter:e,upsert:n,mode:"set"},function(e,n){return t(e,n)})},t)}},{key:"increaseMetaCounters",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"number"==typeof e})}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.updateMetaCounters({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),metaCounter:e,upsert:!1,mode:"increase"},function(e,n){return t(e,n)})},n)}},{key:"decreaseMetaCounters",value:function(e,n){var t,r=this,i=g(x.parse(arguments,[new x({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"number"==typeof e})}}),new x({type:"callback"})]),3);return t=i[0],e=i[1],n=i[2],V(this._iid,function(i){t?i(t,null):$.get(r._iid).container.apiClient.updateMetaCounters({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),metaCounter:e,upsert:!1,mode:"decrease"},function(e,n){var t=null;if(!e)for(var r in t={},n)t[r]=n[r];i(e,t)})},n)}},{key:"deleteMetaCounter",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"string"}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.deleteMetaCounter({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),key:e},function(e,n){return t(e,n)})},n)}},{key:"deleteAllMetaCounters",value:function(e){var n=this;return V(this._iid,function(t){$.get(n._iid).container.apiClient.deleteAllMetaCounters({channelUrl:n.url,isOpenChannel:n.isOpenChannel()},function(e,n){return t(e,n)})},e)}},{key:"getMetaData",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"array",constraint:function(n){return Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.getMetaData({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),keys:e},function(e,n){return t(e,n)})},n)}},{key:"getAllMetaData",value:function(e){var n=this;return V(this._iid,function(t){$.get(n._iid).container.apiClient.getMetaData({channelUrl:n.url,isOpenChannel:n.isOpenChannel(),keys:[]},function(e,n){return t(e,n)})},e)}},{key:"createMetaData",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.createMetaData({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),metaData:e},function(e,n){return t(e,n)})},n)}},{key:"updateMetaData",value:function(e,n,t){var r,i=this,a=g(x.parse(arguments,[new x({type:"object",constraint:function(n){return n&&!Array.isArray(n)&&0<Object.keys(n).length&&Object.keys(n).map(function(e){return n[e]}).every(function(e){return"string"==typeof e})}}),new x({type:"boolean",optional:!0,defaultValue:!1}),new x({type:"callback"})]),4);return r=a[0],e=a[1],n=a[2],t=a[3],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.updateMetaData({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),metaData:e,upsert:n},function(e,n){return t(e,n)})},t)}},{key:"deleteMetaData",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"string"}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.deleteMetaData({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),key:e},function(e,n){return t(e,n)})},n)}},{key:"deleteAllMetaData",value:function(e){var n=this;return V(this._iid,function(t){$.get(n._iid).container.apiClient.deleteAllMetaData({channelUrl:n.url,isOpenChannel:n.isOpenChannel()},function(e,n){return t(e,n)})},e)}},{key:"_updateMessageMetaArray",value:function(o,u,l,e){var c=this;return V(this._iid,function(t){var e=L.get(c._iid),n=e.Command,r=e.UserMessage,i=e.FileMessage,a=e.AdminMessage,s=null;u.isUserMessage()?s=n.bUpdateUserMessage({channelUrl:o,messageId:u.messageId,metaArrayParams:l}):u.isFileMessage()&&(s=n.bUpdateFileMessage({channelUrl:o,messageId:u.messageId,metaArrayParams:l})),s?hn.getInstance(c._iid).sendCommand(s).then(function(e){var n=null;u.isUserMessage()?n=new r(e.getJsonElement()):u.isFileMessage()?n=new i(e.getJsonElement()):u.isAdminMessage()&&(n=new a(e.getJsonElement())),t(null,n)}).catch(function(e){t(e,null)}):t(x.error,null)},e)}},{key:"createMessageMetaArrayKeys",value:function(e,n,t){var r,i=L.get(this._iid).MessageMetaArray,a=g(x.parse(arguments,[new x({type:J}),new x({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e&&""!==e})}}),new x({type:"callback"})]),4);if(r=a[0],e=a[1],n=a[2],t=a[3],r)return V(this._iid,function(e){e(r,null)},t);var s=[];if(Array.isArray(n))for(var o=0;o<n.length;o++){var u=n[o];s.push(new i(u,[]))}return this._updateMessageMetaArray(this.url,e,{array:s.map(function(e){return e.encode()}),mode:"add",upsert:!0},t)}},{key:"deleteMessageMetaArrayKeys",value:function(e,n,t){var r,i=L.get(this._iid).MessageMetaArray,a=g(x.parse(arguments,[new x({type:J}),new x({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e&&""!==e})}}),new x({type:"callback"})]),4);if(r=a[0],e=a[1],n=a[2],t=a[3],r)return V(this._iid,function(e){e(r,null)},t);var s=[];if(Array.isArray(n))for(var o=0;o<n.length;o++){var u=n[o];s.push(new i(u,[]))}return this._updateMessageMetaArray(this.url,e,{array:s.map(function(e){return e.encode()}),mode:"remove",upsert:!0},t)}},{key:"addMessageMetaArrayValues",value:function(e,n,t){var r,i=L.get(this._iid).MessageMetaArray,a=g(x.parse(arguments,[new x({type:J}),new x({type:"object",constraint:function(n){return n&&(Array.isArray(n)&&n.every(function(e){return e instanceof i})||Object.keys(n).every(function(e){return Array.isArray(n[e])&&n[e].every(function(e){return"string"==typeof e&&0<e.length})}))}}),new x({type:"callback"})]),4);if(r=a[0],e=a[1],n=a[2],t=a[3],r)return V(this._iid,function(e){e(r,null)},t);var s=Array.isArray(n)?n.map(function(e){return e.encode()}):Object.keys(n).map(function(e){return{key:e,value:n[e]}});return this._updateMessageMetaArray(this.url,e,{array:s,mode:"add",upsert:!0},t)}},{key:"removeMessageMetaArrayValues",value:function(e,n,t){var r,i=L.get(this._iid).MessageMetaArray,a=g(x.parse(arguments,[new x({type:J}),new x({type:"object",constraint:function(n){return n&&(Array.isArray(n)&&n.every(function(e){return e instanceof i})||Object.keys(n).every(function(e){return Array.isArray(n[e])&&n[e].every(function(e){return"string"==typeof e&&0<e.length})}))}}),new x({type:"callback"})]),4);return r=a[0],e=a[1],n=a[2],t=a[3],r?V(this._iid,function(e){e(r,null)},t):this._updateMessageMetaArray(this.url,e,{array:n.map(function(e){return e.encode()}),mode:"remove",upsert:!0},t)}},{key:"report",value:function(e,n,t){var r,i=this,a=L.get(this._iid).BaseChannel,s=g(x.parse(arguments,[new x({type:a.ReportCategory}),new x({type:"string"}),new x({type:"callback"})]),4);return r=s[0],e=s[1],n=s[2],t=s[3],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.report({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),reportCategory:e,reportingUserId:hn.getInstance(i._iid).currentUser.userId,reportDescription:n},function(e,n){t(e,null)})},t)}},{key:"reportUser",value:function(e,n,r,t){var i,a=this,s=L.get(this._iid).BaseChannel,o=g(x.parse(arguments,[new x({type:oe}),new x({type:s.ReportCategory}),new x({type:"string"}),new x({type:"callback"})]),5);return i=o[0],e=o[1],n=o[2],r=o[3],t=o[4],V(this._iid,function(t){i?t(i,null):$.get(a._iid).container.apiClient.reportUser({channelUrl:a.url,isOpenChannel:a.isOpenChannel(),reportCategory:n,offendingUserId:e.userId,reportingUserId:hn.getInstance(a._iid).currentUser.userId,reportDescription:r},function(e,n){t(e,null)})},t)}},{key:"reportMessage",value:function(e,n,r,t){var i,a=this,s=L.get(this._iid).BaseChannel,o=g(x.parse(arguments,[new x({type:J}),new x({type:s.ReportCategory}),new x({type:"string"}),new x({type:"callback"})]),5);return i=o[0],e=o[1],n=o[2],r=o[3],t=o[4],V(this._iid,function(t){i?t(i,null):$.get(a._iid).container.apiClient.reportMessage({messageId:e.messageId,channelUrl:a.url,isOpenChannel:a.isOpenChannel(),reportCategory:n,offendingUserId:e.sender.userId,reportingUserId:hn.getInstance(a._iid).currentUser.userId,reportDescription:r},function(e,n){t(e,null)})},t)}}],[{key:"buildMessage",value:function(e,n){var t=L.get(this._iid),r=t.Sender,i=t.UserMessage,a=t.FileMessage,s=t.AdminMessage,o=t.BaseMessageParams,u=t.MessageMetaArray;if(e)switch(e.type){case"MESG":return new i(i.build(e.req_id,parseInt(e.message_id),new r(e.user),n,e.message,e.data||"",e.custom_type||"",e.translations||{},e.is_global_block||!1,parseInt(e.created_at),parseInt(e.updated_at),e.sorted_metaarray?e.sorted_metaarray.map(function(e){return new u(e.key,e.value||[])}):[],e.mention_type||o.MentionType.USERS,e.mentioned_users||[]));case"FILE":var l=e.file;return new a(a.build(e.req_id,parseInt(e.message_id),new r(e.user),n,String(l.url),String(l.name),String(l.type),parseInt(l.size)||0,l.data||"",e.custom_type||"",e.is_global_block||!1,parseInt(e.created_at),e.thumbnails||[],e.require_auth||!1,parseInt(e.updated_at),e.sorted_metaarray?e.sorted_metaarray.map(function(e){return new u(e.key,e.value||[])}):[],e.mention_type||o.MentionType.USERS,e.mentioned_users||[]));case"BRDM":case"ADMM":return new s(s.build(parseInt(e.message_id),n,e.message,e.data||"",e.custom_type||"",e.translations||{},parseInt(e.created_at),parseInt(e.updated_at),e.sorted_metaarray?e.sorted_metaarray.map(function(e){return new u(e.key,e.value||[])}):[],e.mention_type||o.MentionType.USERS,e.mentioned_users||[]))}return null}},{key:"CHANNEL_TYPE_OPEN",get:function(){return"open"}},{key:"CHANNEL_TYPE_GROUP",get:function(){return"group"}},{key:"CHANNEL_TYPE_BASE",get:function(){return"base"}},{key:"MessageTypeFilter",get:function(){return{ALL:"",USER:"MESG",FILE:"FILE",ADMIN:"ADMM"}}},{key:"ReportCategory",get:function(){return{SPAM:"spam",HARASSING:"harassing",SUSPICIOUS:"suspicious",INAPPROPRIATE:"inappropriate"}}}]),n}(),ce=function(){function n(e){_(this,n),e&&(this.category=e.hasOwnProperty("cat")?parseInt(e.cat):0,this.data=e.hasOwnProperty("data")?e.data:null,this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):le.CHANNEL_TYPE_GROUP)}return s(n,[{key:"isGroupChannel",value:function(){return this.channelType===le.CHANNEL_TYPE_GROUP}},{key:"isOpenChannel",value:function(){return this.channelType===le.CHANNEL_TYPE_OPEN}}]),n}();ce.CATEGORY_NONE=0,ce.CATEGORY_CHANNEL_ENTER=10102,ce.CATEGORY_CHANNEL_EXIT=10103,ce.CATEGORY_USER_CHANNEL_MUTE=10201,ce.CATEGORY_USER_CHANNEL_UNMUTE=10200,ce.CATEGORY_USER_CHANNEL_BAN=10601,ce.CATEGORY_USER_CHANNEL_UNBAN=10600,ce.CATEGORY_CHANNEL_FREEZE=10701,ce.CATEGORY_CHANNEL_UNFREEZE=10700,ce.CATEGORY_TYPING_START=10900,ce.CATEGORY_TYPING_END=10901,ce.CATEGORY_CHANNEL_JOIN=1e4,ce.CATEGORY_CHANNEL_LEAVE=10001,ce.CATEGORY_CHANNEL_INVITE=10020,ce.CATEGORY_CHANNEL_DECLINE_INVITE=10022,ce.CATEGORY_CHANNEL_PROP_CHANGED=11e3,ce.CATEGORY_CHANNEL_DELETED=12e3,ce.CATEGORY_CHANNEL_META_DATA_CHANGED=11100,ce.CATEGORY_CHANNEL_META_COUNTERS_CHANGED=11200,ce.CATEGORY_CHANNEL_HIDE=13e3,ce.CATEGORY_CHANNEL_UNHIDE=13001;function de(e){_(this,de),e&&(this.category=e.hasOwnProperty("cat")?parseInt(e.cat):0)}de.CATEGORY_USER_BLOCK=20001,de.CATEGORY_USER_UNBLOCK=2e4,de.CATEGORY_FRIEND_DISCOVERED=20900;var he=function(){function n(e){_(this,n),this.sb=e,this.cls=L.get(this.sb._iid)}return s(n,[{key:"onRawCommandReceived",value:function(e){var g=this,n=this.cls,t=n.Command,l=n.User,c=n.Member,r=n.BaseChannel,d=n.GroupChannel,a=n.OpenChannel,i=n.UserMessage,s=n.FileMessage,o=n.AdminMessage,m=n.BaseMessageParams,u=n.ReadStatus,h=$.get(this.sb._iid),p=h.container,f=p.pinger,_=p.auth,y=p.subscribedUnreadMessageCount,C=p.ackStateMap,v=new t(e),E=v.getJsonElement();if(E.hasOwnProperty("unread_cnt")&&"object"===Z(E.unread_cnt)){var U=!1,b=E.unread_cnt.ts;if("number"==typeof b&&b>y.ts){if(y.all!==E.unread_cnt.all&&(U=!0),y.all=0<=E.unread_cnt.all?E.unread_cnt.all:0,E.unread_cnt.custom_types)for(var A in E.unread_cnt.custom_types)y.custom_types[A]!==E.unread_cnt.custom_types[A]&&(U=!0),y.custom_types[A]=E.unread_cnt.custom_types[A];U=U&&0<y.ts,y.ts=b}if(U)for(var N in this.sb.userEventHandlers)this.sb.userEventHandlers[N].onTotalUnreadMessageCountUpdated(y.all,y.custom_types)}var S=v.requestId;if(S){var I=C[S];if(I){clearTimeout(I.timer);var k=I.handler;k&&("EROR"===v.command?k(new ee(E.message,E.code),null):k(null,v)),C.hasOwnProperty(S)&&delete C[S]}}else switch(f&&"LOGI"!==v.command&&f.start(),v.command){case"LOGI":this.sb.loginTimer&&(clearTimeout(this.sb.loginTimer),this.sb.loginTimer=null,this.sb.onLoginTimerCancel=null,E.hasOwnProperty("error")?(this.sb.isSessionOpened=!1,this.sb.loginHandler(new ee(E.message,E.code),null)):(this.sb.isSessionOpened=!0,E.hasOwnProperty("key")&&(_.sessionKey=E.key),E.hasOwnProperty("ekey")&&(_.eKey=E.ekey),E.hasOwnProperty("user_id")&&(this.sb.currentUser=new l(E)),"number"==typeof E.ping_interval&&0<E.ping_interval&&h.set("pingInterval",1e3*E.ping_interval),"number"==typeof E.pong_timeout&&0<E.pong_timeout&&h.set("pongTimeout",1e3*E.pong_timeout),"number"==typeof E.login_ts&&h.set("connectedAt",1e3*E.login_ts),f&&f.start(),this.sb.loginHandler(null,this.sb.currentUser)),this.sb.connecting=!1,this.sb.reconnecting=!1);break;case"MESG":case"FILE":case"BRDM":case"ADMM":var R=null,O=!1;if("MESG"===v.command?R=new i(E):"FILE"===v.command?R=new s(E):(R=new o(E),E.hasOwnProperty("silent")&&(O=E.silent)),R){var T=this.sb.currentUser.userId;if(R.isGroupChannel()){var M=d.cachedChannels.hasOwnProperty(R.channelUrl);d.getChannel(R.channelUrl).then(function(e){if(e.isHidden=!1,e.hiddenState=d.HiddenState.UNHIDDEN,d.cachedChannels[e.url]=e,R._sender&&e.memberMap.hasOwnProperty(R._sender.userId)){var n=e.memberMap[R._sender.userId];n.nickname!==R._sender.nickname&&(n.nickname=R._sender.nickname),n.profileUrl!==R._sender.profileUrl&&(n.profileUrl=R._sender.profileUrl),te.deepEqual(n.metaData,R._sender.metaData)||(n.metaData=R._sender.metaData),n.isBlockedByMe!==R._sender.isBlockedByMe&&(n.isBlockedByMe=R._sender.isBlockedByMe)}var t=g.sb.currentUser;t&&R._sender&&T===R._sender.userId&&(t.nickname!==R._sender.nickname&&(t.nickname=R._sender.nickname),t.profileUrl!==R._sender.profileUrl&&(t.profileUrl=R._sender.profileUrl),te.deepEqual(t.metaData,R._sender.metaData)||(t.metaData=R._sender.metaData));var r=!1;if(R.mentionType===m.MentionType.CHANNEL)R.sender&&R.sender.userId===T||(r=!0);else if(R.mentionType===m.MentionType.USERS)for(var i=0;i<R.mentionedUsers.length;i++)if((!R.sender||R.sender.userId!==T)&&R.mentionedUsers[i].userId===T){r=!0;break}if(!te.isVideoChatSignalingMessage(R)&&(O||(e.isEphemeral?((!e.lastMessage||e.lastMessage.createdAt<R.createdAt)&&(e.lastMessage=R),R.sender&&R.sender.userId===T||e._setGroupChannelUnreadCount(e.unreadMessageCount+1,e.unreadMentionCount+(r?1:0))):M&&((!e.lastMessage||e.lastMessage.createdAt<R.createdAt)&&(e.lastMessage=R),R.sender&&R.sender.userId===T||e._setGroupChannelUnreadCount(e.unreadMessageCount+1,e.unreadMentionCount+(r?1:0)))),!O))for(var a in g.sb.channelHandlers){g.sb.channelHandlers[a].onChannelChanged(e)}for(var s in g.sb.channelHandlers){var o=g.sb.channelHandlers[s];o.onMessageReceived(e,R),r&&o.onMentionReceived(e,R)}}).catch(function(e){})}else R.isOpenChannel()&&a.getChannel(R.channelUrl).then(function(e){var n=!1;if(R.mentionType===m.MentionType.CHANNEL)n=!0;else if(R.mentionType===m.MentionType.USERS)for(var t=0;t<R.mentionedUsers.length;t++)if(R.mentionedUsers[t].userId===T){n=!0;break}for(var r in g.sb.channelHandlers){var i=g.sb.channelHandlers[r];a.enteredChannels[e.url]&&i.onMessageReceived(e,R),n&&i.onMentionReceived(e,R)}}).catch(function(e){})}break;case"MEDI":case"FEDI":case"AEDI":var L=null,w=!1;if("MEDI"===v.command?L=new i(E):"FEDI"===v.command?L=new s(E):(L=new o(E),E.hasOwnProperty("silent")&&(w=E.silent)),L){var P=this.sb.currentUser.userId;if(L.isGroupChannel()){var D=d.cachedChannels.hasOwnProperty(L.channelUrl);d.getChannel(L.channelUrl).then(function(e){var n=e.cachedReadReceiptStatus[P],t=n&&n>=L.createAt,r=g.sb.currentUser;r&&L._sender&&r.userId===L._sender.userId&&(r.nickname!==L._sender.nickname&&(r.nickname=L._sender.nickname),r.profileUrl!==L._sender.profileUrl&&(r.profileUrl=L._sender.profileUrl),te.deepEqual(r.metaData,L._sender.metaData)||(r.metaData=L._sender.metaData));var i=!1;if((!L.sender||L.sender.userId!==P)&&!t&&E&&E.hasOwnProperty("old_values")){var a=E.old_values.mention_type||L.mentionType,s=E.old_values.mentioned_user_ids||L.mentionedUsers.map(function(e){return e.userId});if(a===m.MentionType.USERS&&L.mentionType===m.MentionType.USERS){for(var o=!1,u=!1,l=0;l<s.length;l++)if(s[l]===P){o=!0;break}for(var c=0;c<L.mentionedUsers.length;c++)if(L.mentionedUsers[c].userId===P){u=!0;break}!o&&u&&(i=!0,D&&e._setGroupChannelUnreadCount(e.unreadMessageCount,e.unreadMentionCount+1))}else if(a===m.MentionType.USERS&&L.mentionType===m.MentionType.CHANNEL){for(var d=!1,h=0;h<s.length;h++)if(s[h]===P){d=!0;break}d||(i=!0,D&&e._setGroupChannelUnreadCount(e.unreadMessageCount,e.unreadMentionCount+1))}}var p=!1;if(e.lastMessage&&e.lastMessage.messageId===L.messageId&&(D?e.lastMessage.updatedAt<L.updatedAt&&(e.lastMessage=L,p=!0):p=!0),!w&&(p||i))for(var f in g.sb.channelHandlers){g.sb.channelHandlers[f].onChannelChanged(e)}for(var _ in g.sb.channelHandlers){var y=g.sb.channelHandlers[_];y.onMessageUpdated(e,L),i&&y.onMentionReceived(e,L)}}).catch(function(e){})}else L.isOpenChannel()&&a.getChannel(L.channelUrl).then(function(e){for(var n in g.sb.channelHandlers){g.sb.channelHandlers[n].onMessageUpdated(e,L)}}).catch(function(e){})}break;case"DELM":var H=String(E.channel_type),G=String(E.channel_url),F=String(E.msg_id);switch(H){case r.CHANNEL_TYPE_GROUP:d.getChannel(G).then(function(e){for(var n in g.sb.channelHandlers){g.sb.channelHandlers[n].onMessageDeleted(e,F)}}).catch(function(e){return ne.debug("Discard command",v.command)});break;case r.CHANNEL_TYPE_OPEN:a.getChannel(G).then(function(e){for(var n in g.sb.channelHandlers){g.sb.channelHandlers[n].onMessageDeleted(e,F)}}).catch(function(e){return ne.debug("Discard command",v.command)})}break;case"READ":var q=new u(E),B=d.cachedChannels.hasOwnProperty(q.channelUrl);d.getChannel(q.channelUrl).then(function(e){if(B&&e.updateReadReceipt(q.reader.userId,q.timestamp),q.reader.userId===g.sb.currentUser.userId){if(B){if((0<e.unreadMessageCount||0<e.unreadMentionCount)&&(e._setGroupChannelUnreadCount(0,0),0===e.unreadMessageCount||0===e.unreadMentionCount))for(var n in g.sb.channelHandlers){g.sb.channelHandlers[n].onChannelChanged(e)}}else if(0===e.unreadMessageCount||0===e.unreadMentionCount)for(var t in g.sb.channelHandlers){g.sb.channelHandlers[t].onChannelChanged(e)}}else for(var r in g.sb.channelHandlers){g.sb.channelHandlers[r].onReadReceiptUpdated(e)}}).catch(function(e){});break;case"SYEV":var Q=new ce(E);switch(Q.category){case ce.CATEGORY_CHANNEL_JOIN:case ce.CATEGORY_CHANNEL_LEAVE:d.getChannel(Q.channelUrl).then(function(r){var i=Q.data.hasOwnProperty("member_count")?Q.data.member_count:null,a=Q.data.hasOwnProperty("joined_member_count")?Q.data.joined_member_count:null;if(Q.category===ce.CATEGORY_CHANNEL_JOIN){(Q.data.hasOwnProperty("users")?Q.data.users:[Q.data]).forEach(function(e){r.isSuper?r.setLatestMemberCount(i,a,E.ts):(e.state=c.JOINED,r.addMember(new c(e)),r.updateJoinedMemberCount());var n=new l(e);for(var t in g.sb.currentUser&&n.userId===g.sb.currentUser.userId&&(r.myMemberState="joined",d.cachedChannels[r.url]=r),g.sb.channelHandlers){g.sb.channelHandlers[t].onUserJoined(r,n)}})}else{var e=new l(Q.data);for(var n in g.sb.currentUser&&e.userId===g.sb.currentUser.userId?(r.isPublic||d.removeCachedChannel(Q.channelUrl),r.myMemberState="none",r.invitedAt=0,r._setGroupChannelUnreadCount(0,0)):d.cachedChannels[r.url]=r,r.isSuper?r.setLatestMemberCount(i,a,E.ts):(r.removeMember(e),r.updateJoinedMemberCount()),g.sb.channelHandlers){g.sb.channelHandlers[n].onUserLeft(r,e)}}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)});break;case ce.CATEGORY_CHANNEL_INVITE:d.getChannel(Q.channelUrl).then(function(e){var n=null;Q.data&&Q.data.inviter&&0<Object.keys(Q.data.inviter).length&&(n=new l(Q.data.inviter));for(var t=[],r=0;r<Q.data.invitees.length;r++){var i=new l(Q.data.invitees[r]);t.push(i),Q.data.invitees[r].state=c.INVITED;var a=new c(Q.data.invitees[r]);if(e.isSuper){var s=Q.data.hasOwnProperty("member_count")?Q.data.member_count:null,o=Q.data.hasOwnProperty("joined_member_count")?Q.data.joined_member_count:null;e.setLatestMemberCount(s,o,E.ts)}else e.addMember(a);g.sb.currentUser&&a.userId===g.sb.currentUser.userId&&(e.isHidden=!1,"joined"!==e.myMemberState&&(e.myMemberState="invited"),e.invitedAt=E.ts,d.cachedChannels[e.url]=e)}for(var u in g.sb.channelHandlers){g.sb.channelHandlers[u].onUserReceivedInvitation(e,n,t)}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)});break;case ce.CATEGORY_CHANNEL_DECLINE_INVITE:d.getChannel(Q.channelUrl).then(function(e){var n=null;Q.data&&Q.data.inviter&&0<Object.keys(Q.data.inviter).length&&(n=new l(Q.data.inviter));var t=new l(Q.data.invitee);if(g.sb.currentUser&&t.userId===g.sb.currentUser.userId&&(e.invitedAt=0,e.myMemberState="none",e.isPublic||d.removeCachedChannel(Q.channelUrl)),e.isSuper){var r=Q.data.hasOwnProperty("member_count")?Q.data.member_count:null,i=Q.data.hasOwnProperty("joined_member_count")?Q.data.joined_member_count:null;e.setLatestMemberCount(r,i,E.ts)}else e.removeMember(t);for(var a in g.sb.currentUser&&t.userId!==g.sb.currentUser.userId&&(d.cachedChannels[e.url]=e),g.sb.channelHandlers){g.sb.channelHandlers[a].onUserDeclinedInvitation(e,n,t)}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)});break;case ce.CATEGORY_TYPING_START:case ce.CATEGORY_TYPING_END:d.getChannel(Q.channelUrl).then(function(e){var n=new l(Q.data);for(var t in Q.category===ce.CATEGORY_TYPING_START?e.updateTypingStatus(n,!0):e.updateTypingStatus(n,!1),g.sb.channelHandlers){g.sb.channelHandlers[t].onTypingStatusUpdated(e)}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)});break;case ce.CATEGORY_CHANNEL_ENTER:case ce.CATEGORY_CHANNEL_EXIT:a.getChannel(Q.channelUrl).then(function(e){Q.data.hasOwnProperty("participant_count")&&(e.participantCount=Q.data.participant_count);var n=new l(Q.data);if(Q.category===ce.CATEGORY_CHANNEL_ENTER)for(var t in g.sb.channelHandlers){g.sb.channelHandlers[t].onUserEntered(e,n)}else for(var r in g.sb.channelHandlers){g.sb.channelHandlers[r].onUserExited(e,n)}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)});break;case ce.CATEGORY_USER_CHANNEL_MUTE:case ce.CATEGORY_USER_CHANNEL_UNMUTE:Q.isOpenChannel()?a.getChannel(Q.channelUrl).then(function(e){var n=new l(Q.data);if(Q.category===ce.CATEGORY_USER_CHANNEL_MUTE)for(var t in g.sb.channelHandlers){g.sb.channelHandlers[t].onUserMuted(e,n)}else for(var r in g.sb.channelHandlers){g.sb.channelHandlers[r].onUserUnmuted(e,n)}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)}):d.getChannel(Q.channelUrl).then(function(e){var n=new l(Q.data);if(g.sb.currentUser&&n.userId===g.sb.currentUser.userId&&(e.myMutedState=Q.category===ce.CATEGORY_USER_CHANNEL_MUTE?"muted":"unmuted"),Q.category===ce.CATEGORY_USER_CHANNEL_MUTE)for(var t in g.sb.channelHandlers){g.sb.channelHandlers[t].onUserMuted(e,n)}else for(var r in g.sb.channelHandlers){g.sb.channelHandlers[r].onUserUnmuted(e,n)}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)});break;case ce.CATEGORY_USER_CHANNEL_BAN:case ce.CATEGORY_USER_CHANNEL_UNBAN:Q.isOpenChannel()?a.getChannel(Q.channelUrl).then(function(e){var n=new l(Q.data);if(Q.category===ce.CATEGORY_USER_CHANNEL_BAN){if(g.sb.currentUser&&n.userId===g.sb.currentUser.userId)delete a.enteredChannels[Q.channelUrl],g.cls.FileMessageQueue.delete(Q.channelUrl);for(var t in g.sb.channelHandlers){g.sb.channelHandlers[t].onUserBanned(e,n)}}else for(var r in g.sb.channelHandlers){g.sb.channelHandlers[r].onUserUnbanned(e,n)}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)}):d.getChannel(Q.channelUrl).then(function(e){var n=new l(Q.data);if(Q.category===ce.CATEGORY_USER_CHANNEL_BAN){if(g.sb.currentUser&&n.userId===g.sb.currentUser.userId&&(e.isPublic||d.removeCachedChannel(Q.channelUrl),e.myMemberState="none",e.invitedAt=0,e._setGroupChannelUnreadCount(0,0)),e.isSuper){var t=Q.data.hasOwnProperty("member_count")?Q.data.member_count:null,r=Q.data.hasOwnProperty("joined_member_count")?Q.data.joined_member_count:null;e.setLatestMemberCount(t,r,E.ts)}else e.removeMember(n),e.updateJoinedMemberCount();for(var i in g.sb.channelHandlers){g.sb.channelHandlers[i].onUserBanned(e,n)}}else for(var a in g.sb.channelHandlers){g.sb.channelHandlers[a].onUserUnbanned(e,n)}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)});break;case ce.CATEGORY_CHANNEL_FREEZE:case ce.CATEGORY_CHANNEL_UNFREEZE:Q.isOpenChannel()?a.getChannel(Q.channelUrl).then(function(e){if(e.isFrozen=Q.data.freeze,a.cachedChannels[e.url]=e,Q.category===ce.CATEGORY_CHANNEL_FREEZE)for(var n in g.sb.channelHandlers){g.sb.channelHandlers[n].onChannelFrozen(e)}else for(var t in g.sb.channelHandlers){g.sb.channelHandlers[t].onChannelUnfrozen(e)}}).then(function(e){return ne.debug("Discard command",v.command,Q.category)}):d.getChannel(Q.channelUrl).then(function(e){if(e.isFrozen=Q.data.freeze,d.cachedChannels[e.url]=e,Q.category===ce.CATEGORY_CHANNEL_FREEZE)for(var n in g.sb.channelHandlers){g.sb.channelHandlers[n].onChannelFrozen(e)}else for(var t in g.sb.channelHandlers){g.sb.channelHandlers[t].onChannelUnfrozen(e)}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)});break;case ce.CATEGORY_CHANNEL_DELETED:for(var x in Q.isGroupChannel()?d.removeCachedChannel(Q.channelUrl):a.removeCachedChannel(Q.channelUrl),this.sb.channelHandlers){this.sb.channelHandlers[x].onChannelDeleted(Q.channelUrl,Q.isGroupChannel()?"group":"open")}break;case ce.CATEGORY_CHANNEL_PROP_CHANGED:Q.isOpenChannel()?a.getChannelWithoutCache(Q.channelUrl).then(function(e){for(var n in g.sb.channelHandlers){g.sb.channelHandlers[n].onChannelChanged(e)}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)}):d.getChannelWithoutCache(Q.channelUrl).then(function(e){var n=e.unreadMessageCount,t=e.unreadMentionCount;for(var r in e.myCountPreference!==d.CountPreference.ALL&&(e.myCountPreference===d.CountPreference.UNREAD_MESSAGE_COUNT_ONLY?t=0:e.myCountPreference===d.CountPreference.UNREAD_MENTION_COUNT_ONLY?n=0:t=n=0),e._setGroupChannelUnreadCount(n,t),g.sb.channelHandlers){g.sb.channelHandlers[r].onChannelChanged(e)}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)});break;case ce.CATEGORY_CHANNEL_META_DATA_CHANGED:case ce.CATEGORY_CHANNEL_META_COUNTERS_CHANGED:var z=Q.data.hasOwnProperty("created"),j=Q.data.hasOwnProperty("updated"),Y=Q.data.hasOwnProperty("deleted");Q.isOpenChannel()?a.getChannel(Q.channelUrl).then(function(e){for(var n in g.sb.channelHandlers){var t=g.sb.channelHandlers[n];Q.category===ce.CATEGORY_CHANNEL_META_DATA_CHANGED?(z&&t.onMetaDataCreated(e,Q.data.created),j&&t.onMetaDataUpdated(e,Q.data.updated),Y&&t.onMetaDataDeleted(e,Q.data.deleted)):(z&&t.onMetaCountersCreated(e,Q.data.created),j&&t.onMetaCountersUpdated(e,Q.data.updated),Y&&t.onMetaCountersDeleted(e,Q.data.deleted))}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)}):d.getChannel(Q.channelUrl).then(function(e){for(var n in g.sb.channelHandlers){var t=g.sb.channelHandlers[n];Q.category===ce.CATEGORY_CHANNEL_META_DATA_CHANGED?(z&&t.onMetaDataCreated(e,Q.data.created),j&&t.onMetaDataUpdated(e,Q.data.updated),Y&&t.onMetaDataDeleted(e,Q.data.deleted)):(z&&t.onMetaCountersCreated(e,Q.data.created),j&&t.onMetaCountersUpdated(e,Q.data.updated),Y&&t.onMetaCountersDeleted(e,Q.data.deleted))}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)});break;case ce.CATEGORY_CHANNEL_HIDE:case ce.CATEGORY_CHANNEL_UNHIDE:d.getChannel(Q.channelUrl).then(function(e){if(Q.category===ce.CATEGORY_CHANNEL_HIDE)for(var n in e.isHidden=!0,Q.data&&(Q.data.hasOwnProperty("allow_auto_unhide")&&(e.hiddenState=Q.data.allow_auto_unhide?d.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:d.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE),Q.data.hasOwnProperty("hide_previous_messages")&&Q.data.hide_previous_messages&&e._setGroupChannelUnreadCount(0,0)),E.hasOwnProperty("ts_message_offset")&&(e._messageOffsetTimestamp=E.ts_message_offset),d.cachedChannels[e.url]=e,g.sb.channelHandlers){g.sb.channelHandlers[n].onChannelHidden(e)}else for(var t in e.isHidden=!1,e.hiddenState=d.HiddenState.UNHIDDEN,d.cachedChannels[e.url]=e,g.sb.channelHandlers){g.sb.channelHandlers[t].onChannelChanged(e)}}).catch(function(e){return ne.debug("Discard command",v.command,Q.category)})}break;case"USEV":var K=new ce(E);switch(K.category){case de.CATEGORY_USER_BLOCK:case de.CATEGORY_USER_UNBLOCK:var V=K.data.blocker.user_id,W=K.data.blockee.user_id;Object.keys(d.cachedChannels).forEach(function(e){var n=d.cachedChannels[e];try{g.sb.currentUser&&(g.sb.currentUser.userId===V?n.memberMap[W].isBlockedByMe=K.category===de.CATEGORY_USER_BLOCK:g.sb.currentUser.userId===W&&(n.memberMap[V].isBlockingMe=K.category===de.CATEGORY_USER_BLOCK))}catch(e){}});break;case de.CATEGORY_FRIEND_DISCOVERED:var J=K.data.friend_discoveries.map(function(e){return new l(e)});for(var X in this.sb.userEventHandlers){this.sb.userEventHandlers[X].onFriendsDiscovered(J)}}break;case"LEAV":case"JOIN":case"PONG":case"MTIO":case"TPST":case"TPEN":break;default:ne.debug("Discard command",v.command)}}}]),n}(),pe={},fe={},_e=function(){function n(e){_(this,n),this.channel=e,this.uploadQueue=[],this.messageQueue=[],this.latestTimestampToSendMessage=0,L.get(this._iid).FileMessageQueue.queueMap[e.url]=this}return s(n,[{key:"_handleMessageQueueUpdated",value:function(e){var t=this;switch(ne.debug("fileMessageQueue message queue updated: ",this.messageQueue),e){case"add":this.uploadQueue.length<6&&this._moveFirstPendingMessageToUploadQueue();break;case"update":case"remove":if(0<this.messageQueue.length){var r=L.get(this._iid).FileMessageQueue,i=this.messageQueue[0];if(i)if(i.state===r.State.UPLOADED){if(i&&i.state===r.State.UPLOADED){for(i.state=r.State.SENDING,0===this.latestTimestampToSendMessage&&(this.latestTimestampToSendMessage=(new Date).getTime()-200);(new Date).getTime()-this.latestTimestampToSendMessage<200;);this.latestTimestampToSendMessage=(new Date).getTime(),this._sendUploadedMessage(i,function(e,n){i.state=r.State.SENT,i.error=e||null,i.response=n||null,t._handleMessageQueueUpdated("update")})}}else i.state===r.State.SENT&&this._finalizeMessage()}}}},{key:"_handleUploadQueueUpdated",value:function(e,n){var t=this;switch(ne.debug("fileMessageQueue upload queue updated: ",this.uploadQueue),e){case"add":var r=L.get(this._iid).FileMessageQueue;if(n.state=r.State.UPLOADING,n.error)-1<this.messageQueue.map(function(e){return e.requestId}).indexOf(n.requestId)&&(n.state=r.State.SENT,this._handleMessageQueueUpdated("update")),this._finalizeUpload(n.requestId);else this._uploadFile(n,function(e){n.error&&n.state===r.State.SENT||(n.state=r.State.UPLOADED),n.fileInfo=e,t._handleMessageQueueUpdated("update"),t._finalizeUpload(n.requestId)});break;case"update":break;case"remove":this.uploadQueue.length<6&&this._moveFirstPendingMessageToUploadQueue()}}},{key:"_moveFirstPendingMessageToUploadQueue",value:function(){var n=L.get(this._iid).FileMessageQueue,e=this.messageQueue.filter(function(e){return e.state===n.State.PENDING});if(0<e.length){var t=e[0];this.uploadQueue.push(t),this._handleUploadQueueUpdated("add",t)}}},{key:"_sendUploadedMessage",value:function(e,r){var n=L.get(this._iid),t=n.Command,i=n.FileMessage,a=e.fileInfo,s=t.bFile(y({},a,{requestId:e.requestId,channelUrl:this.channel.url,url:a.file,metaArrays:a.metaArrays})),o=hn.getInstance(this._iid),u=$.get(this._iid);o.getConnectionState()!==o.ConnectionState.OPEN&&o.currentUser&&!o.connecting?u.container.apiClient.sendFileMessage(y({channelUrl:this.channel.url,isOpenChannel:this.channel.isOpenChannel()},a,{fileUrl:a.file,fileName:a.name,fileSize:a.size,fileType:a.type,metaArrays:a.metaArrays}),function(e,n){var t=new i(e?s.getJsonElement():n);e&&(t.requestedMentionUserIds=a.mentionedUserIds),r(e,t)}):o.sendCommand(s).then(function(e){var n=new i(e.getJsonElement());r(null,n)}).catch(function(e){var n=new i(s.getJsonElement());n.requestedMentionUserIds=a.mentionedUserIds,r(e,n)})}},{key:"_uploadFile",value:function(r,i){var a=r.fileInfo,e=r.pendingMessage;if("string"!=typeof a.file&&a.file){var s=L.get(this._iid).FileMessageQueue;$.get(this._iid).container.apiClient.uploadFile(y({},a,{fileType:a.type,channelUrl:this.channel.url,reqId:e?e.reqId:null}),function(e,n){if(e)r.state=s.State.SENT,r.error=e,r.response=null,i(a);else{var t="object"===Z(n)?n:JSON.parse(n);a.file=t.url,a.thumbnailSizes=t.hasOwnProperty("thumbnails")?t.thumbnails:[],a.requireAuth=!!t.hasOwnProperty("require_auth")&&t.require_auth,i(a)}})}else a.thumbnailSizes=[],a.requireAuth=!1,i(a)}},{key:"_finalizeUpload",value:function(e){var n=this.uploadQueue.map(function(e){return e.requestId}).indexOf(e);if(-1<n){var t=this.uploadQueue.splice(n,1);0<t.length&&this._handleUploadQueueUpdated("remove",t[0])}}},{key:"_finalizeMessage",value:function(){var t=this,r=$.get(this._iid).container.isErrorFirstInCallback,i=hn.getInstance(this._iid),e=L.get(this._iid),n=e.GroupChannel,a=e.BaseMessage,s=e.FileMessageQueue,o=this.messageQueue[0];if(o&&o.state===s.State.SENT){o.state=s.State.DONE;var u=o.response,l=o.error,c=o.fileInfo.callback;if(u&&!l){var d=i.currentUser;if(d&&u._sender&&d.userId===u._sender.userId&&(d.nickname!==u._sender.nickname&&(d.nickname=u._sender.nickname),d.profileUrl!==u._sender.profileUrl&&(d.profileUrl=u._sender.profileUrl)),this.channel.isGroupChannel())return void n.getChannel(this.channel.url).then(function(e){for(var n in e.lastMessage=u,i.channelHandlers){i.channelHandlers[n].onChannelChanged(e)}r?c(l,u):c(u,l),t.messageQueue.shift(),t._handleMessageQueueUpdated("remove")}).catch(function(e){r?c(null,u):c(u,null),t.messageQueue.shift(),t._handleMessageQueueUpdated("remove")})}l&&(u=o.pendingMessage)&&(l.code!==ee.INVALID_PARAMETER?(u.requestState=a.MessageRequestState.FAILED,u.requestedMentionUserIds=o.fileInfo.mentionedUserIds,u.errorCode=l.code):u=null),r?c(l,u):c(u,l),this.messageQueue.shift(),this._handleMessageQueueUpdated("remove")}}},{key:"addJob",value:function(e){this.messageQueue.push(e),this._handleMessageQueueUpdated("add")}},{key:"cancelUploadItemByRequestId",value:function(e,n){this._finalizeUpload(e);var t=this.messageQueue.map(function(e){return e.requestId}).indexOf(e);if(-1<t){var r=L.get(this._iid).FileMessageQueue,i=this.messageQueue[t];!i||i.state!==r.State.UPLOADING&&i.state!==r.State.PENDING||(i.state=r.State.SENT,i.response=null,i.error=new ee("Uploading has been completed or canceled.",ee.FILE_UPLOAD_CANCEL_FAILED),this._handleMessageQueueUpdated("update"));var a=r.uploadRequest[e];if(a)return a.upload.onabort=function(){n(null,!0)},a.isAbort=!0,a.abort(),!0;n(new ee("Uploading has been completed or canceled.",ee.FILE_UPLOAD_CANCEL_FAILED),!1)}else n(new ee("Uploading has been completed or canceled.",ee.FILE_UPLOAD_CANCEL_FAILED),!1);return!1}}],[{key:"getByChannelUrl",value:function(e){return L.get(this._iid).FileMessageQueue.queueMap[e]}},{key:"create",value:function(e){var n=L.get(this._iid).FileMessageQueue;return n.queueMap.hasOwnProperty(e.url)||(n.queueMap[e.url]=new n(e)),n.queueMap[e.url]}},{key:"delete",value:function(e){var n=L.get(this._iid).FileMessageQueue;n.queueMap.hasOwnProperty(e)&&delete n.queueMap[e]}},{key:"clear",value:function(){fe[this._iid]={}}},{key:"State",get:function(){return{PENDING:"pending",UPLOADING:"uploading",UPLOADED:"uploaded",SENDING:"sending",SENT:"sent",DONE:"done"}}},{key:"queueMap",get:function(){return fe[this._iid]||(fe[this._iid]={}),fe[this._iid]}},{key:"uploadRequest",get:function(){return pe[this._iid]||(pe[this._iid]={}),pe[this._iid]}}]),n}();_e.Job=function(){return function e(n){var t=n.fileInfo,r=n.requestId,i=n.pendingMessage,a=n.state,s=n.error,o=void 0===s?null:s,u=n.response,l=void 0===u?null:u;_(this,e),this.fileInfo=t,this.requestId=r,this.pendingMessage=i,this.state=a||_e.State.PENDING,this.error=o,this.response=l}}();var ye=function(){function e(){_(this,e)}return s(e,null,[{key:"create",value:function(){return"".concat(parseInt(1e5*Math.random()),"-").concat((new Date).getTime())}}]),e}(),ge=function(){function t(e){var n;return _(this,t),(n=d(this,u(t).call(this,e))).state="",n.isBlockedByMe=!1,n.isBlockingMe=!1,e&&n._update(e),n}return o(t,oe),s(t,[{key:"_update",value:function(e){this.state=e.state,e.hasOwnProperty("is_blocked_by_me")&&(this.isBlockedByMe=e.is_blocked_by_me),e.hasOwnProperty("is_blocking_me")&&(this.isBlockingMe=e.is_blocking_me)}},{key:"parse",value:function(e){this._update(e)}}],[{key:"build",value:function(e,n,t,r){var i=e;return i.state=n,i.is_blocked_by_me=t||!1,i.is_blocking_me=r||!1,i}},{key:"buildFromSerializedData",value:function(e){var n=L.get(this._iid),t=n.User,r=n.Member,i=W.deserialize(e);return new r(r.build(t.build(i.userId,i.nickname,i.profileUrl,i.connectionStatus,i.lastSeenAt,i.metaData,i.isActive,i.friendDiscoveryKey,i.friendName),i.state,i.isBlockedByMe,i.isBlockingMe))}},{key:"JOINED",get:function(){return"joined"}},{key:"INVITED",get:function(){return"invited"}}]),t}();(m()||C())&&A(oe,ge);var me=function(){function t(e){var n;return _(this,t),(n=d(this,u(t).call(this,e))).isBlockedByMe=!1,e&&n._update(e),n}return o(t,oe),s(t,[{key:"parse",value:function(e){this._update(e)}},{key:"_update",value:function(e){e.hasOwnProperty("is_blocked_by_me")&&(this.isBlockedByMe=e.is_blocked_by_me)}}],[{key:"build",value:function(e,n){var t=e;return t.is_blocked_by_me=n||!1,t}},{key:"buildFromSerializedData",value:function(e){var n=L.get(this._iid),t=n.User,r=n.Sender,i=W.deserialize(e);return new r(r.build(t.build.apply(t,E(["userId","nickname","profileUrl","connectionStatus","lastSeenAt","metaData","isActive","friendDiscoveryKey","friendName"].map(function(e){return i[e]}))),i.isBlockedByMe))}}]),t}();(m()||C())&&A(oe,me);var Ce={},ve={},Ee=new S,Ue=new S,be=new S,Ae=function(){function a(e){var n;return _(this,a),(n=d(this,u(a).call(this,e))).channelType=le.CHANNEL_TYPE_GROUP,n.isDistinct=!1,n.isSuper=!1,n.isPublic=!1,n.unreadMessageCount=0,n.inviter=null,n.members=[],n.memberMap={},n.lastMessage={},n.memberCount=0,n.joinedMemberCount=0,n.cachedReadReceiptStatus={},n.myPushTriggerOption=a.PushTriggerOption.DEFAULT,n.isPushEnabled,n.isHidden=!1,n.hiddenState=a.HiddenState.UNHIDDEN,n.isDiscoverable=!0,n.myLastRead=0,n._messageOffsetTimestamp=0,Ee.set(t(n),{}),Ue.set(t(n),{start:0,end:0}),be.set(t(n),0),e&&n._update(e),n}return o(a,le),s(a,[{key:"_setGroupChannelUnreadCount",value:function(e,n){try{"number"==typeof e&&0<=e&&("all"===this.myCountPreference||"unread_message_count_only"===this.myCountPreference?this.isSuper?this.unreadMessageCount=1<=e?1:0:this.unreadMessageCount=e:this.unreadMessageCount=0),"number"==typeof n&&0<=n&&("all"===this.myCountPreference||"unread_mention_count_only"===this.myCountPreference?this.unreadMentionCount=n:this.unreadMentionCount=0)}catch(e){}}},{key:"_update",value:function(e){var n=L.get(this._iid),t=n.BaseChannel,r=n.GroupChannel,i=n.User,a=n.Member;if(this.isAccessCodeRequired=!!e.is_access_code_required&&e.is_access_code_required,this.isDistinct=!!e.is_distinct&&e.is_distinct,this.isPushEnabled=!!e.is_push_enabled&&e.is_push_enabled,this.isHidden=!!e.hasOwnProperty("is_hidden")&&e.is_hidden,this.myPushTriggerOption=e.push_trigger_option?e.push_trigger_option:r.PushTriggerOption.DEFAULT,this.myCountPreference=e.hasOwnProperty("count_preference")?e.count_preference:r.CountPreference.ALL,this.unreadMessageCount=0,this.unreadMentionCount=0,this._setGroupChannelUnreadCount(parseInt(e.unread_message_count),parseInt(e.unread_mention_count)),e.hasOwnProperty("read_receipt"))for(var s in this.cachedReadReceiptStatus={},e.read_receipt){var o=e.read_receipt[s];this.updateReadReceipt(s,parseInt(o))}if(e.hasOwnProperty("user_last_read")&&"number"==typeof e.user_last_read?this.myLastRead=e.user_last_read:this.myLastRead=0,e.hasOwnProperty("members")){this.members=[],this.memberMap={};for(var u=0;u<e.members.length;u++){var l=new a(e.members[u]);this.members.push(l),this.memberMap[l.userId]=l}}this.myMemberState=e.member_state||"none",this.myRole=e.my_role||r.Role.NONE,e.hasOwnProperty("is_muted")?"string"==typeof e.is_muted?this.myMutedState=e.is_muted:"boolean"==typeof e.is_muted?this.myMutedState=e.is_muted?"muted":"unmuted":this.myMutedState="unmuted":this.myMutedState="unmuted",e.hasOwnProperty("member_count")&&(this.memberCount=parseInt(e.member_count)),e.hasOwnProperty("joined_member_count")&&(this.joinedMemberCount=parseInt(e.joined_member_count)),e.hasOwnProperty("last_message")&&"object"===Z(e.last_message)&&e.last_message?e.last_message instanceof J?this.lastMessage=e.last_message:this.lastMessage=t.buildMessage(e.last_message,this):this.lastMessage=null,e.hasOwnProperty("inviter")&&null!==e.inviter&&"object"===Z(e.inviter)&&0<Object.keys(e.inviter).length?this.inviter=new i(e.inviter):this.inviter=null,this.invitedAt=e.invited_at||0,e.hasOwnProperty("is_super")&&"boolean"==typeof e.is_super?this.isSuper=e.is_super:this.isSuper=!1,e.hasOwnProperty("is_public")&&"boolean"==typeof e.is_public?this.isPublic=e.is_public:this.isPublic=!1,e.hasOwnProperty("hidden_state")?this.hiddenState=e.hidden_state:this.hiddenState=r.HiddenState.UNHIDDEN,e.hasOwnProperty("is_discoverable")&&"boolean"==typeof e.is_discoverable?this.isDiscoverable=e.is_discoverable:this.isDiscoverable=this.isPublic,e.hasOwnProperty("ts_message_offset")&&(this._messageOffsetTimestamp=e.ts_message_offset)}},{key:"addMember",value:function(e){if(!this.isSuper){var n=L.get(this._iid).Member,t=this.removeMember(e);t&&t.state===n.JOINED&&(e.state=n.JOINED),this.memberMap[e.userId]=e,this.members.push(e),this.memberCount++,this.updateReadReceipt(e.userId,0)}}},{key:"removeMember",value:function(e){var n=null;if(!this.isSuper&&this.memberMap.hasOwnProperty(e.userId)){delete this.memberMap[e.userId];for(var t=0;t<this.members.length;t++){var r=this.members[t];if(r.userId===e.userId){n=r,this.members.splice(t,1);break}}this.memberCount--}return n}},{key:"parse",value:function(e){this._update(e)}},{key:"update",value:function(e){this.__update(e),this._update(e)}},{key:"isIdentical",value:function(e){return e&&this.url===e.url}},{key:"isEqual",value:function(e){return te.deepEqual(this,e)}},{key:"createMemberListQuery",value:function(){return new(L.get(this._iid).MemberListQuery)(this.url)}},{key:"createBannedUserListQuery",value:function(){return new(L.get(this._iid).BannedUserListQuery)({channelUrl:this.url,isOpenChannel:this.isOpenChannel()})}},{key:"refresh",value:function(e){return L.get(this._iid).GroupChannel.getChannelWithoutCache(this.url,e)}},{key:"updateChannel",value:function(){var n=this,t=x.toArray(arguments),e=void 0;"function"==typeof t[t.length-1]&&(e=t.pop());var r=L.get(this._iid),i=r.GroupChannel,a=r.GroupChannelParams;if(t[0]instanceof a&&1===t.length)return V(this._iid,function(r){var e=t[0];(e.channelUrl=n.url,e._validate())?$.get(n._iid).container.apiClient.updateGroupChannel(y({},e),function(e,n){var t=null;e||(t=i.upsert(n)),r(e,t)}):r(x.error,null)},e);if(3===t.length){var s=new a;return s.channelUrl=this.url,s.name=t[0],"string"==typeof t[1]?s.coverUrl=t[1]:s.coverImage=t[1],s.data=t[2],this.updateChannel(s,e)}if(4===t.length){var o=new a;return o.channelUrl=this.url,o.isDistinct=t[0],o.name=t[1],"string"==typeof t[1]?o.coverUrl=t[2]:o.coverImage=t[2],o.data=t[3],this.updateChannel(o,e)}if(5!==t.length)return V(this._iid,function(e){return e(x.error,null)},e);var u=new a;return u.channelUrl=this.url,u.isDistinct=t[0],u.name=t[1],"string"==typeof t[2]?u.coverUrl=t[2]:u.coverImage=t[2],u.data=t[3],u.customType=t[4],this.updateChannel(u,e)}},{key:"invite",value:function(e,n){var t,r=g(x.parse(arguments,[new x({type:"array",constraint:function(e){return 0<e.length&&e.every(function(e){return!!e.userId&&"string"==typeof e.userId})}}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],t?V(this._iid,function(e){return e(x.error,null)},n):this.inviteWithUserIds(e.map(function(e){return e.userId}),n)}},{key:"inviteWithUserIds",value:function(e,n){var t,i=this,r=g(x.parse(arguments,[new x({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],V(this._iid,function(r){t?r(t,null):$.get(i._iid).container.apiClient.inviteToGroupChannel({channelUrl:i.url,userIds:e},function(e,n){var t=null;e||(t=L.get(i._iid).GroupChannel.upsert(n));r(e,t)})},n)}},{key:"acceptInvitation",value:function(e,n){var t,i=this,r=g(x.parse(arguments,[new x({type:"string",optional:!0,defaultValue:null}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],V(this._iid,function(r){t?r(t,null):$.get(i._iid).container.apiClient.acceptInvitation({channelUrl:i.url,accessCode:e},function(e,n){var t=null;e||((t=L.get(i._iid).GroupChannel.upsert(n)).myMemberState="joined");r(e,t)})},n)}},{key:"declineInvitation",value:function(e){var a=this;return V(this._iid,function(i){$.get(a._iid).container.apiClient.declineInvitation({channelUrl:a.url},function(e,n){var t=null;if(!e){var r=L.get(a._iid).GroupChannel;(t=r.upsert(n)).myMemberState="none",a.isPublic||r.removeCachedChannel(a.url)}i(e,t)})},e)}},{key:"join",value:function(e,n){var t,i=this,r=g(x.parse(arguments,[new x({type:"string",optional:!0,defaultValue:null}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],V(this._iid,function(r){t?r(t,null):$.get(i._iid).container.apiClient.joinGroupChannel({channelUrl:i.url,accessCode:e},function(e,n){var t=null;e||((t=L.get(i._iid).GroupChannel.upsert(n)).myMemberState="joined");r(e,t)})},n)}},{key:"leave",value:function(e){var n=this;return V(this._iid,function(t){$.get(n._iid).container.apiClient.leaveGroupChannel({channelUrl:n.url},function(e,n){return t(e,null)})},e)}},{key:"muteUser",value:function(e,n,t,r){return this.muteUserWithUserId(e?e.userId:null,n,t,r)}},{key:"muteUserWithUserId",value:function(e,n,r,t){var i,a=this,s=g(x.parse(arguments,[new x({type:"string"}),new x({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new x({type:"string",optional:!0,defaultValue:""}),new x({type:"callback"})]),5);return i=s[0],e=s[1],n=s[2],r=s[3],t=s[4],V(this._iid,function(t){i?t(i,null):$.get(a._iid).container.apiClient.muteUser({channelUrl:a.url,userId:e,description:r,seconds:n,isGroupChannel:!0},function(e,n){t(e,null)})},t)}},{key:"unmuteUser",value:function(e,n){return this.unmuteUserWithUserId(e?e.userId:null,n)}},{key:"unmuteUserWithUserId",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"string"}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.unmuteUser({channelUrl:i.url,userId:e,isGroupChannel:!0},function(e,n){t(e,null)})},n)}},{key:"banUser",value:function(e,n,t,r){return this.banUserWithUserId(e?e.userId:null,n,t,r)}},{key:"banUserWithUserId",value:function(e,n,r,t){var i,a=this,s=g(x.parse(arguments,[new x({type:"string"}),new x({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new x({type:"string"}),new x({type:"callback"})]),5);return i=s[0],e=s[1],n=s[2],r=s[3],t=s[4],V(this._iid,function(t){i?t(i,null):$.get(a._iid).container.apiClient.banUser({channelUrl:a.url,userId:e,description:r,seconds:n,isGroupChannel:!0},function(e,n){t(e,null)})},t)}},{key:"unbanUser",value:function(e,n){return this.unbanUserWithUserId(e?e.userId:null,n)}},{key:"unbanUserWithUserId",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"string"}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.unbanUser({channelUrl:i.url,userId:e,isGroupChannel:!0},function(e,n){t(e,null)})},n)}},{key:"updateJoinedMemberCount",value:function(){if(!this.isSuper){var n=L.get(this._iid).Member;this.joinedMemberCount=this.members.filter(function(e){return e.state===n.JOINED}).length}}},{key:"setLatestMemberCount",value:function(e,n,t){"number"==typeof e&&"number"==typeof n&&"number"==typeof t&&t>=be.get(this)&&(be.set(this,t),this.memberCount=e,this.joinedMemberCount=n)}},{key:"hide",value:function(i,a,e){var n,s=this,t=g(x.parse(arguments,[new x({type:"boolean",optional:!0,defaultValue:!1}),new x({type:"boolean",optional:!0,defaultValue:!0}),new x({type:"callback"})]),4);return n=t[0],i=t[1],a=t[2],e=t[3],V(this._iid,function(r){n?r(n,null):$.get(s._iid).container.apiClient.hideGroupChannel({channelUrl:s.url,hidePreviousMessages:i,allowAutoUnhide:a},function(e,n){if(!e){var t=L.get(s._iid).GroupChannel;s.isHidden=!0,s.hiddenState=a?t.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:t.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE,i&&s._setGroupChannelUnreadCount(0,0),n.hasOwnProperty("ts_message_offset")&&(s._messageOffsetTimestamp=n.ts_message_offset),t.cachedChannels[s.url]=s}r(e,n)})},e)}},{key:"unhide",value:function(e){var i=this;return V(this._iid,function(r){$.get(i._iid).container.apiClient.unhideGroupChannel({channelUrl:i.url},function(e,n){if(!e){var t=L.get(i._iid).GroupChannel;i.isHidden=!1,i.hiddenState=t.HiddenState.UNHIDDEN,t.cachedChannels[i.url]=i}r(e,n)})},e)}},{key:"freeze",value:function(e){var r=this;return V(this._iid,function(t){$.get(r._iid).container.apiClient.freeze({channelUrl:r.url,isGroupChannel:!0,freezing:!0},function(e,n){e||L.get(r._iid).GroupChannel.upsert(n);t(e,null)})},e)}},{key:"unfreeze",value:function(e){var r=this;return V(this._iid,function(t){$.get(r._iid).container.apiClient.freeze({channelUrl:r.url,isGroupChannel:!0,freezing:!1},function(e,n){e||L.get(r._iid).GroupChannel.upsert(n);t(e,null)})},e)}},{key:"delete",value:function(e){var r=this;return V(this._iid,function(t){$.get(r._iid).container.apiClient.deleteGroupChannel({channelUrl:r.url},function(e,n){e||L.get(r._iid).GroupChannel.removeCachedChannel(r.url);t(e,n)})},e)}},{key:"markAsRead",value:function(){var t=this,e=L.get(this._iid).Command,r=hn.getInstance(this._iid),n=e.bRead({channelUrl:this.url});r.sendCommand(n).then(function(e){if(t.updateReadReceipt(r.currentUser.userId,e.getJsonElement().ts),0<t.unreadMessageCount||0<t.unreadMentionCount)for(var n in t._setGroupChannelUnreadCount(0,0),r.channelHandlers){r.channelHandlers[n].onChannelChanged(t)}}).catch(function(e){})}},{key:"getReadReceipt",value:function(e){var n=hn.getInstance(this._iid);if(e instanceof J&&!e.isAdminMessage()&&n.currentUser){for(var t=0,r=e.createdAt,i=this.members,a=0;a<i.length;a++){var s=i[a];if(n.currentUser.userId!==s.userId&&(!e.sender||e.sender.userId!==s.userId))(this.cachedReadReceiptStatus[s.userId]||0)<r&&t++}return this.isSuper?0:t}return 0}},{key:"getReadMembers",value:function(e,n){var t=1<arguments.length&&void 0!==n&&n,r=hn.getInstance(this._iid);if(r.currentUser&&!this.isSuper&&e instanceof J&&!e.isAdminMessage()){for(var i=[],a=0;a<this.members.length;a++){var s=this.members[a];if(t||s.userId!==r.currentUser.userId&&s.userId!==e.sender.userId)(this.cachedReadReceiptStatus[s.userId]||0)>=e.createdAt&&i.push(s)}return i}return[]}},{key:"getUnreadMembers",value:function(e,n){var t=1<arguments.length&&void 0!==n&&n,r=hn.getInstance(this._iid);if(r.currentUser&&!this.isSuper&&e instanceof J&&!e.isAdminMessage()){for(var i=[],a=0;a<this.members.length;a++){var s=this.members[a];if(t||s.userId!==r.currentUser.userId&&s.userId!==e.sender.userId)(this.cachedReadReceiptStatus[s.userId]||0)<e.createdAt&&i.push(s)}return i}return[]}},{key:"getReadStatus",value:function(e){var r=this,i=0<arguments.length&&void 0!==e&&e,a=hn.getInstance(this._iid);if(!a.currentUser||this.isSuper)return{};function n(n){if(!i&&n===a.currentUser.userId)return"continue";var e=r.cachedReadReceiptStatus[n],t=r.members.filter(function(e){return e.userId===n});s[n]={user:0<t.length?t[0]:null,last_seen_at:parseInt(e)}}var s={};for(var t in this.cachedReadReceiptStatus)n(t);return s}},{key:"updateReadReceipt",value:function(e,n){var t=this.cachedReadReceiptStatus[e];if(!t||t<n){this.cachedReadReceiptStatus[e]=n;var r=hn.getInstance(this._iid);r.currentUser&&e===r.currentUser.userId&&(this.myLastRead=n)}}},{key:"startTyping",value:function(){var e=hn.getInstance(this._iid),n=(new Date).getTime(),t=e.Options.typingIndicatorThrottle;("number"!=typeof t||t<1e3||9e3<t)&&(t=1e3);var r=Ue.get(this);if(n-r.start>=t){r.end=0,r.start=n;var i=L.get(this._iid).Command.bTypeStart({channelUrl:this.url,time:r.start});e.sendCommand(i,null)}}},{key:"endTyping",value:function(){var e=hn.getInstance(this._iid),n=(new Date).getTime(),t=e.Options.typingIndicatorThrottle;("number"!=typeof t||t<1e3||9e3<t)&&(t=1e3);var r=Ue.get(this);if(n-r.end>=t){r.start=0,r.end=n;var i=L.get(this._iid).Command.bTypeEnd({channelUrl:this.url,time:r.end});e.sendCommand(i,null)}}},{key:"invalidateTypingStatus",value:function(){var e=Ee.get(this),n=(new Date).getTime(),t=!1;for(var r in e){1e4<=n-e[r]&&(delete e[r],t=!0)}return t}},{key:"getTypingMembers",value:function(){var e=Ee.get(this),n=[];for(var t in e){var r=this.memberMap[t];r&&n.push(r)}return n}},{key:"updateTypingStatus",value:function(e,n){var t=Ee.get(this);n?t[e.userId]=(new Date).getTime():delete t[e.userId]}},{key:"isTyping",value:function(){var e=Ee.get(this);return 0!==Object.keys(e).length}},{key:"registerScheduledUserMessage",value:function(e,n){var t,a=this,r=L.get(this._iid),s=r.ScheduledUserMessage,i=r.ScheduledUserMessageParams,o=g(x.parse(arguments,[new x({type:i,constraint:function(e){return"string"==typeof e.message&&"string"==typeof e._getScheduleString()}}),new x({type:"callback"})]),3);return t=o[0],e=o[1],n=o[2],V(this._iid,function(i){t?i(t,null):$.get(a._iid).container.apiClient.registerScheduledUserMessage({groupChannelParams:e,channelUrl:a.url,isOpenChannel:!1},function(e,n){var t=null;if(!e){t=new s(n);var r=hn.getInstance(a._iid).currentUser;r&&t._sender&&r.userId===t._sender.userId&&(r.nickname=t._sender.nickname,r.profileUrl=t._sender.profileUrl,r.metaData=t._sender.metaData)}i(e,t)})},n)}},{key:"getPushPreference",value:function(e){var i=this;return V(this._iid,function(r){$.get(i._iid).container.apiClient.getMyPushTriggerOption({channelUrl:i.url},function(e,n){var t=null;if(!e){try{t=response.enable}catch(e){t=!1}i.isPushEnabled=t}r&&r(e,t)})},e)}},{key:"setPushPreference",value:function(e,n){var i=this;return V(this._iid,function(t){var r=L.get(i._iid).GroupChannel;$.get(i._iid).container.apiClient.setMyPushTriggerOption({channelUrl:i.url,enable:e},function(e,n){e||(i.isPushEnabled=response.enable,i.isPushEnabled||(i.myPushTriggerOption=r.PushTriggerOption.OFF)),t(e,n)})},n)}},{key:"getMyPushTriggerOption",value:function(e){var i=this;return V(this._iid,function(r){$.get(i._iid).container.apiClient.getMyPushTriggerOption({channelUrl:i.url},function(e,n){var t=null;if(!e){try{t=n.push_trigger_option||a.PushTriggerOption.DEFAULT}catch(e){}i.myPushTriggerOption=t}r(e,t)})},e)}},{key:"setMyPushTriggerOption",value:function(e,n){var t,i=this,r=L.get(this._iid).GroupChannel,a=g(x.parse(arguments,[new x({type:r.PushTriggerOption}),new x({type:"callback"})]),3);return t=a[0],e=a[1],n=a[2],V(this._iid,function(r){t?r(t,null):$.get(i._iid).container.apiClient.setMyPushTriggerOption({channelUrl:i.url,pushTriggerOption:e},function(e,n){var t=null;if(!e){try{t=n.push_trigger_option}catch(e){}i.myPushTriggerOption=t}r(e,t)})},n)}},{key:"setMyCountPreference",value:function(e,n){var t,i=this,a=L.get(this._iid).GroupChannel,r=g(x.parse(arguments,[new x({type:a.CountPreference}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],V(this._iid,function(r){t?r(t,null):$.get(i._iid).container.apiClient.setMyCountPreference({channelUrl:i.url,countPreference:e},function(e,n){var t=null;e||(t=i.myCountPreference=n.count_preference,i._setGroupChannelUnreadCount(i.unreadMessageCount,i.unreadMentionCount),a.cachedChannels[i.url]=i),r(e,t)})},n)}},{key:"resetMyHistory",value:function(e){var i=this;return V(this._iid,function(r){$.get(i._iid).container.apiClient.resetMyHistory({channelUrl:i.url},function(e,n){if(!e&&n.hasOwnProperty("ts_message_offset")){var t=L.get(i._iid).GroupChannel;i._messageOffsetTimestamp=n.ts_message_offset,t.cachedChannels[i.url]=i}r(e,n)})},e)}},{key:"messageOffsetTimestamp",get:function(){return this._messageOffsetTimestamp}}],[{key:"buildFromSerializedData",value:function(e){var n,t=L.get(this._iid),r=t.User,i=t.Member,a=t.GroupChannel,s=t.BaseMessage,o=t.UserMessage,u=t.FileMessage,l=t.AdminMessage,c=W.deserialize(e);return new a({channel_url:c.url,name:c.name,cover_url:c.coverUrl,data:c.data,custom_type:c.customType,invited_at:c.invitedAt,created_at:c.createdAt/1e3,is_access_code_required:c.isAccessCodeRequired,is_distinct:c.isDistinct,is_super:c.isSuper,is_public:c.isPublic,is_discoverable:c.isDiscoverable,freeze:c.isFrozen,is_ephemeral:c.isEphemeral,unread_message_count:c.unreadMessageCount,unread_mention_count:c.unreadMentionCount,is_push_enabled:c.isPushEnabled,push_trigger_option:c.myPushTriggerOption,count_preference:c.myCountPreference,is_hidden:c.isHidden,hidden_state:c.hiddenState,member_count:c.memberCount,joined_member_count:c.joinedMemberCount,member_state:c.myMemberState,my_role:c.myRole,is_muted:c.myMutedState,user_last_read:c.myLastRead,ts_message_offset:c.messageOffsetTimestamp,members:c.members.map(function(e){return i.build(r.build(e.userId,e.nickname,e.profileUrl,e.connectionStatus,e.lastSeenAt,e.metaData,e.isActive,e.friendDiscoveryKey,e.friendName),e.state,e.isBlockedByMe,e.isBlockingMe)}),last_message:(n=c.lastMessage,null!=n&&"object"===Z(n)?n.messageType===s.MESSAGE_TYPE_USER?new o(o.build(n.reqId,n.messageId,n.user,{url:n.channelUrl,channelType:n.channelType},n.message,n.data,n.customType,n.translations,n.isGlobalBlocked,n.createdAt,n.updatedAt,n.metaArrays,n.mentionType,n.mentionedUsers,n.mentionedUserIds,n.requestState,n.requestedMentionUserIds)):n.messageType===s.MESSAGE_TYPE_FILE?new u(u.build(n.reqId,n.messageId,n.user,{url:n.channelUrl,channelType:n.channelType},n.url,n.name,n.type,n.size,n.data,n.customType,n.isGlobalBlocked,n.createdAt,n.thumbnails,n.requireAuth,n.updatedAt,n.metaArrays,n.mentionType,n.mentionedUsers,n.mentionedUserIds,n.requestState,n.requestedMentionUserIds)):new l(l.build(n.messageId,{url:n.channelUrl,channelType:n.channelType},n.message,n.data,n.customType,n.translations,n.createdAt,n.updatedAt,n.metaArrays,n.mentionType,n.mentionedUsers)):null),read_receipt:c.cachedReadReceiptStatus,inviter:null!==c.inviter&&void 0!==c.inviter&&"object"===Z(c.inviter)?r.build.apply(r,E(["userId","nickname","profileUrl","connectionStatus","lastSeenAt","metaData","isActive","friendDiscoveryKey","friendName"].map(function(e){return c.inviter[e]}))):null,__wk:c.__wk})}},{key:"upsert",value:function(e){var n=L.get(this._iid).GroupChannel,t=new n(e);if(n.cachedChannels.hasOwnProperty(t.url)){if(t.isEphemeral){var r=n.cachedChannels[t.url];e.last_message=r.lastMessage,e.unread_message_count=r.unreadMessageCount}n.cachedChannels[t.url].update(e)}else n.cachedChannels[t.url]=t;return n.cachedChannels[t.url]}},{key:"removeCachedChannel",value:function(e){var n=L.get(this._iid),t=n.GroupChannel,r=n.FileMessageQueue;t.cachedChannels[e]&&delete t.cachedChannels[e],r.delete(e)}},{key:"clearCache",value:function(){Ce[this._iid]={},L.get(this._iid).FileMessageQueue.clear()}},{key:"getChannel",value:function(n,e){var t,r=g(x.parse(arguments,[new x({type:"string"}),new x({type:"callback"})]),3);if(t=r[0],n=r[1],e=r[2],t)return V(this._iid,function(e){e(t,null)},e);var i=L.get(this._iid).GroupChannel;return i.cachedChannels[n]?V(this._iid,function(e){e(null,i.cachedChannels[n])},e):i.getChannelWithoutCache(n,e)}},{key:"getChannelWithoutCache",value:function(e,n){var t,i=this,r=g(x.parse(arguments,[new x({type:"string"}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],V(this._iid,function(r){t?r(t,null):$.get(i._iid).container.apiClient.getGroupChannel({channelUrl:e,showMember:!0,showReadReceipt:!0},function(e,n){var t=null;e||(t=L.get(i._iid).GroupChannel.upsert(n));r(e,t)})},n)}},{key:"createDistinctChannelIfNotExist",value:function(e,n){var t,a=this,r=L.get(this._iid).GroupChannelParams,i=g(x.parse(arguments,[new x({type:r,constraint:function(e){return e._validate()}}),new x({type:"callback"})]),3);return t=i[0],e=i[1],n=i[2],V(this._iid,function(i){t?i(t,null):(e.isPublic||(e.accessCode=null),$.get(a._iid).container.apiClient.createGroupChannel(y({},e,{isDistinct:!0}),function(e,n){var t=null;if(!e){var r=L.get(a._iid).GroupChannel;t={channel:new r(n),isCreated:n.is_created},r.cachedChannels[t.channel.url]=t.channel}i(e,t)}))},n)}},{key:"createChannel",value:function(){var n=this,t=x.toArray(arguments),e=void 0;"function"==typeof t[t.length-1]&&(e=t.pop());var r=L.get(this._iid),i=r.GroupChannel,a=r.GroupChannelParams;if(t[0]instanceof a&&1===t.length)return V(this._iid,function(r){var e=t[0];(e.isPublic||(e.accessCode=null),e._validate())?$.get(n._iid).container.apiClient.createGroupChannel(e,function(e,n){var t=null;e||(t=new i(n),i.cachedChannels[t.url]=t),r(e,t)}):r(x.error,null)},e);if(Array.isArray(t[0])){var s=new a;switch(t.length){case 1:s.addUsers(t[0]);break;case 2:s.addUsers(t[0]),s.isDistinct=t[1];break;case 3:s.addUsers(t[0]),s.isDistinct=t[1],s.customType=t[2];break;case 5:s.addUsers(t[0]),s.isDistinct=t[1],s.name=t[2],"string"==typeof t[3]?s.coverUrl=t[3]:s.coverImage=t[3],s.data=t[4];break;case 6:s.addUsers(t[0]),s.isDistinct=t[1],s.name=t[2],"string"==typeof t[3]?s.coverUrl=t[3]:s.coverImage=t[3],s.data=t[4],s.customType=t[5];break;default:return V(this._iid,function(e){return e(x.error,null)},e)}return i.createChannel(s,e)}return V(this._iid,function(e){return e(x.error,null)},e)}},{key:"createChannelWithUserIds",value:function(){var e=x.toArray(arguments),n=void 0;"function"==typeof e[e.length-1]&&(n=e.pop());var t=L.get(this._iid),r=t.GroupChannel,i=new t.GroupChannelParams;switch(e.length){case 1:i.addUserIds(e[0]);break;case 2:i.addUserIds(e[0]),i.isDistinct=e[1];break;case 3:i.addUserIds(e[0]),i.isDistinct=e[1],i.customType=e[2];break;case 5:i.addUserIds(e[0]),i.isDistinct=e[1],i.name=e[2],"string"==typeof e[3]?i.coverUrl=e[3]:i.coverImage=e[3],i.data=e[4];break;case 6:i.addUserIds(e[0]),i.isDistinct=e[1],i.name=e[2],"string"==typeof e[3]?i.coverUrl=e[3]:i.coverImage=e[3],i.data=e[4],i.customType=e[5];break;default:return V(this._iid,function(e){return e(x.error,null)},n)}return r.createChannel(i,n)}},{key:"createMyGroupChannelListQuery",value:function(){return new(L.get(this._iid).GroupChannelListQuery)}},{key:"createPublicGroupChannelListQuery",value:function(){return new(L.get(this._iid).PublicGroupChannelListQuery)}},{key:"getChannelCount",value:function(e,n){return hn.getInstance(this._iid).getGroupChannelCount(e,n)}},{key:"getUnreadItemCount",value:function(e,n){return hn.getInstance(this._iid).getUnreadItemCount(e,n)}},{key:"getTotalUnreadMessageCount",value:function(){var e=x.toArray(arguments),n="function"==typeof e[e.length-1]?e.pop():null,t=hn.getInstance(this._iid);return t.getTotalUnreadMessageCount.apply(t,E(e).concat([n]))}},{key:"getTotalUnreadChannelCount",value:function(e){return hn.getInstance(this._iid).getTotalUnreadChannelCount(e)}},{key:"MemberStateFilter",get:function(){return{ALL:"all",JOINED:"joined_only",INVITED:"invited_only",INVITED_BY_FRIEND:"invited_by_friend",INVITED_BY_NON_FRIEND:"invited_by_non_friend"}}},{key:"PushTriggerOption",get:function(){return{DEFAULT:"default",ALL:"all",MENTION_ONLY:"mention_only",OFF:"off"}}},{key:"CountPreference",get:function(){return{ALL:"all",UNREAD_MESSAGE_COUNT_ONLY:"unread_message_count_only",UNREAD_MENTION_COUNT_ONLY:"unread_mention_count_only",OFF:"off"}}},{key:"HiddenState",get:function(){return{UNHIDDEN:"unhidden",HIDDEN_ALLOW_AUTO_UNHIDE:"hidden_allow_auto_unhide",HIDDEN_PREVENT_AUTO_UNHIDE:"hidden_prevent_auto_unhide"}}},{key:"PublicChannelFilter",get:function(){return{ALL:"all",PUBLIC:"public",PRIVATE:"private"}}},{key:"SuperChannelFilter",get:function(){return{ALL:"all",SUPER:"super",NON_SUPER:"nonsuper"}}},{key:"UnreadChannelFilter",get:function(){return{ALL:"all",UNREAD_MESSAGE:"unread_message"}}},{key:"HiddenChannelFilter",get:function(){return{UNHIDDEN:"unhidden_only",HIDDEN:"hidden_only",HIDDEN_ALLOW_AUTO_UNHIDE:"hidden_allow_auto_unhide",HIDDEN_PREVENT_AUTO_UNHIDE:"hidden_prevent_auto_unhide"}}},{key:"Role",get:function(){return{OPERATOR:"operator",NONE:"none"}}},{key:"UnreadItemKey",get:function(){return{GROUP_CHANNEL_UNREAD_MENTION_COUNT:"group_channel_unread_mention_count",NONSUPER_UNREAD_MENTION_COUNT:"non_super_group_channel_unread_mention_count",SUPER_UNREAD_MENTION_COUNT:"super_group_channel_unread_mention_count",GROUP_CHANNEL_UNREAD_MESSAGE_COUNT:"group_channel_unread_message_count",NONSUPER_UNREAD_MESSAGE_COUNT:"non_super_group_channel_unread_message_count",SUPER_UNREAD_MESSAGE_COUNT:"super_group_channel_unread_message_count",GROUP_CHANNEL_INVITATION_COUNT:"group_channel_invitation_count",NONSUPER_INVITATION_COUNT:"non_super_group_channel_invitation_count",SUPER_INVITATION_COUNT:"super_group_channel_invitation_count"}}},{key:"cachedChannels",get:function(){return Ce[this._iid]||(Ce[this._iid]={}),Ce[this._iid]}},{key:"markAsReadAllLastSentAt",get:function(){return ve[this._iid]||0},set:function(e){ve[this._iid]=e}}]),a}();(m()||C())&&A(le,Ae);var Ne={},Se={},Ie=function(){function t(e){var n;return _(this,t),(n=d(this,u(t).call(this,e))).channelType=le.CHANNEL_TYPE_OPEN,n.participantCount=0,n.operators=[],e&&n._update(e),n}return o(t,le),s(t,[{key:"_update",value:function(e){var n=L.get(this._iid).User;if(e.hasOwnProperty("participant_count")&&(this.participantCount=parseInt(e.participant_count)),e.hasOwnProperty("operators")&&e.operators){this.operators=[];for(var t=0;t<e.operators.length;t++){var r=new n(e.operators[t]);this.operators.push(r)}}}},{key:"parse",value:function(e){this._update(e)}},{key:"update",value:function(e){this.__update(e),this._update(e)}},{key:"createParticipantListQuery",value:function(){return new(L.get(this._iid).ParticipantListQuery)({channelUrl:this.url})}},{key:"createMutedUserListQuery",value:function(){return new(L.get(this._iid).MutedUserListQuery)({channelUrl:this.url,isOpenChannel:!0})}},{key:"createBannedUserListQuery",value:function(){return new(L.get(this._iid).BannedUserListQuery)({channelUrl:this.url,isOpenChannel:!0})}},{key:"isOperator",value:function(e){return!!e&&this.isOperatorWithUserId(e.userId)}},{key:"isOperatorWithUserId",value:function(e){return-1<this.operators.map(function(e){return e.userId}).indexOf(e)}},{key:"refresh",value:function(e){return L.get(this._iid).OpenChannel.getChannelWithoutCache(this.url,e)}},{key:"enter",value:function(e){var t=this;return V(this._iid,function(n){var e=L.get(t._iid).Command.bEnter({channelUrl:t.url});hn.getInstance(t._iid).sendCommand(e).then(function(){L.get(t._iid).OpenChannel.enteredChannels[t.url]=t,n(null,null)}).catch(function(e){e=e?new ee(e.message,e.code):null,n(e,null)})},e)}},{key:"exit",value:function(e){var a=this;return V(this._iid,function(n){var e=L.get(a._iid),t=e.Command,r=e.FileMessageQueue,i=t.bExit({channelUrl:a.url});hn.getInstance(a._iid).sendCommand(i).then(function(){delete L.get(a._iid).OpenChannel.enteredChannels[a.url],r.delete(a.url),n(null,null)}).catch(function(e){e=e?new ee(e.message,e.code):null,n(e,null)})},e)}},{key:"updateChannel",value:function(e,n,t,i,a,r){var s,o=this,u=g(x.parse(arguments,[new x({type:"string",nullable:!0}),new x({type:["string","file"],nullable:!0}),new x({type:"string",nullable:!0}),new x({type:"array",nullable:!0,optional:!0,defaultValue:[],constraint:function(e){return e.map(function(e){return"string"==typeof e})}}),new x({type:"string",nullable:!0,optional:!0}),new x({type:"callback"})]),7);return s=u[0],e=u[1],n=u[2],t=u[3],i=u[4],a=u[5],r=u[6],V(this._iid,function(r){s?r(s,null):$.get(o._iid).container.apiClient.updateOpenChannel({channelUrl:o.url,name:e,coverUrlOrImage:n,data:t,operatorUserIds:i,customType:a},function(e,n){var t=null;e||(t=L.get(o._iid).OpenChannel.upsert(n));r(e,t)})},r)}},{key:"updateChannelWithOperatorUserIds",value:function(){var e=x.toArray(arguments),n=void 0;switch("function"==typeof e[e.length-1]&&(n=e.pop()),e.length){case 4:case 5:return this.updateChannel.apply(this,E(e).concat([n]));default:return V(this._iid,function(e){return e(x.error,null)},n)}}},{key:"muteUser",value:function(e,n,t,r){return this.muteUserWithUserId(e?e.userId:null,n,t,r)}},{key:"muteUserWithUserId",value:function(e,n,r,t){var i,a=this,s=g(x.parse(arguments,[new x({type:"string"}),new x({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new x({type:"string",optional:!0,defaultValue:""}),new x({type:"callback"})]),5);return i=s[0],e=s[1],n=s[2],r=s[3],t=s[4],V(this._iid,function(t){i?t(i,null):$.get(a._iid).container.apiClient.muteUser({channelUrl:a.url,userId:e,description:r,seconds:n,isGroupChannel:!1},function(e,n){t(e,null)})},t)}},{key:"unmuteUser",value:function(e,n){return this.unmuteUserWithUserId(e?e.userId:null,n)}},{key:"unmuteUserWithUserId",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"string"}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.unmuteUser({channelUrl:i.url,userId:e,isGroupChannel:!1},function(e,n){t(e,null)})},n)}},{key:"banUser",value:function(e,n,t){return this.banUserWithUserId(e?e.userId:null,n,t)}},{key:"banUserWithUserId",value:function(e,n,t){var r,i=this,a=g(x.parse(arguments,[new x({type:"string"}),new x({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new x({type:"callback"})]),4);return r=a[0],e=a[1],n=a[2],t=a[3],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.banUser({channelUrl:i.url,userId:e,description:null,seconds:n,isGroupChannel:!1},function(e,n){t(e,null)})},t)}},{key:"unbanUser",value:function(e,n){return this.unbanUserWithUserId(e?e.userId:null,n)}},{key:"unbanUserWithUserId",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"string"}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.unbanUser({channelUrl:i.url,userId:e,isGroupChannel:!1},function(e,n){t(e,null)})},n)}},{key:"delete",value:function(e){var r=this;return V(this._iid,function(t){$.get(r._iid).container.apiClient.deleteOpenChannel({channelUrl:r.url},function(e,n){e||(delete L.get(r._iid).OpenChannel.cachedChannels[r.url],L.get(r._iid).FileMessageQueue.delete(r.url));t(e,n)})},e)}}],[{key:"buildFromSerializedData",value:function(e){var n=L.get(this._iid),t=n.User,r=n.OpenChannel,i=W.deserialize(e);return new r({channel_url:i.url,name:i.name,cover_url:i.coverUrl,data:i.data,custom_type:i.customType,created_at:i.createdAt/1e3,freeze:i.isFrozen,is_ephemeral:i.isEphemeral,participant_count:i.participantCount,operators:i.operators.map(function(n){return t.build.apply(t,E(["userId","nickname","profileUrl","connectionStatus","lastSeenAt","metaData","isActive","friendDiscoveryKey","friendName"].map(function(e){return n[e]})))}),__wk:i.__wk})}},{key:"getChannel",value:function(n,e){var t,r=g(x.parse(arguments,[new x({type:"string",constraint:function(e){return 0<e.length}}),new x({type:"callback"})]),3);if(t=r[0],n=r[1],e=r[2],t)return V(this._iid,function(e){e(t,null)},e);var i=L.get(this._iid).OpenChannel;return i.cachedChannels[n]?V(this._iid,function(e){e(null,i.cachedChannels[n])},e):i.getChannelWithoutCache(n,e)}},{key:"getChannelWithoutCache",value:function(e,n){var t,i=this,r=g(x.parse(arguments,[new x({type:"string",constraint:function(e){return 0<e.length}}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],V(this._iid,function(r){t?r(t,null):$.get(i._iid).container.apiClient.getOpenChannel({channelUrl:e},function(e,n){var t=null;e||(t=L.get(i._iid).OpenChannel.upsert(n));r(e,t)})},n)}},{key:"createChannel",value:function(e,n,t,i,a,r){var s,o=this,u=g(x.parse(arguments,[new x({type:"string",nullable:!0,ignoreIf:function(e){return 0===e.length}}),new x({type:["string","file"],nullable:!0,ignoreIf:function(e){return 0===e.length}}),new x({type:"string",nullable:!0,ignoreIf:function(e){return 0===e.length}}),new x({type:"array",nullable:!0,ignoreIf:function(e){return e.length<4},constraint:function(e){return e.map(function(e){return"string"==typeof e})}}),new x({type:"string",nullable:!0,ignoreIf:function(e){return e.length<5}}),new x({type:"callback"})]),7);return s=u[0],e=u[1],n=u[2],t=u[3],i=u[4],a=u[5],r=u[6],V(this._iid,function(r){s?r(s,null):$.get(o._iid).container.apiClient.createOpenChannel({name:e,coverUrlOrImage:n,data:t,operatorUserIds:i,customType:a},function(e,n){var t=null;e||(t=L.get(o._iid).OpenChannel.upsert(n));r(e,t)})},r)}},{key:"createChannelWithOperatorUserIds",value:function(){var e=x.toArray(arguments),n=void 0;switch("function"==typeof e[e.length-1]&&(n=e.pop()),e.length){case 4:case 5:return this.createChannel.apply(this,E(e).concat([n]));default:return V(this._iid,function(e){return e(x.error,null)},n)}}},{key:"upsert",value:function(e){var n=new(L.get(this._iid).OpenChannel)(e);return this.cachedChannels.hasOwnProperty(n.url)?this.cachedChannels[n.url].update(e):this.cachedChannels[n.url]=n,this.cachedChannels[n.url]}},{key:"removeCachedChannel",value:function(e){this.cachedChannels[e]&&delete this.cachedChannels[e],L.get(this._iid).FileMessageQueue.delete(e)}},{key:"clearCache",value:function(){Ne[this._iid]={},L.get(this._iid).FileMessageQueue.clear()}},{key:"clearEnteredChannels",value:function(){Se[this._iid]={}}},{key:"createOpenChannelListQuery",value:function(){return new(L.get(this._iid).OpenChannelListQuery)}},{key:"cachedChannels",get:function(){return Ne[this._iid]||(Ne[this._iid]={}),Ne[this._iid]}},{key:"enteredChannels",get:function(){return Se[this._iid]||(Se[this._iid]={}),Se[this._iid]}}]),t}();(m()||C())&&A(le,Ie);var ke=function(){function t(e){var n;return _(this,t),(n=d(this,u(t).call(this,e))).messageType=J.MESSAGE_TYPE_USER,n.message=null,n._sender=null,n.reqId="",n.translations={},n.requestState=null,n.requestedMentionUserIds=[],n.errorCode=0,e&&n._update(e),n}return o(t,J),s(t,[{key:"_update",value:function(e){var n=L.get(this._iid).Sender;this.message=String(e.message),this._sender=new n(e.user),this.reqId=e.hasOwnProperty("req_id")?String(e.req_id):"",this.translations=e.hasOwnProperty("translations")?e.translations:{},this.requestState=0<this.messageId?J.MessageRequestState.SUCCEEDED:J.MessageRequestState.FAILED,e.hasOwnProperty("request_state")&&(this.requestState=e.request_state),this.requestedMentionUserIds=[],e.hasOwnProperty("requested_mention_user_ids")&&(this.requestedMentionUserIds=e.requested_mention_user_ids),this.errorCode=0,e.hasOwnProperty("error_code")&&(this.errorCode=e.error_code)}},{key:"isResendable",value:function(){return"failed"===this.requestState&&te.isResendableError(this.errorCode)}},{key:"sender",get:function(){var e=hn.getInstance(this._iid),n=L.get(this._iid).GroupChannel;if(e.Options.useMemberAsMessageSender&&this.isGroupChannel()){var t=n.cachedChannels[this.channelUrl];if(t){var r=t.memberMap[this._sender.userId];r&&(this._sender.nickname!==r.nickname&&(this._sender.nickname=r.nickname),this._sender.profileUrl!==r.profileUrl&&(this._sender.profileUrl=r.profileUrl),te.deepEqual(this._sender.metaData,r.metaData)||(this._sender.metaData=r.metaData))}}return this._sender},set:function(e){this._sender=e}}],[{key:"build",value:function(e,n,t,r,i,a,s,o,u,l,c,d,h,p,f,_,y,g){var m=L.get(this._iid),C=m.BaseChannel,v=m.BaseMessageParams,E={};e&&(E.req_id=e),E.msg_id=n,E.channel_url=r.url,E.channel_type=r.channelType===C.CHANNEL_TYPE_OPEN?C.CHANNEL_TYPE_OPEN:C.CHANNEL_TYPE_GROUP,E.ts=l,E.updated_at=c,E.message=i,a&&(E.data=a),s&&(E.custom_type=s),o&&(E.translations=o);var U={user_id:"",nickname:"",profile_url:"",metadata:{},is_blocked_by_me:!1};if(t){U.user_id=t.userId,U.nickname=t.nickname,U.profile_url=t.profileUrl;try{U.metadata="string"==typeof t.metaData?JSON.parse(t.metaData):t.metaData}catch(e){U.metadata={}}U.is_blocked_by_me=t.isBlockedByMe}if(E.user=U,E.is_global_block=!!u,d){E.metaarray={};for(var b=0;b<d.length;b++){var A=d[b].key;E.metaarray[A]=d[b].value}E.metaarray_key_order=d.map(function(e){return e.key})}return E.mention_type=v.MentionType.USERS,h&&(E.mention_type=h),E.mentioned_users=[],p&&(E.mentioned_users=p),E.request_state=0<n?J.MessageRequestState.SUCCEEDED:J.MessageRequestState.FAILED,_&&(E.request_state=_),f&&(E.mentioned_user_ids=f),E.requested_mention_user_ids=[],y&&(E.requested_mention_user_ids=y),E.error_code=g||0,E}},{key:"buildFromSerializedData",value:function(e){var n=L.get(this._iid),t=n.User,r=n.UserMessage,i=[],a=W.deserialize(e,function(e){e.mentionedUsers.forEach(function(n){i.push(t.build.apply(t,E(["userId","nickname","profileUrl","connectionStatus","lastSeenAt","metaData","isActive","friendDiscoveryKey","friendName"].map(function(e){return n[e]}))))})});return new r(r.build(a.reqId,a.messageId,a.sender,{url:a.channelUrl,channelType:a.channelType},a.message,a.data,a.customType,a.translations,a.isGlobalBlocked,a.createdAt,a.updatedAt,a.metaArrays,a.mentionType,i,a.mentionedUserIds,a.requestState,a.requestedMentionUserIds,a.errorCode))}}]),t}();(m()||C())&&A(J,ke);var Re=function(){function t(e){var n;return _(this,t),(n=d(this,u(t).call(this,e))).messageType=J.MESSAGE_TYPE_FILE,n.url=null,n.name="File",n.size=0,n.type=null,n.data=null,n.thumbnails=[],n._sender=null,n.reqId="",n.requireAuth=null,n.requestState=null,n.requestedMentionUserIds=[],n.errorCode=0,e&&n._update(e),n}return o(t,J),s(t,[{key:"_update",value:function(e){var n=$.get(this._iid).container.auth,t=L.get(this._iid).Sender;if(this._sender=new t(e.user),this.requireAuth=!!e.hasOwnProperty("require_auth")&&e.require_auth,this.url=this.requireAuth?String(e.url).split("?auth=")[0]+"?auth="+n.eKey:String(e.url).split("?auth=")[0],this.name=e.hasOwnProperty("name")?e.name:"File",this.size=parseInt(e.size)||0,this.type=String(e.type),this.data=e.hasOwnProperty("custom")?String(e.custom):"",this.reqId=e.hasOwnProperty("req_id")?String(e.req_id):"",this.thumbnails=e.hasOwnProperty("thumbnails")?e.thumbnails:[],this.requireAuth)for(var r in this.thumbnails)this.thumbnails[r].url=String(this.thumbnails[r].url).split("?auth=")[0]+"?auth="+n.eKey;this.requestState=0<this.messageId?J.MessageRequestState.SUCCEEDED:J.MessageRequestState.FAILED,e.hasOwnProperty("request_state")&&(this.requestState=e.request_state),this.requestedMentionUserIds=[],e.hasOwnProperty("requested_mention_user_ids")&&(this.requestedMentionUserIds=e.requested_mention_user_ids),this.errorCode=0,e.hasOwnProperty("error_code")&&(this.errorCode=e.error_code)}},{key:"isResendable",value:function(){return"failed"===this.requestState&&te.isResendableError(this.errorCode)}},{key:"sender",get:function(){var e=hn.getInstance(this._iid),n=L.get(this._iid).GroupChannel;if(e.Options.useMemberAsMessageSender&&this.isGroupChannel()){var t=n.cachedChannels[this.channelUrl];if(t){var r=t.memberMap[this._sender.userId];r&&(this._sender.nickname!==r.nickname&&(this._sender.nickname=r.nickname),this._sender.profileUrl!==r.profileUrl&&(this._sender.profileUrl=r.profileUrl),te.deepEqual(this._sender.metaData,r.metaData)||(this._sender.metaData=r.metaData))}}return this._sender},set:function(e){this._sender=e}}],[{key:"build",value:function(e,n,t,r,i,a,s,o,u,l,c,d,h,p,f,_,y,g,m,C,v,E){var U=L.get(this._iid),b=U.BaseChannel,A=U.BaseMessageParams,N={};N.req_id=e,N.msg_id=n,N.channel_url=r.url,N.channel_type=r.channelType===b.CHANNEL_TYPE_OPEN?b.CHANNEL_TYPE_OPEN:b.CHANNEL_TYPE_GROUP,N.ts=d,N.updated_at=f,N.url=i,N.name=a,N.type=s,N.size=o,N.custom=u;var S={user_id:"",nickname:"",profile_url:"",metadata:{},is_global_block:!1};if(t){S.user_id=t.userId,S.nickname=t.nickname,S.profile_url=t.profileUrl;try{S.metadata=JSON.parse(t.metaData)}catch(e){S.metadata={}}S.is_blocked_by_me=t.isBlockedByMe}if(N.user=S,l&&(N.custom_type=l),p&&(N.require_auth=p),h&&(N.thumbnails=h),N.is_global_block=c,_){N.metaarray={};for(var I=0;I<_.length;I++){var k=_[I].key;N.metaarray[k]=_[I].value}N.metaarray_key_order=_.map(function(e){return e.key})}return N.mention_type=A.MentionType.USERS,y&&(N.mention_type=y),N.mentioned_users=[],g&&(N.mentioned_users=g),m&&(N.mentioned_user_ids=m),N.request_state=0<n?J.MessageRequestState.SUCCEEDED:J.MessageRequestState.FAILED,C&&(N.request_state=C),N.requested_mention_user_ids=[],v&&(N.requested_mention_user_ids=v),N.error_code=E||0,N}},{key:"buildFromSerializedData",value:function(e){var n=L.get(this._iid),t=n.User,r=n.FileMessage,i=[],a=W.deserialize(e,function(e){e.mentionedUsers.forEach(function(n){i.push(t.build.apply(t,E(["userId","nickname","profileUrl","connectionStatus","lastSeenAt","metaData","isActive","friendDiscoveryKey","friendName"].map(function(e){return n[e]}))))})});return new r(r.build(a.reqId,a.messageId,a.sender,{url:a.channelUrl,channelType:a.channelType},a.url,a.name,a.type,a.size,a.data,a.customType,a.isGlobalBlocked,a.createdAt,a.thumbnails,a.requireAuth,a.updatedAt,a.metaArrays,a.mentionType,i,a.mentionedUserIds,a.requestState,a.requestedMentionUserIds,a.errorCode))}}]),t}();(m()||C())&&A(J,Re);var Oe=function(){function t(e){var n;return _(this,t),(n=d(this,u(t).call(this,e))).messageType=J.MESSAGE_TYPE_ADMIN,n.message="",n.translations={},e&&n._update(e),n}return o(t,J),s(t,[{key:"_update",value:function(e){this.message=String(e.message),this.translations=e.hasOwnProperty("translations")?e.translations:{}}}],[{key:"build",value:function(e,n,t,r,i,a,s,o,u,l,c){var d=L.get(this._iid).BaseChannel,h={msg_id:e,channel_url:n.url,channel_type:n.channelType===d.CHANNEL_TYPE_OPEN?d.CHANNEL_TYPE_OPEN:d.CHANNEL_TYPE_GROUP,ts:s,updated_at:o,message:t,data:r};if(i&&(h.custom_type=i),a&&(h.translations=a),u){h.metaarray={};for(var p=0;p<u.length;p++){var f=u[p].key;h.metaarray[f]=u[p].value}h.metaarray_key_order=u.map(function(e){return e.key})}return l&&(h.mention_type=l),h.mentioned_users=[],c&&(h.mentioned_users=c),h}},{key:"buildFromSerializedData",value:function(e){var n=L.get(this._iid),t=n.AdminMessage,r=n.User,i=[],a=W.deserialize(e,function(e){e.mentionedUsers.forEach(function(n){i.push(r.build.apply(r,E(["userId","nickname","profileUrl","connectionStatus","lastSeenAt","metaData","isActive","friendDiscoveryKey","friendName"].map(function(e){return n[e]}))))})});return new t(t.build(a.messageId,{url:a.channelUrl,channelType:a.channelType},a.message,a.data,a.customType,a.translations,a.createdAt,a.updatedAt,a.metaArrays,a.mentionType,i))}}]),t}();(m()||C())&&A(J,Oe);var Te=function(){function d(e){_(this,d);var n=L.get(this._iid),t=n.BaseMessage,r=n.BaseMessageParams;this.scheduledId=0,this.scheduledDateTimeString="",this.scheduledTimezone="",this.status=d.Status.SCHEDULED,this.createdAt=0,this.updatedAt=0,this._messageType=t.MESSAGE_TYPE_BASE,this._sender=null,this._channelType="",this.channelUrl="",this.message="",this.customType="",this.data="",this.metaArrays=[],this.mentionType=r.MentionType.USERS,this.mentionedUsers=[],this.pushNotificationDeliveryOption=r.PushNotificationDeliveryOption.DEFAULT,this.translationTargetLanguages=[],this.errorMessage="",this.errorCode=0,e&&this._update(e)}return s(d,[{key:"_update",value:function(e){var t=this,n=L.get(this._iid),r=n.User,i=n.Sender,a=n.BaseMessageParams,s=n.MessageMetaArray;this.scheduledId=e.hasOwnProperty("scheduled_id")?parseInt(e.scheduled_id):0,this.scheduledDateTimeString=e.hasOwnProperty("scheduled_dt")?String(e.scheduled_dt):"",this.scheduledTimezone=e.hasOwnProperty("scheduled_timezone")?String(e.scheduled_timezone):"",this.status=e.hasOwnProperty("status")?String(e.status):"",this.createdAt=e.hasOwnProperty("created_at")?parseInt(e.created_at):0,this.updatedAt=e.hasOwnProperty("updated_at")?parseInt(e.updated_at):0,this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this._channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):"",this._messageType=e.hasOwnProperty("type")?String(e.type):"",this._sender=e.hasOwnProperty("user")?new i(e.user):"",this.message=e.hasOwnProperty("message")?String(e.message):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.data=e.hasOwnProperty("data")?String(e.data):"";var o=e.hasOwnProperty("metaarray")?e.metaarray:{},u=e.hasOwnProperty("metaarray_key_order")?e.metaarray_key_order:Object.keys(o).sort(function(e,n){return e.localeCompare(n)});this.metaArrays=[];for(var l=0;l<u.length;l++){var c=u[l];this.metaArrays.push(new s(c,o[c]||[]))}this.mentionType=e.hasOwnProperty("mention_type")?e.mention_type:a.MentionType.USERS,this.mentionedUsers=[],e.hasOwnProperty("mentioned_users")&&e.mentioned_users.forEach(function(e){var n=new r(e);t.mentionedUsers.push(n)});this.pushNotificationDeliveryOption=e.hasOwnProperty("push_option")?e.push_option:a.PushNotificationDeliveryOption.DEFAULT,this.translationTargetLanguages=e.hasOwnProperty("translation_target_langs")?e.translation_target_langs:[],this.status===d.Status.FAILED&&(e.hasOwnProperty("error")&&e.error.hasOwnProperty("message")&&(this.errorMessage=String(e.error.message)),e.hasOwnProperty("error")&&e.error.hasOwnProperty("code")&&(this.errorCode=parseInt(e.error.code)))}},{key:"isOpenChannel",value:function(){var e=L.get(this._iid).BaseChannel;return this._channelType===e.CHANNEL_TYPE_OPEN}},{key:"isGroupChannel",value:function(){var e=L.get(this._iid).BaseChannel;return this._channelType===e.CHANNEL_TYPE_GROUP}},{key:"sender",get:function(){var e=hn.getInstance(this._iid),n=L.get(this._iid).GroupChannel;if(e.Options.useMemberAsMessageSender&&this.isGroupChannel()){var t=n.cachedChannels[this.channelUrl];if(t){var r=t.memberMap[this._sender.userId];r&&(this._sender.nickname!==r.nickname&&(this._sender.nickname=r.nickname),this._sender.profileUrl!==r.profileUrl&&(this._sender.profileUrl=r.profileUrl),Validator.deepEqual(this._sender.metaData,r.metaData)||(this._sender.metaData=r.metaData))}}return this._sender},set:function(e){this._sender=e}},{key:"metaArray",get:function(){var n={};return this.metaArrays.forEach(function(e){n[e.key]=e.value}),n},set:function(e){if("object"===Z(e)&&e){var n=L.get(this._iid).MessageMetaArray,t=[];for(var r in e)t.push(new n(r,e[r]));this.metaArrays=t}}}],[{key:"Status",get:function(){return{SCHEDULED:"scheduled",SENT:"sent",CANCELED:"canceled",FAILED:"failed"}}}]),d}(),Me=function(){function e(){_(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.userIdsFilter=[],this.metaDataKeyFilter="",this.metaDataValuesFilter=[],this._token=""}return s(e,[{key:"next",value:function(e){var s=this;return V(this._iid,function(a){"number"==typeof s.limit&&0<s.limit&&Array.isArray(s.userIdsFilter)&&"string"==typeof s.metaDataKeyFilter&&Array.isArray(s.metaDataValuesFilter)&&!!s.metaDataKeyFilter==0<s.metaDataValuesFilter.length?s.isLoading?a(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,$.get(s._iid).container.apiClient.loadUserList(y({},s,{token:s._token}),function(e,n){var t=null;if(!e){var r=L.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.users.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(x.error,null)},e)}}]),e}(),Le=function(){function n(e){_(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._isOpenChannel=!1,this._channelUrl=null,this._token="",e.channelUrl&&(this._channelUrl=e.channelUrl),e.isOpenChannel&&(this._isOpenChannel=e.isOpenChannel)}return s(n,[{key:"next",value:function(e){var s=this;return V(this._iid,function(a){"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,$.get(s._iid).container.apiClient.loadBannedUserList(y({},s,{channelUrl:s._channelUrl,isOpenChannel:s._isOpenChannel,token:s._token}),function(e,n){var t=null;if(!e){var r=L.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.banned_list.map(function(e){return new r(e.user)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(x.error,null)},e)}}]),n}(),we=function(){function e(){_(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.userIdsFilter=[],this._token=""}return s(e,[{key:"next",value:function(e){var s=this;return V(this._iid,function(a){"number"==typeof s.limit&&0<s.limit&&Array.isArray(s.userIdsFilter)?s.isLoading?a(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,$.get(s._iid).container.apiClient.loadBlockedUserList(y({},s,{token:s._token}),function(e,n){var t=null;if(!e){var r=L.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.users.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(x.error,null)},e)}}]),e}(),Pe=function(){function e(){_(this,e),this.isLoading=!1,this.hasMore=!0,this.limit=20,this._token=""}return s(e,[{key:"next",value:function(e){var s=this;return V(this._iid,function(a){"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null):s.hasMore?(s.isLoading=!0,$.get(s._iid).container.apiClient.loadFriendList(y({},s,{token:s._token}),function(e,n){var t=null;if(!e){var r=L.get(s._iid).User,i=String(n.next);s._token=i,s.hasMore=!!i,t=n.users.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(x.error,null)},e)}}]),e}(),De=function(){function n(){_(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.includeEmpty=!1,this.order=n.ORDER_LATEST_LAST_MESSAGE,this._token="",this._searchFilter={},this._userIdsFilter={userIds:[],includeMode:!0,queryType:n.QueryType.AND},this._userIdsExactFilter=[],this._userIdsIncludeFilter=[],this._userIdsIncludeFilterQueryType=n.QueryType.AND,this.nicknameContainsFilter="",this.channelNameContainsFilter="",this.memberStateFilter=Ae.MemberStateFilter.ALL,this.customTypesFilter=[],this.channelUrlsFilter=[],this.superChannelFilter=Ae.SuperChannelFilter.ALL,this.publicChannelFilter=Ae.PublicChannelFilter.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=Ae.UnreadChannelFilter.ALL,this.metadataOrderKeyFilter=null,this.hiddenChannelFilter=Ae.HiddenChannelFilter.UNHIDDEN}return s(n,[{key:"setSearchFilter",value:function(e,n){Array.isArray(e)&&0!==e.length&&"string"==typeof n&&n&&(this._searchFilter={search_query:n,search_fields:e.join(",").toLocaleLowerCase()})}},{key:"serialize",value:function(){return W.serialize(this,function(e){e.isLoading=!1})}},{key:"next",value:function(e){var l=this;return V(this._iid,function(o){var e=L.get(l._iid),u=e.GroupChannel,n=e.GroupChannelListQuery;!("number"==typeof l.limit&&0<l.limit&&"boolean"==typeof l.includeEmpty&&"string"==typeof l.order&&-1<[n.ORDER_CHRONOLOGICAL,n.ORDER_LATEST_LAST_MESSAGE,n.CHANNEL_NAME_ALPHABETICAL,n.METADATA_VALUE_ALPHABETICAL].indexOf(l.order.toLowerCase())&&Array.isArray(l._userIdsExactFilter)&&Array.isArray(l._userIdsIncludeFilter)&&Array.isArray(l.customTypesFilter)&&Array.isArray(l.channelUrlsFilter)&&-1<Object.keys(n.QueryType).map(function(e){return n.QueryType[e]}).indexOf(l._userIdsIncludeFilterQueryType.toUpperCase())&&-1<Object.keys(u.MemberStateFilter).map(function(e){return u.MemberStateFilter[e]}).indexOf(l.memberStateFilter)&&-1<Object.keys(u.SuperChannelFilter).map(function(e){return u.SuperChannelFilter[e]}).indexOf(l.superChannelFilter)&&-1<Object.keys(u.PublicChannelFilter).map(function(e){return u.PublicChannelFilter[e]}).indexOf(l.publicChannelFilter)&&-1<Object.keys(u.UnreadChannelFilter).map(function(e){return u.UnreadChannelFilter[e]}).indexOf(l.unreadChannelFilter)&&-1<Object.keys(u.HiddenChannelFilter).map(function(e){return u.HiddenChannelFilter[e]}).indexOf(l.hiddenChannelFilter))||"string"!=typeof l.customTypeStartsWithFilter&&null!==l.customTypeStartsWithFilter||"string"!=typeof l.nicknameContainsFilter||"string"!=typeof l.channelNameContainsFilter||"string"!=typeof l.metadataOrderKeyFilter&&null!==l.metadataOrderKeyFilter?o(x.error,null):l.isLoading?o(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null):l.hasNext?(l.isLoading=!0,$.get(l._iid).container.apiClient.loadGroupChannelList(y({},l,{token:l._token,userIdsFilter:l._userIdsFilter,searchFilter:l._searchFilter}),function(e,n){if(e)return l.isLoading=!1,void o(e,null);var t=[],r=String(n.next);l._token=r,l.hasNext=!!r;for(var i=n.channels,a=0;a<i.length;a++){var s=u.upsert(i[a]);t.push(s)}l.isLoading=!1,o(e,t)})):o(null,[])},e)}},{key:"userIdsExactFilter",get:function(){return this._userIdsExactFilter},set:function(e){Array.isArray(e)&&(this._userIdsExactFilter=e,this._userIdsIncludeFilter=[],this._userIdsFilter.userIds=this._userIdsExactFilter,this._userIdsFilter.includeMode=!1)}},{key:"userIdsIncludeFilter",get:function(){return this._userIdsIncludeFilter},set:function(e){Array.isArray(e)&&(this._userIdsIncludeFilter=e,this._userIdsExactFilter=[],this._userIdsFilter.userIds=this._userIdsIncludeFilter,this._userIdsFilter.includeMode=!0)}},{key:"userIdsIncludeFilterQueryType",get:function(){return this._userIdsIncludeFilterQueryType},set:function(e){-1<Object.keys(n.QueryType).map(function(e){return n.QueryType[e]}).indexOf(e)&&(this._userIdsIncludeFilterQueryType=e.toUpperCase(),this._userIdsFilter.queryType=this._userIdsIncludeFilterQueryType)}}],[{key:"buildFromSerializedData",value:function(e){var n=L.get(this._iid).GroupChannel,t=W.deserialize(e),r=n.createMyGroupChannelListQuery();for(var i in t)r.hasOwnProperty(i)&&(r[i]=t[i]);return r}},{key:"ORDER_LATEST_LAST_MESSAGE",get:function(){return"latest_last_message"}},{key:"ORDER_CHRONOLOGICAL",get:function(){return"chronological"}},{key:"CHANNEL_NAME_ALPHABETICAL",get:function(){return"channel_name_alphabetical"}},{key:"METADATA_VALUE_ALPHABETICAL",get:function(){return"metadata_value_alphabetical"}},{key:"QueryType",get:function(){return{AND:"AND",OR:"OR"}}},{key:"SearchField",get:function(){return{MEMBER_NICKNAME:"member_nickname",CHANNEL_NAME:"channel_name"}}}]),n}(),He=function(){function n(e){_(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.mutedMemberFilter=n.MutedMemberFilter.ALL,this.memberStateFilter=Ae.MemberStateFilter.ALL,this.nicknameStartsWithFilter=null,this._token="",this._channelUrl=e}return s(n,[{key:"next",value:function(e){var s=this;return V(this._iid,function(i){var e=L.get(s._iid),n=e.GroupChannel,a=e.Member,t=e.MemberListQuery;if("number"==typeof s.limit&&0<s.limit&&-1<Object.keys(t.MutedMemberFilter).map(function(e){return t.MutedMemberFilter[e]}).indexOf(s.mutedMemberFilter)&&-1<Object.keys(n.MemberStateFilter).map(function(e){return n.MemberStateFilter[e]}).indexOf(s.memberStateFilter)&&("string"==typeof s.nicknameStartsWithFilter||null===s.nicknameStartsWithFilter))if(s.isLoading)i(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null);else if(s.hasNext){s.isLoading=!0;var r=t.Order.MEMBER_NICKNAME_ALPHABETICAL;$.get(s._iid).container.apiClient.loadMemberList(y({},s,{channelUrl:s._channelUrl,order:r,token:s._token}),function(e,n){var t=null;if(!e){var r=String(n.next);s._token=r,s.hasNext=!!r,t=n.members.map(function(e){return new a(e)})}s.isLoading=!1,i(e,t)})}else i(null,[]);else i(x.error,null)},e)}}],[{key:"MutedMemberFilter",get:function(){return{ALL:"all",MUTED:"muted",UNMUTED:"unmuted"}}},{key:"Order",get:function(){return{MEMBER_NICKNAME_ALPHABETICAL:"member_nickname_alphabetical"}}}]),n}(),Ge=function(){function n(e){_(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._token="",e.channelUrl&&(this._channelUrl=e.channelUrl),e.isOpenChannel&&(this._isOpenChannel=e.isOpenChannel)}return s(n,[{key:"next",value:function(e){var s=this;return V(this._iid,function(a){"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,$.get(s._iid).container.apiClient.loadMutedUserList(y({},s,{channelUrl:s._channelUrl,isOpenChannel:s._isOpenChannel,token:s._token}),function(e,n){var t=null;if(!e){var r=L.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.muted_list.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(x.error,null)},e)}}]),n}(),Fe=function(){function e(){_(this,e),this.limit=20,this.isLoading=!1,this.hasNext=!0,this.nameKeyword=null,this.urlKeyword=null,this.customTypes=[]}return s(e,[{key:"next",value:function(e){var s=this;return V(this._iid,function(a){!("number"==typeof s.limit&&0<s.limit&&Array.isArray(s.customTypes))||"string"!=typeof s.nameKeyword&&null!==s.nameKeyword||"string"!=typeof s.urlKeyword&&null!==s.urlKeyword?a(x.error,null):s.isLoading?a(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,$.get(s._iid).container.apiClient.loadOpenChannelList(y({},s,{token:s._token}),function(e,n){var t=null;if(!e){var r=L.get(s._iid).OpenChannel,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.channels.map(function(e){return r.upsert(e)})}s.isLoading=!1,a(e,t)})):a(null,[])},e)}}]),e}(),qe=new S,Be=function(){function n(e){_(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._token="",qe.set(this,e)}return s(n,[{key:"next",value:function(e){var s=this;return V(this._iid,function(a){if("number"==typeof s.limit&&0<s.limit)if(s.isLoading)a(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null);else if(s.hasNext){s.isLoading=!0;var e=qe.get(s);$.get(s._iid).container.apiClient.loadOperatorList(y({},s,{token:s._token,channelUrl:e.url,isOpenChannel:e.isOpenChannel()}),function(e,n){var t=null;if(!e){var r=L.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.operators.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})}else a(null,[]);else a(x.error,null)},e)}}]),n}(),Qe=new S,xe=function(){function n(e){_(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._token="",e&&Qe.set(this,e.channelUrl)}return s(n,[{key:"next",value:function(e){var s=this;return V(this._iid,function(a){"number"==typeof s.limit&&0<s.limit?s.isLoading?a(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,$.get(s._iid).container.apiClient.loadParticipantList(y({},s,{channelUrl:Qe.get(s),token:s._token}),function(e,n){var t=null;if(!e){var r=L.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.participants.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(x.error,null)},e)}}]),n}(),ze=new S,je=new S,Ye=function(){function n(e){_(this,n),this.isLoading=!1,this.hasMore=!0,this.limit=20,je.set(this,Number.MAX_SAFE_INTEGER),ze.set(this,e),this.reverse=!1,this.messageTypeFilter=null,this.customTypeFilter=null,this.senderUserIdsFilter=[],this.includeMetaArray=!1}return s(n,[{key:"load",value:function(s,e,n,t){var o=this,u=L.get(this._iid).BaseChannel,r=null,i=g(x.parse(arguments,[new x({type:"number",optional:!0,defaultValue:this.limit}),new x({type:"boolean",optional:!0,defaultValue:this.reverse}),new x({type:["string","number"],optional:!0,defaultValue:this.messageTypeFilter,constraint:function(e){return-1<Object.keys(u.MessageTypeFilter).map(function(e){return u.MessageTypeFilter[e]}).indexOf(e)||-1<[0,1,2,3].indexOf(e)}}),new x({type:"callback"})]),5);return r=i[0],s=i[1],e=i[2],n=i[3],t=i[4],V(this._iid,function(i){if(Array.isArray(o.senderUserIdsFilter)&&!o.senderUserIdsFilter.some(function(e){return"string"!=typeof e})||(r=x.error),r)i(r,null);else{if(o.limit=s,o.reverse=e,o.messageTypeFilter=n,"number"==typeof o.messageTypeFilter)switch(o.messageTypeFilter){case 0:o.messageTypeFilter=u.MessageTypeFilter.ALL;break;case 1:o.messageTypeFilter=u.MessageTypeFilter.USER;break;case 2:o.messageTypeFilter=u.MessageTypeFilter.FILE;break;case 3:o.messageTypeFilter=u.MessageTypeFilter.ADMIN}if(o.isLoading)i(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null);else if(o.hasMore){o.isLoading=!0;var a=ze.get(o);$.get(o._iid).container.apiClient.getMessageList({channel:a,token:je.get(o)||(new Date).getTime()+1e4,tokenType:"timestamp",isInclusive:!1,prevResultSize:s,nextResultSize:0,shouldReverse:e,messageType:n,customType:o.customTypeFilter,senderUserIds:o.senderUserIdsFilter,includeMetaArray:o.includeMetaArray},function(e,n){var t=null;if(!e){(0===(t=n.messages.map(function(e){return u.buildMessage(e,a)})).length||t.length<s)&&(o.hasMore=!1);var r=je.get(o);je.set(o,Math.min.apply(Math,E(t.map(function(e){return e.createdAt})).concat([r])))}o.isLoading=!1,i(e,t)})}else i(null,[])}},t)}}]),n}(),Ke=function(){function n(){_(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.includeEmpty=!1,this.order=De.ORDER_LATEST_LAST_MESSAGE,this._token="",this.channelNameContainsFilter="",this.channelUrlsFilter=[],this.customTypesFilter=[],this.customTypeStartsWithFilter=null,this.superChannelFilter=Ae.SuperChannelFilter.ALL,this.membershipFilter=n.MembershipType.JOINED,this.metadataOrderKeyFilter=null}return s(n,[{key:"next",value:function(e){var s=this;return V(this._iid,function(i){var a=L.get(s._iid).GroupChannel;!("number"==typeof s.limit&&0<s.limit&&"boolean"==typeof s.includeEmpty&&"string"==typeof s.order&&-1<[n.ORDER_CHRONOLOGICAL,n.CHANNEL_NAME_ALPHABETICAL,n.METADATA_VALUE_ALPHABETICAL,n.ORDER_LATEST_LAST_MESSAGE].indexOf(s.order.toLowerCase())&&Array.isArray(s.customTypesFilter)&&Array.isArray(s.channelUrlsFilter)&&-1<Object.keys(n.MembershipType).map(function(e){return n.MembershipType[e]}).indexOf(s.membershipFilter)&&-1<Object.keys(a.SuperChannelFilter).map(function(e){return a.SuperChannelFilter[e]}).indexOf(s.superChannelFilter))||"string"!=typeof s.customTypeStartsWithFilter&&null!==s.customTypeStartsWithFilter||"string"!=typeof s.channelNameContainsFilter||"string"!=typeof s.metadataOrderKeyFilter&&null!==s.metadataOrderKeyFilter?i(x.error,null):s.isLoading?i(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,$.get(s._iid).container.apiClient.loadPublicGroupChannelList(y({},s,{token:s._token}),function(e,n){var t=null;if(!e){var r=String(n.next);s._token=r,s.hasNext=!!r,t=n.channels.map(function(e){return a.upsert(e)})}s.isLoading=!1,i(e,t)})):i(null,[])},e)}}],[{key:"MembershipType",get:function(){return{ALL:"all",JOINED:"joined"}}},{key:"ORDER_LATEST_LAST_MESSAGE",get:function(){return"latest_last_message"}},{key:"ORDER_CHRONOLOGICAL",get:function(){return"chronological"}},{key:"CHANNEL_NAME_ALPHABETICAL",get:function(){return"channel_name_alphabetical"}},{key:"METADATA_VALUE_ALPHABETICAL",get:function(){return"metadata_value_alphabetical"}}]),n}(),Ve=function(){function e(){_(this,e),this.isDistinct=null,this.isSuper=null,this.isPublic=null,this.channelUrl=null,this.isEphemeral=null,this.isDiscoverable=null,this.isStrict=null,this.name=null,this.data=null,this.customType=null,this.channelCover=null,this.coverUrl=null,this.coverImage=null,this.accessCode=null,this._invitedUserIds=[];var n=null;Object.defineProperty(this,"operators",{set:function(e){Array.isArray(e)&&e.filter(function(e){return e.hasOwnProperty("userId")}).length===e.length&&(n=e.map(function(e){return e.userId}))}}),Object.defineProperty(this,"operatorUserIds",{get:function(){return n},set:function(e){Array.isArray(e)&&e.filter(function(e){return"string"==typeof e}).length===e.length&&(n=e)}})}return s(e,[{key:"_validate",value:function(){return Array.isArray(this._invitedUserIds)&&this._invitedUserIds.every(function(e){return"string"==typeof e})&&("string"==typeof this.channelUrl||null===this.channelUrl)&&("string"==typeof this.coverUrl||null===this.coverUrl)&&(te.isFile(this.coverImage)||null===this.coverImage)&&("string"==typeof this.name||null===this.name)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&("boolean"==typeof this.isDistinct||null===this.isDistinct)&&("boolean"==typeof this.isSuper||null===this.isSuper)&&("boolean"==typeof this.isPublic||null===this.isPublic)&&("boolean"==typeof this.isEphemeral||null===this.isEphemeral)&&("boolean"==typeof this.isDiscoverable||null===this.isDiscoverable)&&("boolean"==typeof this.isStrict||null===this.isStrict)&&(Array.isArray(this.operatorUserIds)&&this.operatorUserIds.every(function(e){return"string"==typeof e})||null===this.operatorUserIds)&&("string"==typeof this.accessCode||null===this.accessCode)}},{key:"addUsers",value:function(e){if(Array.isArray(e)){var n,t=e.filter(function(e){return e.hasOwnProperty("userId")&&"string"==typeof e.userId}).map(function(e){return e.userId});(n=this._invitedUserIds).push.apply(n,E(t))}}},{key:"addUser",value:function(e){e.hasOwnProperty("userId")&&"string"==typeof e.userId&&this._invitedUserIds.push(e.userId)}},{key:"addUserIds",value:function(e){if(Array.isArray(e)){var n,t=e.filter(function(e){return"string"==typeof e});(n=this._invitedUserIds).push.apply(n,E(t))}}},{key:"addUserId",value:function(e){"string"==typeof e&&this._invitedUserIds.push(e)}}]),e}(),We=function(){function e(){_(this,e),this._mentionType=e.MentionType.USERS,this._mentionedUserIds=[],this._cachedMentionedUsers=[],this._cachedMentionedUserIds=[]}return s(e,[{key:"_validate",value:function(){var n=L.get(this._iid).BaseMessageParams;return-1<Object.keys(n.MentionType).map(function(e){return n.MentionType[e]}).indexOf(this.mentionType)&&this._mentionedUserIds.every(function(e){return"string"==typeof e})}},{key:"mentionType",get:function(){return this._mentionType},set:function(e){var n=L.get(this._iid).BaseMessageParams;-1<Object.keys(n.MentionType).map(function(e){return n.MentionType[e]}).indexOf(e)&&(this._mentionType=e)}},{key:"mentionedUserIds",get:function(){return this._cachedMentionedUserIds},set:function(e){if(Array.isArray(e))for(var n=hn.getInstance(this._iid),t=0;t<e.length;t++){var r=e[t];if("string"!=typeof r){this._cachedMentionedUserIds=[],this._mentionedUserIds=[];break}this._mentionedUserIds.indexOf(r)<0&&n.currentUser&&n.currentUser.userId!==r&&(this._cachedMentionedUserIds.push(r),this._mentionedUserIds.push(r))}}},{key:"mentionedUsers",get:function(){return this._cachedMentionedUsers},set:function(e){if(Array.isArray(e))for(var n=hn.getInstance(this._iid),t=0;t<e.length;t++){var r=e[t];if(!r.hasOwnProperty("userId")){this._cachedMentionedUsers=[],this._mentionedUserIds=[];break}this._mentionedUserIds.indexOf(r.userId)<0&&n.currentUser&&n.currentUser.userId!==r.userId&&(this._cachedMentionedUsers.push(r),this._mentionedUserIds.push(r.userId))}}}],[{key:"MentionType",get:function(){return{USERS:"users",CHANNEL:"channel"}}},{key:"PushNotificationDeliveryOption",get:function(){return{DEFAULT:"default",SUPPRESS:"suppress"}}}]),e}(),Je=function(){function t(){var e;return _(this,t),(e=d(this,u(t).call(this))).message=null,e.data=null,e.customType=null,e.pushNotificationDeliveryOption=null,e._metaArrayKeys=[],e._translationTargetLanguages=[],e}return o(t,We),s(t,[{key:"_validate",value:function(){var n=L.get(this._iid).BaseMessageParams;return h(u(t.prototype),"_validate",this).call(this)&&("string"==typeof this.message||null===this.message)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&Array.isArray(this.translationTargetLanguages)&&this.translationTargetLanguages.every(function(e){return"string"==typeof e})&&Array.isArray(this.metaArrayKeys)&&this.metaArrayKeys.every(function(e){return"string"==typeof e})&&(null===this.pushNotificationDeliveryOption||-1<Object.keys(n.PushNotificationDeliveryOption).map(function(e){return n.PushNotificationDeliveryOption[e]}).indexOf(this.pushNotificationDeliveryOption))}},{key:"metaArrayKeys",get:function(){return this._metaArrayKeys},set:function(e){var n=[];if(Array.isArray(e))for(var t=0;t<e.length;t++)"string"==typeof e[t]&&n.indexOf(e[t])<0&&n.push(e[t]);this._metaArrayKeys=n}},{key:"targetLanguages",get:function(){return this.translationTargetLanguages},set:function(e){this.translationTargetLanguages=e}},{key:"translationTargetLanguages",get:function(){return this._translationTargetLanguages},set:function(e){if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("string"!=typeof e[n])return void(this._translationTargetLanguages=[]);this._translationTargetLanguages=e}}}]),t}();(m()||C())&&A(We,Je);var Xe=function(){function t(){var e;return _(this,t),(e=d(this,u(t).call(this))).fileName=null,e.mimeType=null,e.fileSize=null,e.data=null,e.customType=null,e.pushNotificationDeliveryOption=null,e._isUpdate=!1,e._file=null,e._fileUrl=null,e._metaArrayKeys=[],e._thumbnailSizes=[],e}return o(t,We),s(t,[{key:"_validate",value:function(){var n=L.get(this._iid).BaseMessageParams;return h(u(t.prototype),"_validate",this).call(this)&&(this._isUpdate||te.isFile(this.file)||"string"==typeof this.fileUrl)&&("string"==typeof this.fileName||null===this.fileName)&&("string"==typeof this.mimeType||null===this.mimeType)&&("number"==typeof this.fileSize||null===this.fileSize)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&Array.isArray(this._metaArrayKeys)&&this._metaArrayKeys.every(function(e){return"string"==typeof e})&&(null===this._thumbnailSizes||this._thumbnailSizes.every(function(e){return"object"===Z(e)&&0<e.maxWidth&&0<e.maxHeight}))&&(null===this.pushNotificationDeliveryOption||-1<Object.keys(n.PushNotificationDeliveryOption).map(function(e){return n.PushNotificationDeliveryOption[e]}).indexOf(this.pushNotificationDeliveryOption))}},{key:"file",get:function(){return this._file},set:function(e){te.isFile(e)&&(this._fileUrl=null,this._file=e)}},{key:"fileUrl",get:function(){return this._fileUrl},set:function(e){"string"==typeof e&&(this._fileUrl=e,this._file=null)}},{key:"metaArrayKeys",get:function(){return this._metaArrayKeys},set:function(e){var n=[];if(Array.isArray(e))for(var t=0;t<e.length;t++)"string"==typeof e[t]&&n.indexOf(e[t])<0&&n.push(e[t]);this._metaArrayKeys=n}},{key:"thumbnailSizes",get:function(){return this._thumbnailSizes},set:function(e){if(Array.isArray(e)){for(var n=0;n<e.length;n++)if("object"!==Z(e[n])||"number"!=typeof e[n].maxWidth||"number"!=typeof e[n].maxHeight)return void(this._thumbnailSizes=[]);this._thumbnailSizes=e}}}]),t}();(m()||C())&&A(We,Xe);var Ze=function(){function t(e){var n;return _(this,t),(n=d(this,u(t).call(this))).year=null,n.month=null,n.day=null,n.hour=null,n.min=null,n.timezone=null,n._scheduledDateTimeString=null,e&&n._update(e),n}return o(t,Je),s(t,[{key:"_update",value:function(e){e.hasOwnProperty("message")&&(this.message=e.message),e.hasOwnProperty("year")&&(this.year=e.year),e.hasOwnProperty("month")&&(this.month=e.month),e.hasOwnProperty("day")&&(this.day=e.day),e.hasOwnProperty("hour")&&(this.hour=e.hour),e.hasOwnProperty("min")&&(this.min=e.min),e.hasOwnProperty("timezone")&&(this.timezone=e.timezone)}},{key:"_getScheduleString",value:function(){return this.scheduledDateTimeString?this.scheduledDateTimeString+" "+this.timezone:"number"==typeof this.year&&4===this.year.toString().length&&"number"==typeof this.month&&1<=this.month&&this.month<=12&&"number"==typeof this.day&&1<=this.day&&this.day<=31&&"number"==typeof this.hour&&0<=this.hour&&this.hour<=24&&"number"==typeof this.min&&0<=this.min&&this.min<=60&&"string"==typeof this.timezone&&0<this.timezone.length?this.year.toString()+"-"+("0"+this.month.toString()).substr(-2)+"-"+("0"+this.day.toString()).substr(-2)+" "+("0"+this.hour.toString()).substr(-2)+":"+("0"+this.min.toString()).substr(-2)+" "+this.timezone:null}},{key:"setSchedule",value:function(e,n,t,r,i,a){"number"==typeof e&&4===e.toString().length&&"number"==typeof n&&1<=n&&n<=12&&"number"==typeof t&&1<=t&&t<=31&&"number"==typeof r&&0<=r&&r<=24&&"number"==typeof i&&0<=i&&i<=60&&"string"==typeof a&&0<a.length&&(this.scheduledDateTimeString=e.toString()+"-"+("0"+n.toString()).substr(-2)+"-"+("0"+t.toString()).substr(-2)+" "+("0"+r.toString()).substr(-2)+":"+("0"+i.toString()).substr(-2),this.timezone=a)}},{key:"scheduledDateTimeString",get:function(){return this._scheduledDateTimeString?this._scheduledDateTimeString:"number"==typeof this.year&&4===this.year.toString().length&&"number"==typeof this.month&&1<=this.month&&this.month<=12&&"number"==typeof this.day&&1<=this.day&&this.day<=31&&"number"==typeof this.hour&&0<=this.hour&&this.hour<=24&&"number"==typeof this.min&&0<=this.min&&this.min<=60&&"string"==typeof this.timezone&&0<this.timezone.length?this.year.toString()+"-"+("0"+this.month.toString()).substr(-2)+"-"+("0"+this.day.toString()).substr(-2)+" "+("0"+this.hour.toString()).substr(-2)+":"+("0"+this.min.toString()).substr(-2):null},set:function(e){e&&"string"==typeof e&&(this._scheduledDateTimeString=e)}}]),t}();(m()||C())&&A(Je,Ze);function $e(){_(this,$e),this.channelCustomTypesFilter=[],this.superChannelFilter=Ae.SuperChannelFilter.ALL}function en(){_(this,en),this.onReconnectStarted=function(){},this.onReconnectSucceeded=function(){},this.onReconnectFailed=function(){}}function nn(){_(this,nn),this.onFriendsDiscovered=function(e){},this.onTotalUnreadMessageCountUpdated=function(e,n){}}function tn(){_(this,tn),this.onMessageReceived=function(e,n){},this.onMessageUpdated=function(e,n){},this.onMessageDeleted=function(e,n){},this.onReadReceiptUpdated=function(e){},this.onTypingStatusUpdated=function(e){},this.onUserJoined=function(e,n){},this.onUserLeft=function(e,n){},this.onUserEntered=function(e,n){},this.onUserExited=function(e,n){},this.onUserMuted=function(e,n){},this.onUserUnmuted=function(e,n){},this.onUserBanned=function(e,n){},this.onUserUnbanned=function(e,n){},this.onChannelFrozen=function(e){},this.onChannelUnfrozen=function(e){},this.onChannelChanged=function(e){},this.onChannelDeleted=function(e,n){},this.onUserReceivedInvitation=function(e,n,t){},this.onUserDeclinedInvitation=function(e,n,t){},this.onMetaDataCreated=function(e,n){},this.onMetaDataUpdated=function(e,n){},this.onMetaDataDeleted=function(e,n){},this.onMetaCountersCreated=function(e,n){},this.onMetaCountersUpdated=function(e,n){},this.onMetaCountersDeleted=function(e,n){},this.onChannelHidden=function(e){},this.onMentionReceived=function(e,n){}}function rn(e){if(_(this,rn),e){var n=L.get(this._iid),t=n.User,r=n.BaseChannel;this.reader=new t(e.user),this.timestamp=parseInt(e.ts),this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):r.CHANNEL_TYPE_GROUP}}var an=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];_(this,t),this.key=e,this.value=Array.isArray(n)&&n.every(function(e){return"string"==typeof e})?n:[]}return s(t,[{key:"encode",value:function(){return{key:this.key,value:this.value||[]}}}]),t}(),sn=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];_(this,n),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.userIds=e,this.metaDataKey="",this.metaDataValues=[],this._token=""}return s(n,[{key:"next",value:function(e){var s=this;return V(this._iid,function(a){"number"==typeof s.limit&&0<s.limit&&Array.isArray(s.userIds)&&"string"==typeof s.metaDataKey&&Array.isArray(s.metaDataValues)&&!!s.metaDataKey==0<s.metaDataValues.length?s.isLoading?a(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null):s.hasNext?(s.isLoading=!0,$.get(s._iid).container.apiClient.loadUserList(y({},s,{userIdsFilter:s.userIds,metaDataKeyFilter:s.metaDataKey,metaDataValuesFilter:s.metaDataValues,token:s._token}),function(e,n){var t=null;if(!e){var r=L.get(s._iid).User,i=String(n.next);s._token=i,s.hasNext=!!i,t=n.users.map(function(e){return new r(e)})}s.isLoading=!1,a(e,t)})):a(null,[]):a(x.error,null)},e)}}]),n}(),on=new S,un=function(){function n(e){_(this,n),this.isLoading=!1,on.set(this,e)}return s(n,[{key:"prev",value:function(t,s,o,e){var u=arguments,l=this;return V(this._iid,function(r){var e,i=L.get(l._iid).BaseChannel,n=g(x.parse(u,[new x({type:"number"}),new x({type:"number"}),new x({type:"boolean"}),new x({type:"function"})]),5);if(e=n[0],t=n[1],s=n[2],o=n[3],r=n[4],e)r(e,null);else if(l.isLoading)r(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null);else{l.isLoading=!0;var a=on.get(l);$.get(l._iid).container.apiClient.getMessageList({channel:a,token:t,tokenType:"timestamp",isInclusive:!1,prevResultSize:s,nextResultSize:0,shouldReverse:o,messageType:"",customType:""},function(e,n){var t=null;e||(t=n.messages.map(function(e){return i.buildMessage(e,a)})),l.isLoading=!1,r(e,t)})}},e)}},{key:"next",value:function(t,s,o,e){var u=arguments,l=this;return V(this._iid,function(r){var e,i=L.get(l._iid).BaseChannel,n=g(x.parse(u,[new x({type:"number"}),new x({type:"number"}),new x({type:"boolean"}),new x({type:"function"})]),5);if(e=n[0],t=n[1],s=n[2],o=n[3],r=n[4],e)r(e,null);else if(l.isLoading)r(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null);else{l.isLoading=!0;var a=on.get(l);$.get(l._iid).container.apiClient.getMessageList({channel:a,token:t,tokenType:"timestamp",isInclusive:!1,prevResultSize:0,nextResultSize:s,shouldReverse:o,messageType:"",customType:""},function(e,n){var t=null;e||(t=n.messages.map(function(e){return i.buildMessage(e,a)})),l.isLoading=!1,r(e,t)})}},e)}},{key:"load",value:function(t,s,o,u,e){var l=arguments,c=this;return V(this._iid,function(r){var e,i=L.get(c._iid).BaseChannel,n=g(x.parse(l,[new x({type:"number"}),new x({type:"number"}),new x({type:"number"}),new x({type:"boolean"}),new x({type:"function"})]),5);if(e=n[0],t=n[1],limit=n[2],u=n[3],r=n[4],e)r(e,null);else if(c.isLoading)r(new ee("Query in progress.",ee.QUERY_IN_PROGRESS),null);else{c.isLoading=!0;var a=on.get(c);$.get(c._iid).container.apiClient.getMessageList({channel:a,token:t,tokenType:"timestamp",isInclusive:!1,prevResultSize:s,nextResultSize:o,shouldReverse:u,messageType:"",customType:""},function(e,n){var t=null;e||(t=n.messages.map(function(e){return i.buildMessage(e,a)})),c.isLoading=!1,r(e,t)})}},e)}}]),n}(),ln=null,cn={},dn=!1,hn=function(){function o(e){_(this,o);var n=!1;if(e.newInstance||!ln?(n=!0,ln=this):ln&&e.appId!==ln.getApplicationId()&&ln.getConnectionState()===ln.ConnectionState.CLOSED&&(n=!0,ln=this),n){try{if(!e.hasOwnProperty("appId"))return ne.debug("Must be set appId"),null}catch(e){return ne.debug("Must be set appId"),null}var t=ye.create();Object.defineProperty(this,"_iid",{get:function(){return t}}),(cn[t]=this).customApiHost=null,this.customWsHost=null,this.connecting=!1,this.reconnecting=!1,this.isReconnectingOnError=!1,this.connectionCallbacks=[],this.ConnectionManager=new z(this),this.GCMPushToken="",this.APNSPushToken="",this.PUSH_TEMPLATE_DEFAULT="default",this.PUSH_TEMPLATE_ALTERNATIVE="alternative",this.currentUser=null,this.isSessionOpened=!1,this.globalTimer,this.loginTimer,this.reconnectTimer,this.loginHandler=null,this.onLoginTimerCancel,this.onReconnectTimerCancel,this.BaseChannel={MessageTypeFilter:le.MessageTypeFilter};var r={User:oe,Member:ge,GroupChannel:Ae,OpenChannel:Ie,UserMessage:ke,FileMessage:Re,AdminMessage:Oe,GroupChannelListQuery:De,GroupChannelParams:Ve,BaseMessageParams:We,UserMessageParams:Je,FileMessageParams:Xe,ScheduledUserMessageParams:Ze,GroupChannelTotalUnreadMessageCountParams:$e,MessageMetaArray:an,UserEventHandler:nn,ChannelHandler:tn,ConnectionHandler:en},i={BaseChannel:le,BaseMessage:J,UserListQuery:sn,ApplicationUserListQuery:Me,BannedUserListQuery:Le,BlockedUserListQuery:we,FriendListQuery:Pe,MemberListQuery:He,MutedUserListQuery:Ge,OpenChannelListQuery:Fe,OperatorListQuery:Be,ParticipantListQuery:xe,MessageListQuery:un,PreviousMessageListQuery:Ye,PublicGroupChannelListQuery:Ke,ScheduledUserMessage:Te,Command:K,Sender:me,ReadStatus:rn,FileMessageQueue:_e},a=new L(this._iid,y({},r,{},i));for(var s in a)r[s]&&(this[s]=a[s]);$.create(t,{appId:e.appId,pinger:new w(this),apiClient:new q(this),wsAdapter:new Q(this),commandHandler:new he(this),onlineDetector:new j(this),ackStateMap:{},subscribedUnreadMessageCount:{all:0,custom_types:{},ts:0},auth:new R,pingInterval:15e3,pongTimeout:5e3,connectedAt:0,stateChangeEnabled:!0,isInBackground:!1,closedByGoingBackground:!1,isErrorFirstInCallback:!1}),this.userEventHandlers={},this.channelHandlers={},this.connectionHandlers={},this.Options={_useMemberAsMessageSender:!0,get UseMemberAsMessageSender(){return this._useMemberAsMessageSender},set UseMemberAsMessageSender(e){"boolean"==typeof e&&(this._useMemberAsMessageSender=e)},get useMemberAsMessageSender(){return this._useMemberAsMessageSender},set useMemberAsMessageSender(e){"boolean"==typeof e&&(this._useMemberAsMessageSender=e)},_typingIndicatorThrottle:1e3,get typingIndicatorThrottle(){return this._typingIndicatorThrottle},set typingIndicatorThrottle(e){"number"==typeof e&&1e3<=e&&e<=9e3&&(this._typingIndicatorThrottle=e)}}}return ln}return s(o,[{key:"getApplicationId",value:function(){return $.get(this._iid).get("appId")}},{key:"getCurrentUserId",value:function(){return this.currentUser?this.currentUser.userId:null}},{key:"getDebugMode",value:function(){return dn}},{key:"setDebugMode",value:function(e){dn=e,ne.mode=e?ne.Mode.DEBUG:ne.Mode.PRODUCTION}},{key:"getErrorFirstCallback",value:function(){return $.get(this._iid).container.isErrorFirstInCallback}},{key:"setErrorFirstCallback",value:function(e){"boolean"==typeof e&&$.get(this._iid).set("isErrorFirstInCallback",e)}},{key:"getCurrentApiHost",value:function(){return this.customApiHost?this.customApiHost:"https://api.sendbird.com"}},{key:"clearCurrentApiHost",value:function(){this.customApiHost=null}},{key:"getCurrentWsHost",value:function(){return this.customWsHost?this.customWsHost:"wss://ws.sendbird.com"}},{key:"clearCurrentWsHost",value:function(){this.customWsHost=null}},{key:"getConnectionState",value:function(){try{var e=$.get(this._iid).container.wsAdapter;return this.connecting||this.reconnecting?this.ConnectionState.CONNECTING:e.ws?this.connecting||this.reconnecting?this.ConnectionState.CONNECTING:this.isSessionOpened?e.ws.getConnectionState():this.ConnectionState.CLOSED:this.ConnectionState.CLOSED}catch(e){return this.ConnectionState.CLOSED}}},{key:"getPendingGCMToken",value:function(){return this.GCMPushToken}},{key:"getPendingAPNSToken",value:function(){return this.APNSPushToken}},{key:"hasLoggedIn",value:function(){var e=$.get(this._iid);return this.currentUser&&e.get("auth").hasSession()}},{key:"getLastConnectedAt",value:function(){var e=$.get(this._iid);return this.getConnectionState()===this.ConnectionState.OPEN&&this.currentUser?e.get("connectedAt"):0}},{key:"connect",value:function(n,t,r,i,e){var a=this,s=$.get(this._iid).container,o=s.wsAdapter,u=s.onlineDetector;u&&u.start();var l,c=g(x.parse(arguments,[new x({type:"string",constraint:function(e){return 0<e.length}}),new x({type:"string",nullable:!0,ignoreIf:function(e){return 1===e.length||3===e.length}}),new x({type:"string",nullable:!0,ignoreIf:function(e){return 1===e.length||2===e.length}}),new x({type:"string",nullable:!0,ignoreIf:function(e){return 1===e.length||2===e.length}}),new x({type:"callback"})]),6);return l=c[0],n=c[1],t=c[2],r=c[3],i=c[4],e=c[5],V(this._iid,function(e){l?e(l,null):(a.customApiHost=r,a.customWsHost=i,a.connecting=!0,a.reconnecting=!1,a.isReconnectingOnError=!1,a.reconnectTimer&&(clearTimeout(a.reconnectTimer),a.reconnectTimer=null,a.onReconnectTimerCancel=null),a.getConnectionState()===a.ConnectionState.OPEN&&a.currentUser&&a.currentUser.userId===n?(a.connecting=!1,e(null,a.currentUser)):(a.connectionCallbacks.push(e),1===a.connectionCallbacks.length&&(o.disconnect({clearSession:!0,err:null},null),o.connect(n,t))))},e)}},{key:"reconnect",value:function(){var e=$.get(this._iid).container,n=e.wsAdapter;if(e.auth.sessionKey&&this.currentUser){var t=!0;return 0<n.reconnectCount&&(t=!1),n.disconnect({clearSession:!1,err:new ee("Connection has been canceled.",ee.CONNECTION_CANCELED)},null),n.reconnectCount=0,n.reconnect(this.currentUser.userId,t),!0}return!1}},{key:"disconnect",value:function(e){var i=this;return V(this._iid,function(e){var n=$.get(i._iid).container,t=n.wsAdapter,r=n.onlineDetector;r&&r.stop(),t.disconnect({clearSession:!0,err:new ee("Connection has been canceled.",ee.CONNECTION_CANCELED)},e)},e)}},{key:"setBackgroundState",value:function(){var e=$.get(this._iid),n=e.container,t=n.wsAdapter,r=n.stateChangeEnabled;!n.isInBackground&&r&&(e.set("isInBackground",!0),this.getConnectionState()!==this.ConnectionState.CLOSED?(e.set("closedByGoingBackground",!0),t.disconnect({clearSession:!1,err:new ee("Websocket connection failed.",ee.WEBSOCKET_CONNECTION_FAILED)},null)):e.set("closedByGoingBackground",!1))}},{key:"setForegroundState",value:function(){var e=$.get(this._iid),n=e.container,t=n.wsAdapter,r=n.stateChangeEnabled,i=n.isInBackground,a=n.closedByGoingBackground;i&&r&&(e.set("isInBackground",!1),a&&this.currentUser&&t.reconnect(this.currentUser.userId,!0))}},{key:"enableStateChange",value:function(){$.get(this._iid).set("enableStateChange",!0)}},{key:"disableStateChange",value:function(){$.get(this._iid).set("enableStateChange",!1)}},{key:"createUserListQuery",value:function(e){return new(L.get(this._iid).UserListQuery)(e)}},{key:"createApplicationUserListQuery",value:function(){return new(L.get(this._iid).ApplicationUserListQuery)}},{key:"createBlockedUserListQuery",value:function(){return new(L.get(this._iid).BlockedUserListQuery)}},{key:"createFriendListQuery",value:function(){return new(L.get(this._iid).FriendListQuery)}},{key:"sendCommand",value:function(u,e){var l=this;return V(this._iid,function(o){l.ConnectionManager.ready(function(e,n){if(e)o(e,null);else{var t=$.get(l._iid).container,r=t.wsAdapter,i=t.ackStateMap;if(null==r||null==r.ws||r.ws.getConnectionState()!==l.ConnectionState.OPEN||l.getConnectionState()!==l.ConnectionState.OPEN)return void o(new ee("Connection is not valid. Please reconnect.",ee.WEBSOCKET_CONNECTION_CLOSED),null);if(u.isAckRequired){var a=u.requestId,s={handler:o,timer:setTimeout(function(){o(new ee("Command received no ack.",ee.ACK_TIMEOUT),null),delete i[a]},f.COMMAND_ACK_TIMEOUT)};i[a]=s,r.ws.send(u,function(e){e&&(clearTimeout(s.timer),o(e,null))})}else r.ws.send(u,o)}},!1)},e)}},{key:"addUserEventHandler",value:function(e,n){n instanceof L.get(this._iid).UserEventHandler&&(this.userEventHandlers[e]=n)}},{key:"removeUserEventHandler",value:function(e){delete this.userEventHandlers[e]}},{key:"removeAllUserEventHandler",value:function(){this.userEventHandlers={}}},{key:"addChannelHandler",value:function(e,n){n instanceof L.get(this._iid).ChannelHandler&&(this.channelHandlers[e]=n)}},{key:"removeChannelHandler",value:function(e){delete this.channelHandlers[e]}},{key:"removeAllChannelHandlers",value:function(){this.channelHandlers={}}},{key:"addConnectionHandler",value:function(e,n){n instanceof L.get(this._iid).ConnectionHandler&&(this.connectionHandlers[e]=n)}},{key:"removeConnectionHandler",value:function(e){delete this.connectionHandlers[e]}},{key:"removeAllConnectionHandlers",value:function(){this.connectionHandlers={}}},{key:"updateCurrentUserInfo",value:function(i,a,e){var n,s=this,t=g(x.parse(arguments,[new x({type:"string",nullable:!0}),new x({type:"string",nullable:!0}),new x({type:"callback"})]),4);return n=t[0],i=t[1],a=t[2],e=t[3],V(this._iid,function(r){n?r(n,null):$.get(s._iid).container.apiClient.updateCurrentUserInfo({nickname:i,profileUrl:a},function(e,n){var t=null;e||(s.currentUser&&(i&&(s.currentUser.nickname=i),a&&(s.currentUser.profileUrl=a)),t=s.currentUser),r(e,t)})},e)}},{key:"updateCurrentUserInfoWithProfileImage",value:function(i,e,n){var t,a=this,r=g(x.parse(arguments,[new x({type:"string",nullable:!0}),new x({type:"file",nullable:!0}),new x({type:"callback"})]),4);return t=r[0],i=r[1],e=r[2],n=r[3],V(this._iid,function(r){t?r(t,null):$.get(a._iid).container.apiClient.updateCurrentUserInfo({nickname:i,profileImage:e},function(e,n){var t=null;e||(a.currentUser&&(i&&(a.currentUser.nickname=i),n.profile_url&&(a.currentUser.profileUrl=n.profile_url)),t=a.currentUser),r(e,t)})},n)}},{key:"updateCurrentUserInfoWithPreferredLanguages",value:function(i,e){var n,a=this,t=g(x.parse(arguments,[new x({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new x({type:"callback"})]),3);return n=t[0],i=t[1],e=t[2],V(this._iid,function(r){n?r(n,null):$.get(a._iid).container.apiClient.updateCurrentUserInfo({preferredLanguages:i},function(e,n){var t=null;e||(a.currentUser&&i&&(a.currentUser._preferredLanguages=i),t=a.currentUser),r(e,t)})},e)}},{key:"registerGCMPushTokenForCurrentUser",value:function(e,n){var t,i=this,r=g(x.parse(arguments,[new x({type:"string",constraint:function(e){return 0<e.length}}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],V(this._iid,function(r){t?r(t,i.pushTokenRegistrationState.ERROR):i.currentUser?$.get(i._iid).container.apiClient.registerGCMPushToken({token:e},function(e,n){var t=i.pushTokenRegistrationState.ERROR;e||(i.GCMPushToken="",t=i.pushTokenRegistrationState.SUCCESS),r(e,t)}):(i.GCMPushToken=e,r(null,i.pushTokenRegistrationState.PENDING))},n)}},{key:"unregisterGCMPushTokenForCurrentUser",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"string",constraint:function(e){return 0<e.length}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):i.currentUser?$.get(i._iid).container.apiClient.unregisterGCMPushToken({token:e},function(e,n){t(e,null)}):(i.GCMPushToken=e,t(null,i.pushTokenRegistrationState.PENDING))},n)}},{key:"unregisterGCMPushTokenAllForCurrentUser",value:function(e){var n=this;return V(this._iid,function(t){$.get(n._iid).container.apiClient.unregisterAllGCMPushTokens({},function(e,n){t(e,null)})},e)}},{key:"registerAPNSPushTokenForCurrentUser",value:function(e,n){var t,i=this,r=g(x.parse(arguments,[new x({type:"string",constraint:function(e){return 0<e.length}}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],V(this._iid,function(r){t?r(t,i.pushTokenRegistrationState.ERROR):i.currentUser?$.get(i._iid).container.apiClient.registerAPNSPushToken({token:e},function(e,n){var t=i.pushTokenRegistrationState.ERROR;e||(i.APNSPushToken="",t=i.pushTokenRegistrationState.SUCCESS),r(e,t)}):(i.APNSPushToken=e,r(null,i.pushTokenRegistrationState.PENDING))},n)}},{key:"unregisterAPNSPushTokenForCurrentUser",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"string",constraint:function(e){return 0<e.length}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):i.currentUser?$.get(i._iid).container.apiClient.unregisterAPNSPushToken({token:e},function(e,n){t(e,null)}):(i.APNSPushToken=e,t(null,i.pushTokenRegistrationState.PENDING))},n)}},{key:"unregisterAPNSPushTokenAllForCurrentUser",value:function(e){var n=this;return V(this._iid,function(t){$.get(n._iid).container.apiClient.unregisterAllAPNSPushTokens({},function(e,n){t(e,null)})},e)}},{key:"unregisterPushTokenAllForCurrentUser",value:function(e){var n=this;return V(this._iid,function(t){$.get(n._iid).container.apiClient.unregisterAllPushTokens({},function(e,n){t(e,null)})},e)}},{key:"getMyGroupChannelChangeLogsByToken",value:function(e,n,t,r){var i,u=this,a=g(x.parse(arguments,[new x({type:"string",nullable:!0}),new x({type:"array",optional:!0,nullable:!0,defaultValue:null}),new x({type:"boolean",nullable:!0,optional:!0,defaultValue:null}),new x({type:"callback"})]),5);return i=a[0],e=a[1],n=a[2],t=a[3],r=a[4],V(this._iid,function(o){i?o(i,null):$.get(u._iid).container.apiClient.getMyGroupChannelChangeLogs({ts:null,token:e,customTypes:n,includeEmpty:t},function(e,n){if(e)o(e,null);else{var t=L.get(u._iid).GroupChannel,r=n.updated.map(function(e){return new t(e)}),i=n.deleted,a=n.has_more,s=n.next;o(null,{updatedChannels:r,deletedChannelUrls:i,hasMore:a,token:s})}})},r)}},{key:"getMyGroupChannelChangeLogsByTimestamp",value:function(e,n,t,r){var i,u=this,a=g(x.parse(arguments,[new x({type:"number",constraint:function(e){return 0<=e}}),new x({type:"array",optional:!0,nullable:!0,defaultValue:null}),new x({type:"boolean",nullable:!0,optional:!0,defaultValue:null}),new x({type:"callback"})]),5);return i=a[0],e=a[1],n=a[2],t=a[3],r=a[4],V(this._iid,function(o){i?o(i,null):$.get(u._iid).container.apiClient.getMyGroupChannelChangeLogs({ts:e,token:null,customTypes:n,includeEmpty:t},function(e,n){if(e)o(e,null);else{var t=L.get(u._iid).GroupChannel,r=n.updated.map(function(e){return new t(e)}),i=n.deleted,a=n.has_more,s=n.next;o(null,{updatedChannels:r,deletedChannelUrls:i,hasMore:a,token:s})}})},r)}},{key:"getChannelInvitationPreference",value:function(e){var n=this;return V(this._iid,function(r){$.get(n._iid).container.apiClient.getChannelInvitationPreference({},function(e,n){var t=null;e||(t={autoAccept:n.auto_accept}),r(e,t)})},e)}},{key:"setChannelInvitationPreference",value:function(e,n){var t,i=this,r=g(x.parse(arguments,[new x({type:"boolean"}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],V(this._iid,function(r){t?r(t,null):$.get(i._iid).container.apiClient.setChannelInvitationPreference({isAutoAccept:e},function(e,n){var t=null;e||(t={autoAccept:n.auto_accept}),r(e,t)})},n)}},{key:"getDoNotDisturb",value:function(e){var n=this;return V(this._iid,function(r){$.get(n._iid).container.apiClient.getDoNotDisturb({},function(e,n){var t=null;e||(t={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone}),r(e,t)})},e)}},{key:"setDoNotDisturb",value:function(e,n,t,i,a,s,r){var o,u=this,l=g(x.parse(arguments,[new x({type:"boolean"}),new x({type:"number",constraint:function(e){return 0<=e&&e<=23}}),new x({type:"number",constraint:function(e){return 0<=e&&e<=59}}),new x({type:"number",constraint:function(e){return 0<=e&&e<=23}}),new x({type:"number",constraint:function(e){return 0<=e&&e<=59}}),new x({type:"string"}),new x({type:"callback"})]),8);return o=l[0],e=l[1],n=l[2],t=l[3],i=l[4],a=l[5],s=l[6],r=l[7],V(this._iid,function(r){o?r(o,null):$.get(u._iid).container.apiClient.setDoNotDisturb({doNotDisturbOn:e,startHour:n,startMin:t,endHour:i,endMin:a,timezone:s},function(e,n){var t=null;e||(t={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone}),r(e,t)})},r)}},{key:"getSnoozePeriod",value:function(e){var n=this;return V(this._iid,function(r){$.get(n._iid).container.apiClient.getSnoozePeriod({},function(e,n){var t=null;e||(t={isSnoozeOn:n.snooze_enabled,startTs:n.snooze_start_ts,endTs:n.snooze_end_ts}),r(e,t)})},e)}},{key:"setSnoozePeriod",value:function(e,n,t,r){var i,a=this,s=g(x.parse(arguments,[new x({type:"boolean"}),new x({type:"number",constraint:function(e){return 0<e}}),new x({type:"number",constraint:function(e){return 0<e}}),new x({type:"callback"})]),5);return i=s[0],e=s[1],n=s[2],t=s[3],r=s[4],V(this._iid,function(r){i?r(i,null):$.get(a._iid).container.apiClient.setSnoozePeriod({snoozeOn:e,startTs:n,endTs:t},function(e,n){var t=null;e||(t={isSnoozeOn:n.snooze_enabled,startTs:n.snooze_start_ts,endTs:n.snooze_end_ts}),r(e,t)})},r)}},{key:"blockUser",value:function(e,n){var t,r=g(x.parse(arguments,[new x({type:"object",constraint:function(e){return e&&e.hasOwnProperty("userId")}}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],t?V(this._iid,function(e){e(t,null)},n):this.blockUserWithUserId(e.userId,n)}},{key:"blockUserWithUserId",value:function(e,n){var t,i=this,r=g(x.parse(arguments,[new x({type:"string",constraint:function(e){return e&&(!i.currentUser||e!==i.currentUser.userId)}}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],V(this._iid,function(r){t?r(t,null):$.get(i._iid).container.apiClient.blockUser({blockedUserId:e},function(e,n){var t=null;e||(t=new oe(n)),r(e,t)})},n)}},{key:"unblockUser",value:function(e,n){var t,r=g(x.parse(arguments,[new x({type:"object",constraint:function(e){return e&&e.hasOwnProperty("userId")}}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],t?V(this._iid,function(e){e(t,null)},n):this.unblockUserWithUserId(e.userId,n)}},{key:"unblockUserWithUserId",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"string",constraint:function(e){return e&&(!i.currentUser||e!==i.currentUser.userId)}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.unblockUser({unblockedUserId:e},function(e,n){t(e,null)})},n)}},{key:"getPushTriggerOption",value:function(e){var n=this;return V(this._iid,function(t){$.get(n._iid).container.apiClient.getPushTriggerOption({},function(e,n){t(e,n?n.push_trigger_option:null)})},e)}},{key:"setPushTriggerOption",value:function(e,n){var r=this;return V(this._iid,function(t){-1<Object.keys(r.PushTriggerOption).map(function(e){return r.PushTriggerOption[e]}).indexOf(e)?$.get(r._iid).container.apiClient.setPushTriggerOption({pushTriggerOption:e},function(e,n){t(e,n?n.push_trigger_option:null)}):t(x.error,null)},n)}},{key:"getGroupChannelCount",value:function(e,n){var t,i=this,r=L.get(this._iid).GroupChannel,a=g(x.parse(arguments,[new x({type:r.MemberStateFilter,optional:!0,defaultValue:r.MemberStateFilter.ALL}),new x({type:"callback"})]),3);return t=a[0],e=a[1],n=a[2],V(this._iid,function(r){t?r(t,null):$.get(i._iid).container.apiClient.getGroupChannelCount({memberStateFilter:e},function(e,n){var t=null;e||(t=parseInt(n.group_channel_count)),r(e,t)})},n)}},{key:"getTotalUnreadChannelCount",value:function(e){var n=this;return V(this._iid,function(r){$.get(n._iid).container.apiClient.getTotalUnreadChannelCount({},function(e,n){var t=null;e||(t=parseInt(n.unread_count)),r(e,t)})},e)}},{key:"getTotalUnreadMessageCount",value:function(t,e){var i,a=this,n=L.get(this._iid),s=n.GroupChannel,o=n.GroupChannelTotalUnreadMessageCountParams,r=g(x.parse(arguments,[new x({type:"object",optional:!0,defaultValue:null,constraint:function(e){return Array.isArray(e)&&e.every(function(e){return"string"==typeof e})||e instanceof o}}),new x({type:"callback"})]),3);return i=r[0],t=r[1],e=r[2],V(this._iid,function(r){if(i)r(i,null);else{var e=s.SuperChannelFilter.ALL;if(t instanceof o){var n=t;t=n.channelCustomTypesFilter,e=n.superChannelFilter}$.get(a._iid).container.apiClient.getTotalUnreadMessageCount({customTypesFilter:t,superChannelFilter:e},function(e,n){var t=null;e||(t=parseInt(n.unread_count)),r(e,t)})}},e)}},{key:"getUnreadItemCount",value:function(r,e){var n,i=this,t=g(x.parse(arguments,[new x({type:"array",constraint:function(e){return 0<e.length&&e.every(function(e){return-1<Object.keys(Ae.UnreadItemKey).map(function(e){return Ae.UnreadItemKey[e]}).indexOf(e)})}}),new x({type:"callback"})]),3);return n=t[0],r=t[1],e=t[2],V(this._iid,function(t){if(n)t(n,null);else{var e=r.filter(function(e,n){return r.indexOf(e)===n});$.get(i._iid).container.apiClient.getUnreadItemCount({keys:e},function(e,n){t(e,n)})}},e)}},{key:"getSubscribedTotalUnreadMessageCount",value:function(){var e=$.get(this._iid).container.subscribedUnreadMessageCount;return 0<=e.all?e.all:0}},{key:"getSubscribedCustomTypeTotalUnreadMessageCount",value:function(){var e=$.get(this._iid).container.subscribedUnreadMessageCount;if(0<Object.keys(e.custom_types).length){var n=0;for(var t in e.custom_types)n+=e.custom_types[t];return n}return 0}},{key:"getSubscribedCustomTypeUnreadMessageCount",value:function(e){if(e&&"string"==typeof e){var n=$.get(this._iid).container.subscribedUnreadMessageCount;return n.custom_types.hasOwnProperty(e)?n.custom_types[e]:0}return 0}},{key:"getMyPushTokensByToken",value:function(e,n,t){var i,a=this,r=g(x.parse(arguments,[new x({type:"string"}),new x({type:"string",constraint:function(e){return-1<["gcm","apns","apns_voip"].indexOf(e)}}),new x({type:"callback"})]),4);return i=r[0],e=r[1],n=r[2],t=r[3],V(this._iid,function(r){i?r(i,null):$.get(a._iid).container.apiClient.getPushTokens({ts:null,token:e,type:n},function(e,n){if(e)r(e,null);else{var t=n.type;r(null,{deviceTokens:n.device_tokens,type:t?t.toLowerCase():"unknown",hasMore:n.has_more,token:n.token})}})},t)}},{key:"getPushTemplate",value:function(e){var n=this;return V(this._iid,function(r){$.get(n._iid).container.apiClient.getPushTemplate({},function(e,n){var t=null;e||(t=n.name.toString()),r(e,t)})},e)}},{key:"setPushTemplate",value:function(e,n){var t=this;return V(this._iid,function(r){-1<[t.PUSH_TEMPLATE_DEFAULT,t.PUSH_TEMPLATE_ALTERNATIVE].indexOf(e)?$.get(t._iid).container.apiClient.setPushTemplate({templateName:e},function(e,n){var t=null;e||(t=n.name.toString()),r(e,t)}):r(x.error,null)},n)}},{key:"markAsReadAll",value:function(e){var s=this;return V(this._iid,function(r){var i=L.get(s._iid).GroupChannel,a=(new Date).getTime();a-i.markAsReadAllLastSentAt<1e3?r(new ee("MarkAsRead rate limit exceeded.",ee.MARK_AS_READ_RATE_LIMIT_EXCEEDED),null):(i.markAsReadAllLastSentAt=a,$.get(s._iid).container.apiClient.markAsReadAll({channelUrls:null},function(e,n){if(!e)for(var t in i.cachedChannels)s.currentUser&&i.cachedChannels[t].updateReadReceipt(s.currentUser.userId,a),i.cachedChannels[t]._setGroupChannelUnreadCount(0,0);r(e,null)}))},e)}},{key:"markAsReadWithChannelUrls",value:function(a,e){var n,s=this,t=g(x.parse(arguments,[new x({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new x({type:"callback"})]),3);return n=t[0],a=t[1],e=t[2],V(this._iid,function(i){n?i(n,null):$.get(s._iid).container.apiClient.markAsReadAll({channelUrls:a},function(e,n){if(!e)for(var t in a){var r=a[t];Ae.cachedChannels[r]&&(s.currentUser&&Ae.cachedChannels[r].updateReadReceipt(s.currentUser.userId,now),Ae.cachedChannels[r]._setGroupChannelUnreadCount(0,0))}i(e,null)})},e)}},{key:"getFriendChangeLogsByToken",value:function(e,n){var t,a=this,r=g(x.parse(arguments,[new x({type:"string",optional:!0,defaultValue:null}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],V(this._iid,function(i){t?i(t,null):$.get(a._iid).container.apiClient.getFriendChangeLogsByToken({token:e},function(e,n){var t=null;if(!e){var r=L.get(a._iid).User;t={updatedUsers:n.updated.map(function(e){return new r(e)}),deletedUserIds:n.deleted,hasMore:n.has_more,token:n.next}}i(e,t)})},n)}},{key:"uploadFriendDiscoveries",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"array",constraint:function(e){return e.every(function(e){return e.hasOwnProperty("friendDiscoveryKey")})}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.uploadFriendDiscoveries({discoveries:e},function(e,n){t(e,n)})},n)}},{key:"deleteFriendDiscovery",value:function(e,n){var t,r=g(x.parse(arguments,[new x({type:"string"}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],t?V(this._iid,function(e){e(t,null)},n):this.deleteFriendDiscoveries([e],n)}},{key:"deleteFriendDiscoveries",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.deleteFriendDiscoveries({discoveryKeys:e},function(e,n){t(e,n)})},n)}},{key:"addFriends",value:function(e,n){var t,a=this,r=g(x.parse(arguments,[new x({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],V(this._iid,function(i){t?i(t,null):$.get(a._iid).container.apiClient.addFriends({userIds:e},function(e,n){var t=null;if(!e){var r=L.get(a._iid).User;t=n.users.map(function(e){return new r(e)})}i(e,t)})},n)}},{key:"deleteFriend",value:function(e,n){var t,r=g(x.parse(arguments,[new x({type:"string"}),new x({type:"callback"})]),3);return t=r[0],e=r[1],n=r[2],t?V(this._iid,function(e){e(t,null)},n):this.deleteFriends([e],n)}},{key:"deleteFriends",value:function(e,n){var r,i=this,t=g(x.parse(arguments,[new x({type:"array",constraint:function(e){return e.every(function(e){return"string"==typeof e})}}),new x({type:"callback"})]),3);return r=t[0],e=t[1],n=t[2],V(this._iid,function(t){r?t(r,null):$.get(i._iid).container.apiClient.deleteFriends({userIds:e},function(e,n){t(e,n)})},n)}},{key:"ConnectionState",get:function(){return{CONNECTING:"CONNECTING",OPEN:"OPEN",CLOSED:"CLOSED"}}},{key:"MessageRequestState",get:function(){return{NONE:"none",PENDING:"pending",FAILED:"failed",SUCCEEDED:"succeeded"}}},{key:"pushTokenRegistrationState",get:function(){return{SUCCESS:"success",PENDING:"pending",ERROR:"error"}}},{key:"PushTriggerOption",get:function(){return{ALL:"all",MENTION_ONLY:"mention_only",OFF:"off"}}}],[{key:"getInstance",value:function(e){return e?cn[e]:ln}},{key:"version",get:function(){return f.SDK_VERSION}}]),o}();return hn});